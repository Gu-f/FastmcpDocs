---
title: 自托管远程 MCP
sidebarTitle: 自托管
description: 将您的 FastMCP 服务器部署为可通过 URL 访问的远程 MCP 服务
icon: server
---

<Tip>
STDIO 传输非常适合本地开发和桌面应用程序。但要释放 MCP 的全部潜力——集中式服务、多客户端访问和网络可用性——您需要远程 HTTP 部署。
</Tip>

本指南将指导您将 FastMCP 服务器部署为可通过 URL 访问的远程 MCP 服务。部署后，您的 MCP 服务器将可通过网络访问，允许多个客户端同时连接，并支持与基于云的 LLM 应用程序集成。本指南专门关注远程 MCP 部署，而非本地 STDIO 服务器。

## 选择您的方法

FastMCP 提供了两种将服务器部署为 HTTP 服务的方式。了解权衡有助于您为自己的需求选择正确的方法。

**直接 HTTP 服务器**方法更简单，非常适合快速入门。您修改服务器的 `run()` 方法以使用 HTTP 传输，FastMCP 处理所有 Web 服务器配置。这种方法适用于独立部署，您希望 MCP 服务器是在端口上运行的唯一服务。

**ASGI 应用程序**方法为您提供更多控制和灵活性。您不是直接运行服务器，而是创建一个可由 Uvicorn 或 Gunicorn 等生产级服务器提供服务的 ASGI 应用程序。当您需要高级服务器功能（如多个工作进程、自定义中间件）或与现有 Web 应用程序集成时，这种方法更好。

### 直接 HTTP 服务器

让您的 MCP 服务器上线的最简单方法是使用内置的 `run()` 方法和 HTTP 传输。这种方法为您处理所有服务器配置，非常适合在不需要额外复杂性的情况下需要独立 MCP 服务器。

```python server.py
from fastmcp import FastMCP

mcp = FastMCP("My Server")

@mcp.tool
def process_data(input: str) -> str:
    """在服务器上处理数据"""
    return f"Processed: {input}"

if __name__ == "__main__":
    mcp.run(transport="http", host="0.0.0.0", port=8000)
```

使用简单的 Python 命令运行您的服务器：
```bash
python server.py
```

您的服务器现在可在 `http://localhost:8000/mcp/` 访问（或使用您服务器的实际 IP 地址进行远程访问）。

这种方法非常适合在您希望以最少的配置快速上线时使用。它非常适合内部工具、开发环境或不需要高级服务器功能的简单部署。内置服务器处理所有 HTTP 细节，让您专注于 MCP 实现。

### ASGI 应用程序

对于生产部署，您通常希望对服务器的运行方式有更多控制。FastMCP 可以创建一个标准的 ASGI 应用程序，可以与任何 ASGI 服务器（如 Uvicorn、Gunicorn 或 Hypercorn）一起工作。当您需要配置高级服务器选项、运行多个工作进程或与现有基础设施集成时，这种方法特别有用。

```python app.py
from fastmcp import FastMCP

mcp = FastMCP("My Server")

@mcp.tool
def process_data(input: str) -> str:
    """在服务器上处理数据"""
    return f"Processed: {input}"

# 创建 ASGI 应用程序
app = mcp.http_app()
```

使用任何 ASGI 服务器运行 - 这里是使用 Uvicorn 的示例：
```bash
uvicorn app:app --host 0.0.0.0 --port 8000
```

您的服务器可在相同的 URL 访问：`http://localhost:8000/mcp/`（或使用您服务器的实际 IP 地址进行远程访问）。

ASGI 方法在需要可靠性和性能的生产环境中表现出色。您可以运行多个工作进程来处理并发请求、为日志记录或监控添加自定义中间件、与现有部署管道集成，或将您的 MCP 服务器作为更大应用程序的一部分进行挂载。这种灵活性使其成为严肃部署的首选。

## 配置您的服务器

### 自定义路径

默认情况下，您的 MCP 服务器可在您域名的 `/mcp/` 访问。您可以自定义此路径以适应您的 URL 结构或避免与现有端点冲突。当将 MCP 集成到现有应用程序中或遵循特定 API 约定时，这特别有用。

```python
# 选项 1：使用 mcp.run()
mcp.run(transport="http", host="0.0.0.0", port=8000, path="/api/mcp/")

# 选项 2：使用 ASGI 应用程序
app = mcp.http_app(path="/api/mcp/")
```

现在您的服务器可在 `http://localhost:8000/api/mcp/` 访问。

### 身份验证

<Warning>
对于远程 MCP 服务器，**强烈推荐**使用身份验证。一些 LLM 客户端需要远程服务器进行身份验证，没有身份验证将拒绝连接。
</Warning>

FastMCP 支持多种身份验证方法来保护您的远程服务器。有关完整的配置选项（包括 Bearer 令牌、JWT 和 OAuth），请参阅[身份验证概述](/zh/servers/auth/authentication)。

### 健康检查

健康检查端点对于监控部署的服务器并确保其正确响应至关重要。FastMCP 允许您在 MCP 端点旁边添加自定义路由，使实现适用于两种部署方法的健康检查变得容易。

```python
from starlette.responses import JSONResponse

@mcp.custom_route("/health", methods=["GET"])
async def health_check(request):
    return JSONResponse({"status": "healthy", "service": "mcp-server"})
```

此健康端点将在 `http://localhost:8000/health` 可用，可以被负载均衡器、监控系统或部署平台用来验证您的服务器是否运行。

## 与 Web 框架集成

如果您已经有一个正在运行的 Web 应用程序，您可以通过将 FastMCP 服务器作为子应用程序挂载来添加 MCP 功能。这允许您在现有 API 端点旁边公开 MCP 工具，共享相同的域名和基础设施。MCP 服务器成为应用程序中的另一个路由，使其易于管理和部署。

有关详细集成指南，请参阅：
- [FastAPI 集成](/zh/integrations/fastapi)
- [ASGI / Starlette 集成](/zh/integrations/asgi)

这里是一个快速示例，显示如何将 MCP 添加到现有的 FastAPI 应用程序中：

```python
from fastapi import FastAPI
from fastmcp import FastMCP

# 您现有的 API
api = FastAPI()

@api.get("/api/status")
def status():
    return {"status": "ok"}

# 创建您的 MCP 服务器
mcp = FastMCP("API Tools")

@mcp.tool
def query_database(query: str) -> dict:
    """运行数据库查询"""
    return {"result": "data"}

# 在 /mcp 挂载 MCP
api.mount("/mcp", mcp.http_app())

# 使用以下命令运行：uvicorn app:api --host 0.0.0.0 --port 8000
```

您现有的 API 仍在 `http://localhost:8000/api/`，而 MCP 在 `http://localhost:8000/mcp/` 可用。

## 生产部署

### 使用 Uvicorn 运行

在部署到生产环境时，您需要为性能和可靠性优化服务器。Uvicorn 提供了几个选项来改善服务器的能力，包括运行多个工作进程来处理并发请求以及启用增强的日志记录用于监控。

```bash
# 安装带有标准额外功能的 uvicorn 以获得更好的性能
pip install 'uvicorn[standard]'

# 使用多个工作进程运行以获得更好的并发性
uvicorn app:app --host 0.0.0.0 --port 8000 --workers 4

# 启用详细日志记录用于监控
uvicorn app:app --host 0.0.0.0 --port 8000 --log-level info
```

### 环境变量

生产部署不应该在代码中硬编码敏感信息（如 API 密钥或身份验证令牌）。相反，使用环境变量在运行时配置服务器。这保持代码安全，并使将相同的代码部署到不同环境中使用不同配置变得容易。

这里是使用 bearer 令牌身份验证的示例（尽管生产环境推荐使用 OAuth）：

```python
import os
from fastmcp import FastMCP
from fastmcp.server.auth import BearerTokenAuth

# 从环境中读取配置
auth_token = os.environ.get("MCP_AUTH_TOKEN")
if auth_token:
    auth = BearerTokenAuth(token=auth_token)
    mcp = FastMCP("生产服务器", auth=auth)
else:
    mcp = FastMCP("生产服务器")

app = mcp.http_app()
```

使用安全存储在环境变量中的秘密进行部署：
```bash
MCP_AUTH_TOKEN=secret uvicorn app:app --host 0.0.0.0 --port 8000
```

## 测试您的部署

部署服务器后，您需要验证它可访问并正常运行。有关全面的测试策略（包括连接测试、客户端测试和身份验证测试），请参阅[测试您的服务器](/zh/development/tests)指南。

## 托管您的服务器

本指南向您展示了如何创建可通过 HTTP 访问的 MCP 服务器，但您仍需要一个托管提供商来使其在互联网上可用。您的 FastMCP 服务器可以在任何支持 Python Web 应用程序的地方运行：

- **云虚拟机** (AWS EC2、Google Compute Engine、Azure VMs)
- **容器平台** (Cloud Run、Container Instances、ECS)
- **平台即服务** (Railway、Render、Vercel)
- **边缘平台** (Cloudflare Workers)
- **Kubernetes 集群** (自管理或托管)

关键要求是支持 Python 3.10+ 和能够暴露 HTTP 端口。大多数提供商会要求您根据他们的部署格式打包您的服务器（requirements.txt、Dockerfile 等）。有关托管的零配置部署，请参阅 [FastMCP Cloud](/zh/deployment/fastmcp-cloud)。