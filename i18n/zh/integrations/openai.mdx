---
title: OpenAI API ğŸ¤ FastMCP
sidebarTitle: OpenAI API
description: å°† FastMCP æœåŠ¡å™¨ä¸ OpenAI API è¿æ¥
icon: message-code
---

import { VersionBadge } from "/snippets/version-badge.mdx"


## Responses API

OpenAI çš„ [Responses API](https://platform.openai.com/docs/api-reference/responses) æ”¯æŒ [MCP æœåŠ¡å™¨](https://platform.openai.com/docs/guides/tools-remote-mcp)ä½œä¸ºè¿œç¨‹å·¥å…·æºï¼Œå…è®¸æ‚¨ä½¿ç”¨è‡ªå®šä¹‰å‡½æ•°æ‰©å±• AI åŠŸèƒ½ã€‚

<Note>
Responses API æ˜¯ä¸ OpenAI çš„ Completions API æˆ– Assistants API ä¸åŒçš„ç‹¬ç«‹ APIã€‚ç›®å‰ï¼Œåªæœ‰ Responses API æ”¯æŒ MCPã€‚
</Note>

<Tip>
ç›®å‰ï¼ŒResponses API ä»…è®¿é—® MCP æœåŠ¡å™¨çš„**å·¥å…·**â€”â€”å®ƒæŸ¥è¯¢ `list_tools` ç«¯ç‚¹å¹¶å°†è¿™äº›åŠŸèƒ½æš´éœ²ç»™ AI ä»£ç†ã€‚ç›®å‰ä¸æ”¯æŒå…¶ä»– MCP åŠŸèƒ½ï¼Œå¦‚èµ„æºå’Œæç¤ºã€‚
</Tip>


### åˆ›å»ºæœåŠ¡å™¨

é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªåŒ…å«æ‚¨è¦æš´éœ²çš„å·¥å…·çš„ FastMCP æœåŠ¡å™¨ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå¸¦æœ‰æ·éª°å­å•ä¸€å·¥å…·çš„æœåŠ¡å™¨ã€‚

```python server.py
import random
from fastmcp import FastMCP

mcp = FastMCP(name="éª°å­æŠ•æ·å™¨")

@mcp.tool
def roll_dice(n_dice: int) -> list[int]:
    """æ· `n_dice` ä¸ªå…­é¢éª°å­å¹¶è¿”å›ç»“æœã€‚"""
    return [random.randint(1, 6) for _ in range(n_dice)]

if __name__ == "__main__":
    mcp.run(transport="http", port=8000)
```

### éƒ¨ç½²æœåŠ¡å™¨

æ‚¨çš„æœåŠ¡å™¨å¿…é¡»éƒ¨ç½²åˆ°å…¬å…± URLï¼Œä»¥ä¾¿ OpenAI èƒ½å¤Ÿè®¿é—®å®ƒã€‚

å¯¹äºå¼€å‘ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨åƒ `ngrok` è¿™æ ·çš„å·¥å…·ä¸´æ—¶å°†æœ¬åœ°è¿è¡Œçš„æœåŠ¡å™¨æš´éœ²åˆ°äº’è”ç½‘ã€‚æˆ‘ä»¬å°†åœ¨æ­¤ç¤ºä¾‹ä¸­è¿™æ ·åšï¼ˆæ‚¨å¯èƒ½éœ€è¦å®‰è£… `ngrok` å¹¶åˆ›å»ºä¸€ä¸ªå…è´¹è´¦æˆ·ï¼‰ï¼Œä½†æ‚¨å¯ä»¥ä½¿ç”¨ä»»ä½•å…¶ä»–æ–¹æ³•æ¥éƒ¨ç½²æ‚¨çš„æœåŠ¡å™¨ã€‚

å‡è®¾æ‚¨å°†ä¸Šè¿°ä»£ç ä¿å­˜ä¸º `server.py`ï¼Œæ‚¨å¯ä»¥åœ¨ä¸¤ä¸ªç‹¬ç«‹çš„ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹ä¸¤ä¸ªå‘½ä»¤æ¥éƒ¨ç½²æ‚¨çš„æœåŠ¡å™¨å¹¶å°†å…¶æš´éœ²åˆ°äº’è”ç½‘ï¼š

<CodeGroup>
```bash FastMCP æœåŠ¡å™¨
python server.py
```

```bash ngrok
ngrok http 8000
```
</CodeGroup>

<Warning>
è¿™ä¼šå°†æ‚¨çš„æœªç»èº«ä»½éªŒè¯çš„æœåŠ¡å™¨æš´éœ²åˆ°äº’è”ç½‘ã€‚åªæœ‰åœ¨æ‚¨äº†è§£é£é™©çš„æƒ…å†µä¸‹ï¼Œæ‰åœ¨å®‰å…¨ç¯å¢ƒä¸­è¿è¡Œæ­¤å‘½ä»¤ã€‚
</Warning>

### è°ƒç”¨æœåŠ¡å™¨

è¦ä½¿ç”¨ Responses APIï¼Œæ‚¨éœ€è¦å®‰è£… OpenAI Python SDKï¼ˆFastMCP ä¸­ä¸åŒ…å«ï¼‰ï¼š

```bash
pip install openai
```

æ‚¨è¿˜éœ€è¦é€šè¿‡ OpenAI è¿›è¡Œèº«ä»½éªŒè¯ã€‚æ‚¨å¯ä»¥é€šè¿‡è®¾ç½® `OPENAI_API_KEY` ç¯å¢ƒå˜é‡æ¥å®Œæˆæ­¤æ“ä½œã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥é˜… OpenAI SDK æ–‡æ¡£ã€‚

```bash
export OPENAI_API_KEY="your-api-key"
```

ä»¥ä¸‹æ˜¯å¦‚ä½•ä» Python è°ƒç”¨æ‚¨çš„æœåŠ¡å™¨çš„ç¤ºä¾‹ã€‚è¯·æ³¨æ„ï¼Œæ‚¨éœ€è¦å°† `https://your-server-url.com` æ›¿æ¢ä¸ºæ‚¨æœåŠ¡å™¨çš„å®é™… URLã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬ä½¿ç”¨ `/mcp/` ä½œä¸ºç«¯ç‚¹ï¼Œå› ä¸ºæˆ‘ä»¬éƒ¨ç½²äº†ä¸€ä¸ªä½¿ç”¨é»˜è®¤è·¯å¾„çš„å¯æµå¼ HTTP æœåŠ¡å™¨ï¼›å¦‚æœæ‚¨è‡ªå®šä¹‰äº†æœåŠ¡å™¨çš„éƒ¨ç½²ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨ä¸åŒçš„ç«¯ç‚¹ã€‚

```python {4, 11-16}
from openai import OpenAI

# æ‚¨çš„æœåŠ¡å™¨ URLï¼ˆæ›¿æ¢ä¸ºæ‚¨çš„å®é™… URLï¼‰
url = 'https://your-server-url.com'

client = OpenAI()

resp = client.responses.create(
    model="gpt-4.1",
    tools=[
        {
            "type": "mcp",
            "server_label": "dice_server",
            "server_url": f"{url}/mcp/",
            "require_approval": "never",
        },
    ],
    input="æŠ•å‡ ä¸ªéª°å­ï¼",
)

print(resp.output_text)
```
å¦‚æœæ‚¨è¿è¡Œæ­¤ä»£ç ï¼Œæ‚¨å°†çœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹çš„è¾“å‡ºï¼š

```text
æ‚¨æŠ•äº† 3 ä¸ªéª°å­ï¼Œå¾—åˆ°ä»¥ä¸‹ç»“æœï¼š6ã€4 å’Œ 2ï¼
```

### èº«ä»½éªŒè¯

<VersionBadge version="2.6.0" />

Responses API å¯ä»¥åŒ…å«ç”¨äºèº«ä»½éªŒè¯è¯·æ±‚çš„è¯·æ±‚å¤´ï¼Œè¿™æ„å‘³ç€æ‚¨ä¸å¿…æ‹…å¿ƒæ‚¨çš„æœåŠ¡å™¨è¢«å…¬å¼€è®¿é—®ã€‚

#### æœåŠ¡å™¨èº«ä»½éªŒè¯

å‘æœåŠ¡å™¨æ·»åŠ èº«ä»½éªŒè¯çš„æœ€ç®€å•æ–¹æ³•æ˜¯ä½¿ç”¨æ‰¿è½½ä»¤ç‰Œæ–¹æ¡ˆã€‚

åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ FastMCP çš„ `RSAKeyPair` å·¥å…·å¿«é€Ÿç”Ÿæˆæˆ‘ä»¬è‡ªå·±çš„ä»¤ç‰Œï¼Œä½†è¿™å¯èƒ½ä¸é€‚ç”¨äºç”Ÿäº§ä½¿ç”¨ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…å®Œæ•´çš„æœåŠ¡å™¨ç«¯[ä»¤ç‰ŒéªŒè¯](/zh/servers/auth/token-verification)æ–‡æ¡£ã€‚

æˆ‘ä»¬å°†é¦–å…ˆåˆ›å»ºä¸€ä¸ª RSA å¯†é’¥å¯¹æ¥ç­¾åå’ŒéªŒè¯ä»¤ç‰Œã€‚

```python
from fastmcp.server.auth.providers.jwt import RSAKeyPair

key_pair = RSAKeyPair.generate()
access_token = key_pair.create_token(audience="dice-server")
```

<Warning>
FastMCP çš„ `RSAKeyPair` å·¥å…·ä»…ç”¨äºå¼€å‘å’Œæµ‹è¯•ã€‚
</Warning>

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ª `JWTVerifier` æ¥éªŒè¯æœåŠ¡å™¨ã€‚ 

```python
from fastmcp import FastMCP
from fastmcp.server.auth import JWTVerifier

auth = JWTVerifier(
    public_key=key_pair.public_key,
    audience="dice-server",
)

mcp = FastMCP(name="Dice Roller", auth=auth)
```

ä»¥ä¸‹æ˜¯ä¸€ä¸ªæ‚¨å¯ä»¥å¤åˆ¶/ç²˜è´´çš„å®Œæ•´ç¤ºä¾‹ã€‚ä¸ºäº†ç®€å•èµ·è§å¹¶ä»…ä¸ºæ­¤ç¤ºä¾‹ç›®çš„ï¼Œå®ƒå°†æŠŠä»¤ç‰Œæ‰“å°åˆ°æ§åˆ¶å°ã€‚**åœ¨ç”Ÿäº§ä¸­è¯·å‹¿è¿™æ ·åšï¼**

```python server.py [expandable]
from fastmcp import FastMCP
from fastmcp.server.auth import JWTVerifier
from fastmcp.server.auth.providers.jwt import RSAKeyPair
import random

key_pair = RSAKeyPair.generate()
access_token = key_pair.create_token(audience="dice-server")

auth = JWTVerifier(
    public_key=key_pair.public_key,
    audience="dice-server",
)

mcp = FastMCP(name="Dice Roller", auth=auth)

@mcp.tool
def roll_dice(n_dice: int) -> list[int]:
    """æ· `n_dice` ä¸ªå…­é¢éª°å­å¹¶è¿”å›ç»“æœã€‚"""
    return [random.randint(1, 6) for _ in range(n_dice)]

if __name__ == "__main__":
    print(f"\n---\n\nğŸ”‘ éª°å­æŠ•æ·å™¨è®¿é—®ä»¤ç‰Œï¼š\n\n{access_token}\n\n---\n")
    mcp.run(transport="http", port=8000)
```

#### å®¢æˆ·ç«¯èº«ä»½éªŒè¯

å¦‚æœæ‚¨å°è¯•ä½¿ç”¨æˆ‘ä»¬ä¹‹å‰ç¼–å†™çš„ç›¸åŒ OpenAI ä»£ç è°ƒç”¨ç»è¿‡èº«ä»½éªŒè¯çš„æœåŠ¡å™¨ï¼Œæ‚¨å°†æ”¶åˆ°ç±»ä¼¼ä»¥ä¸‹çš„é”™è¯¯ï¼š

```python
pythonAPIStatusError: Error code: 424 - {
    "error": {
        "message": "ä» MCP æœåŠ¡å™¨è·å–å·¥å…·åˆ—è¡¨æ—¶å‡ºé”™ï¼š 'dice_server'ã€‚Http çŠ¶æ€ä»£ç ï¼š401ï¼ˆæœªæˆæƒï¼‰",
        "type": "external_connector_error",
        "param": "tools",
        "code": "http_error"
    }
}
```

å¦‚é¢„æœŸçš„é‚£æ ·ï¼ŒæœåŠ¡å™¨æ‹’ç»äº†è¯·æ±‚ï¼Œå› ä¸ºå®ƒæœªç»èº«ä»½éªŒè¯ã€‚

è¦éªŒè¯å®¢æˆ·ç«¯ï¼Œæ‚¨å¯ä»¥åœ¨ `Authorization` è¯·æ±‚å¤´ä¸­ä½¿ç”¨ `Bearer` æ–¹æ¡ˆä¼ é€’ä»¤ç‰Œï¼š


```python {4, 7, 19-21} [expandable]
from openai import OpenAI

# æ‚¨çš„æœåŠ¡å™¨ URLï¼ˆæ›¿æ¢ä¸ºæ‚¨çš„å®é™… URLï¼‰
url = 'https://your-server-url.com'

# æ‚¨çš„è®¿é—®ä»¤ç‰Œï¼ˆæ›¿æ¢ä¸ºæ‚¨çš„å®é™…ä»¤ç‰Œï¼‰
access_token = 'your-access-token'

client = OpenAI()

resp = client.responses.create(
    model="gpt-4.1",
    tools=[
        {
            "type": "mcp",
            "server_label": "dice_server",
            "server_url": f"{url}/mcp/",
            "require_approval": "never",
            "headers": {
                "Authorization": f"Bearer {access_token}"
            }
        },
    ],
    input="æŠ•å‡ ä¸ªéª°å­ï¼",
)

print(resp.output_text)
```

ç°åœ¨æ‚¨åº”è¯¥åœ¨è¾“å‡ºä¸­çœ‹åˆ°éª°å­æŠ•æ·ç»“æœã€‚