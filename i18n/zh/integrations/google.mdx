---
title: Google OAuth ğŸ¤ FastMCP
sidebarTitle: Google
description: ä½¿ç”¨ Google OAuth ä¿æŠ¤æ‚¨çš„ FastMCP æœåŠ¡å™¨
icon: google
tag: NEW
---

import { VersionBadge } from "/snippets/version-badge.mdx"

<VersionBadge version="2.12.0" />

æœ¬æŒ‡å—å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•ä½¿ç”¨ **Google OAuth** ä¿æŠ¤æ‚¨çš„ FastMCP æœåŠ¡å™¨ã€‚ç”±äº Google ä¸æ”¯æŒåŠ¨æ€å®¢æˆ·ç«¯æ³¨å†Œï¼Œæ­¤é›†æˆä½¿ç”¨ [**OAuth ä»£ç†**](/zh/servers/auth/oauth-proxy) æ¨¡å¼æ¥è¿æ¥ Google çš„ä¼ ç»Ÿ OAuth ä¸ MCP çš„èº«ä»½éªŒè¯è¦æ±‚ã€‚

## é…ç½®

### å…ˆå†³æ¡ä»¶

åœ¨å¼€å§‹ä¹‹å‰ï¼Œæ‚¨éœ€è¦ï¼š
1. ä¸€ä¸ªå…·æœ‰åˆ›å»º OAuth 2.0 å®¢æˆ·ç«¯ ID æƒé™çš„ **[Google Cloud è´¦æˆ·](https://console.cloud.google.com/)**
2. æ‚¨çš„ FastMCP æœåŠ¡å™¨ URLï¼ˆå¼€å‘æ—¶å¯ä»¥æ˜¯ localhostï¼Œä¾‹å¦‚ `http://localhost:8000`ï¼‰

### ç¬¬ 1 æ­¥ï¼šåˆ›å»º Google OAuth 2.0 å®¢æˆ·ç«¯ ID

åœ¨æ‚¨çš„ Google Cloud æ§åˆ¶å°ä¸­åˆ›å»º OAuth 2.0 å®¢æˆ·ç«¯ ID ä»¥è·å–èº«ä»½éªŒè¯æ‰€éœ€çš„å‡­æ®ï¼š

<Steps>
<Step title="å¯¼èˆªåˆ° OAuth åŒæ„å±">
    è½¬åˆ° [Google Cloud æ§åˆ¶å°](https://console.cloud.google.com/apis/credentials)å¹¶é€‰æ‹©æ‚¨çš„é¡¹ç›®ï¼ˆæˆ–åˆ›å»ºæ–°é¡¹ç›®ï¼‰ã€‚
    
    é¦–å…ˆï¼Œé€šè¿‡å¯¼èˆªåˆ° **API å’ŒæœåŠ¡ â†’ OAuth åŒæ„å±** æ¥é…ç½® OAuth åŒæ„å±ã€‚é€‰æ‹© "å¤–éƒ¨" è¿›è¡Œæµ‹è¯•æˆ–ä¸º G Suite ç»„ç»‡é€‰æ‹© "å†…éƒ¨"ã€‚
</Step>

<Step title="åˆ›å»º OAuth 2.0 å®¢æˆ·ç«¯ ID">
    å¯¼èˆªåˆ° **API å’ŒæœåŠ¡ â†’ å‡­æ®** å¹¶ç‚¹å‡» **"+ åˆ›å»ºå‡­æ®"** â†’ **"OAuth å®¢æˆ·ç«¯ ID"ã€‚
    
    é…ç½®æ‚¨çš„ OAuth å®¢æˆ·ç«¯ï¼š
    
    - **åº”ç”¨ç¨‹åºç±»å‹**ï¼šWeb åº”ç”¨ç¨‹åº
    - **åç§°**ï¼šé€‰æ‹©æè¿°æ€§åç§°ï¼ˆä¾‹å¦‚ï¼Œ"FastMCP æœåŠ¡å™¨"ï¼‰
    - **æˆæƒçš„ JavaScript æº**ï¼šæ·»åŠ æ‚¨æœåŠ¡å™¨çš„åŸºæœ¬ URLï¼ˆä¾‹å¦‚ï¼Œ`http://localhost:8000`ï¼‰
    - **æˆæƒçš„é‡å®šå‘ URI**ï¼šæ·»åŠ æ‚¨çš„æœåŠ¡å™¨ URL + `/auth/callback`ï¼ˆä¾‹å¦‚ï¼Œ`http://localhost:8000/auth/callback`ï¼‰
    
    <Warning>
    é‡å®šå‘ URI å¿…é¡»å®Œå…¨åŒ¹é…ã€‚é»˜è®¤è·¯å¾„æ˜¯ `/auth/callback`ï¼Œä½†æ‚¨å¯ä»¥ä½¿ç”¨ `redirect_path` å‚æ•°è¿›è¡Œè‡ªå®šä¹‰ã€‚å¯¹äºæœ¬åœ°å¼€å‘ï¼ŒGoogle å…è®¸ä¸åŒç«¯å£çš„ `http://localhost` URLã€‚å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œæ‚¨å¿…é¡»ä½¿ç”¨ HTTPSã€‚
    </Warning>
    
    <Tip>
    å¦‚æœæ‚¨æƒ³ä½¿ç”¨è‡ªå®šä¹‰å›è°ƒè·¯å¾„ï¼ˆä¾‹å¦‚ï¼Œ`/auth/google/callback`ï¼‰ï¼Œè¯·ç¡®ä¿åœ¨ Google OAuth å®¢æˆ·ç«¯è®¾ç½®å’Œé…ç½® GoogleProvider æ—¶çš„ `redirect_path` å‚æ•°ä¸­è®¾ç½®ç›¸åŒçš„è·¯å¾„ã€‚
    </Tip>
</Step>

<Step title="ä¿å­˜æ‚¨çš„å‡­æ®">
    åˆ›å»ºå®¢æˆ·ç«¯åï¼Œæ‚¨å°†æ”¶åˆ°ï¼š
    
    - **å®¢æˆ·ç«¯ ID**ï¼šä»¥ `.apps.googleusercontent.com` ç»“å°¾çš„å­—ç¬¦ä¸²
    - **å®¢æˆ·ç«¯å¯†é’¥**ï¼šä»¥ `GOCSPX-` å¼€å¤´çš„å­—ç¬¦ä¸²
    
    ä¸‹è½½ JSON å‡­æ®æˆ–å®‰å…¨å¤åˆ¶è¿™äº›å€¼ã€‚
    
    <Tip>
    å®‰å…¨å­˜å‚¨è¿™äº›å‡­æ®ã€‚æ°¸è¿œä¸è¦å°†å®ƒä»¬æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–å¯†é’¥ç®¡ç†å™¨ã€‚
    </Tip>
</Step>
</Steps>

### ç¬¬ 2 æ­¥ï¼šFastMCP é…ç½®

ä½¿ç”¨ `GoogleProvider` åˆ›å»ºæ‚¨çš„ FastMCP æœåŠ¡å™¨ï¼Œå®ƒä¼šè‡ªåŠ¨å¤„ç† Google çš„ OAuth æµç¨‹ï¼š

```python server.py
from fastmcp import FastMCP
from fastmcp.server.auth.providers.google import GoogleProvider

# GoogleProvider å¤„ç† Google çš„ä»¤ç‰Œæ ¼å¼å’ŒéªŒè¯
auth_provider = GoogleProvider(
    client_id="123456789.apps.googleusercontent.com",  # æ‚¨çš„ Google OAuth å®¢æˆ·ç«¯ ID
    client_secret="GOCSPX-abc123...",                  # æ‚¨çš„ Google OAuth å®¢æˆ·ç«¯å¯†é’¥
    base_url="http://localhost:8000",                  # å¿…é¡»ä¸æ‚¨çš„ OAuth é…ç½®åŒ¹é…
    required_scopes=[                                  # Request user information
        "openid",
        "https://www.googleapis.com/auth/userinfo.email",
    ],
    # redirect_path="/auth/callback"                  # é»˜è®¤å€¼ï¼Œå¦‚éœ€å¯è‡ªå®šä¹‰
)

mcp = FastMCP(name="Google Secured App", auth=auth_provider)

# æ·»åŠ å—ä¿æŠ¤çš„å·¥å…·æ¥æµ‹è¯•èº«ä»½éªŒè¯
@mcp.tool
async def get_user_info() -> dict:
    """è¿”å›ç»è¿‡èº«ä»½éªŒè¯çš„ Google ç”¨æˆ·ä¿¡æ¯ã€‚"""
    from fastmcp.server.dependencies import get_access_token
    
    token = get_access_token()
    # GoogleProvider åœ¨ä»¤ç‰Œå£°æ˜ä¸­å­˜å‚¨ç”¨æˆ·æ•°æ®
    return {
        "google_id": token.claims.get("sub"),
        "email": token.claims.get("email"),
        "name": token.claims.get("name"),
        "picture": token.claims.get("picture"),
        "locale": token.claims.get("locale")
    }
```

## æµ‹è¯•

### è¿è¡ŒæœåŠ¡å™¨

ä½¿ç”¨ HTTP ä¼ è¾“å¯åŠ¨æ‚¨çš„ FastMCP æœåŠ¡å™¨ä»¥å¯ç”¨ OAuth æµç¨‹ï¼š

```bash
fastmcp run server.py --transport http --port 8000
```

æ‚¨çš„æœåŠ¡å™¨ç°åœ¨æ­£åœ¨è¿è¡Œå¹¶å—åˆ° Google OAuth èº«ä»½éªŒè¯çš„ä¿æŠ¤ã€‚

### ä½¿ç”¨å®¢æˆ·ç«¯æµ‹è¯•

åˆ›å»ºä¸€ä¸ªä¸æ‚¨çš„ Google ä¿æŠ¤æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯çš„æµ‹è¯•å®¢æˆ·ç«¯ï¼š

```python test_client.py
from fastmcp import Client
import asyncio

async def main():
    # å®¢æˆ·ç«¯å°†è‡ªåŠ¨å¤„ç† Google OAuth
    async with Client("http://localhost:8000/mcp/", auth="oauth") as client:
        # é¦–æ¬¡è¿æ¥å°†åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ Google ç™»å½•
        print("âœ“ å·²é€šè¿‡ Google èº«ä»½éªŒè¯ï¼")
        
        # æµ‹è¯•å—ä¿æŠ¤çš„å·¥å…·
        result = await client.call_tool("get_user_info")
        print(f"Google ç”¨æˆ·ï¼š{result['email']}")
        print(f"å§“åï¼š{result['name']}")

if __name__ == "__main__":
    asyncio.run(main())
```

å½“æ‚¨é¦–æ¬¡è¿è¡Œå®¢æˆ·ç«¯æ—¶ï¼š
1. æ‚¨çš„æµè§ˆå™¨å°†æ‰“å¼€ Google çš„æˆæƒé¡µé¢
2. ä½¿ç”¨æ‚¨çš„ Google è´¦æˆ·ç™»å½•å¹¶æˆäºˆè¯·æ±‚çš„æƒé™
3. æˆæƒåï¼Œæ‚¨å°†è¢«é‡å®šå‘å›å»
4. å®¢æˆ·ç«¯æ¥æ”¶ä»¤ç‰Œå¹¶å¯ä»¥å‘å‡ºç»è¿‡èº«ä»½éªŒè¯çš„è¯·æ±‚

<Info>
å®¢æˆ·ç«¯åœ¨æœ¬åœ°ç¼“å­˜ä»¤ç‰Œï¼Œå› æ­¤é™¤éä»¤ç‰Œè¿‡æœŸæˆ–æ‚¨æ˜¾å¼æ¸…é™¤ç¼“å­˜ï¼Œå¦åˆ™æ‚¨æ— éœ€ä¸ºåç»­è¿è¡Œé‡æ–°è¿›è¡Œèº«ä»½éªŒè¯ã€‚
</Info>

## ç”Ÿäº§ç¯å¢ƒé…ç½®

<VersionBadge version="2.13.0" />

åœ¨ç”Ÿäº§éƒ¨ç½²ä¸­ï¼Œä¸ºäº†åœ¨æœåŠ¡å™¨é‡å¯åä»èƒ½ä¿ç•™ä»¤ç‰Œï¼Œè¯·åŒæ—¶é…ç½® `jwt_signing_key` ä¸ `client_storage`ï¼š

```python server.py
import os
from fastmcp import FastMCP
from fastmcp.server.auth.providers.google import GoogleProvider
from key_value.aio.stores.redis import RedisStore
from key_value.aio.wrappers.encryption import FernetEncryptionWrapper
from cryptography.fernet import Fernet

# ä½¿ç”¨åŠ å¯†çš„æŒä¹…åŒ–ä»¤ç‰Œå­˜å‚¨è¿›è¡Œç”Ÿäº§é…ç½®
auth_provider = GoogleProvider(
    client_id="123456789.apps.googleusercontent.com",
    client_secret="GOCSPX-abc123...",
    base_url="https://your-production-domain.com",
    required_scopes=["openid", "https://www.googleapis.com/auth/userinfo.email"],

    # ç”Ÿäº§ç¯å¢ƒä»¤ç‰Œç®¡ç†
    jwt_signing_key=os.environ["JWT_SIGNING_KEY"],
    client_storage=FernetEncryptionWrapper(
        key_value=RedisStore(
            host=os.environ["REDIS_HOST"],
            port=int(os.environ["REDIS_PORT"])
        ),
        fernet=Fernet(os.environ["STORAGE_ENCRYPTION_KEY"])
    )
)

mcp = FastMCP(name="Production Google App", auth=auth_provider)
```

<Note>
`jwt_signing_key` ä¸ `client_storage` éœ€è¦é…åˆä½¿ç”¨ï¼Œæ‰èƒ½åœ¨æœåŠ¡å™¨é‡å¯åä¿ç•™ä»¤ç‰Œä¸å®¢æˆ·ç«¯æ³¨å†Œä¿¡æ¯ã€‚**è¯·ä½¿ç”¨ `FernetEncryptionWrapper` åŠ å¯†å­˜å‚¨ä¸­çš„æ•æ„Ÿ OAuth ä»¤ç‰Œ**ï¼Œå¦åˆ™å°†ä»¥æ˜æ–‡ä¿å­˜ã€‚å»ºè®®é€šè¿‡ç¯å¢ƒå˜é‡å­˜æ”¾å¯†é’¥ï¼Œå¹¶ä½¿ç”¨ Redis ç­‰æŒä¹…åŒ–åç«¯ä»¥æ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²ã€‚

æ›´å¤šå‚æ•°è¯¦æƒ…è¯·å‚é˜… [OAuth ä»£ç†æ–‡æ¡£](/zh/servers/auth/oauth-proxy#configuration-parameters)ã€‚
</Note>

## ç¯å¢ƒå˜é‡

<VersionBadge version="2.12.1" />

å¯¹äºç”Ÿäº§éƒ¨ç½²ï¼Œè¯·ä½¿ç”¨ç¯å¢ƒå˜é‡è€Œä¸æ˜¯ç¡¬ç¼–ç å‡­æ®ã€‚

### æä¾›ç¨‹åºé€‰æ‹©

è®¾ç½®æ­¤ç¯å¢ƒå˜é‡å…è®¸è‡ªåŠ¨ä½¿ç”¨ Google æä¾›ç¨‹åºï¼Œè€Œæ— éœ€åœ¨ä»£ç ä¸­æ˜¾å¼å®ä¾‹åŒ–å®ƒã€‚

<Card>
<ParamField path="FASTMCP_SERVER_AUTH" default="æœªè®¾ç½®">
è®¾ç½®ä¸º `fastmcp.server.auth.providers.google.GoogleProvider` ä»¥ä½¿ç”¨ Google èº«ä»½éªŒè¯ã€‚
</ParamField>
</Card>

### Google ç‰¹å®šé…ç½®

è¿™äº›ç¯å¢ƒå˜é‡ä¸º Google æä¾›ç¨‹åºæä¾›é»˜è®¤å€¼ï¼Œæ— è®ºå®ƒæ˜¯æ‰‹åŠ¨å®ä¾‹åŒ–çš„è¿˜æ˜¯é€šè¿‡ `FASTMCP_SERVER_AUTH` é…ç½®çš„ã€‚

<Card>
<ParamField path="FASTMCP_SERVER_AUTH_GOOGLE_CLIENT_ID" required>
æ‚¨çš„ Google OAuth 2.0 å®¢æˆ·ç«¯ IDï¼ˆä¾‹å¦‚ï¼Œ`123456789.apps.googleusercontent.com`ï¼‰
</ParamField>

<ParamField path="FASTMCP_SERVER_AUTH_GOOGLE_CLIENT_SECRET" required>
æ‚¨çš„ Google OAuth 2.0 å®¢æˆ·ç«¯å¯†é’¥ï¼ˆä¾‹å¦‚ï¼Œ`GOCSPX-abc123...`ï¼‰
</ParamField>

<ParamField path="FASTMCP_SERVER_AUTH_GOOGLE_BASE_URL" default="http://localhost:8000">
OAuth ç«¯ç‚¹å¯è®¿é—®çš„å…¬å…± URLï¼ˆåŒ…å«ä»»ä½•æŒ‚è½½è·¯å¾„ï¼‰
</ParamField>

<ParamField path="FASTMCP_SERVER_AUTH_GOOGLE_ISSUER_URL" default="ä½¿ç”¨ BASE_URL">
ç”¨äº OAuth å…ƒæ•°æ®çš„ Issuer URLï¼ˆé»˜è®¤ç­‰äº `BASE_URL`ï¼‰ã€‚å½“æŒ‚è½½åœ¨è·¯å¾„å‰ç¼€ä¸‹æ—¶ï¼Œè¯·è®¾ç½®ä¸ºæ ¹çº§ URL ä»¥é¿å… 404 æ—¥å¿—ã€‚è¯¦è§ [HTTP éƒ¨ç½²æŒ‡å—](/zh/deployment/http#mounting-authenticated-servers)ã€‚
</ParamField>

<ParamField path="FASTMCP_SERVER_AUTH_GOOGLE_REDIRECT_PATH" default="/auth/callback">
åœ¨æ‚¨çš„ Google OAuth å®¢æˆ·ç«¯ä¸­é…ç½®çš„é‡å®šå‘è·¯å¾„
</ParamField>

<ParamField path="FASTMCP_SERVER_AUTH_GOOGLE_REQUIRED_SCOPES" default="[]">
å¿…éœ€çš„ Google ä½œç”¨åŸŸçš„é€—å·ã€ç©ºæ ¼æˆ– JSON åˆ†éš”åˆ—è¡¨ï¼ˆä¾‹å¦‚ï¼Œ`"openid,https://www.googleapis.com/auth/userinfo.email"` æˆ– `["openid", "https://www.googleapis.com/auth/userinfo.email"]`ï¼‰
</ParamField>

<ParamField path="FASTMCP_SERVER_AUTH_GOOGLE_TIMEOUT_SECONDS" default="10">
Google API è°ƒç”¨çš„ HTTP è¯·æ±‚è¶…æ—¶
</ParamField>
</Card>

ç¤ºä¾‹ `.env` æ–‡ä»¶ï¼š
```bash
# ä½¿ç”¨ Google æä¾›ç¨‹åº
FASTMCP_SERVER_AUTH=fastmcp.server.auth.providers.google.GoogleProvider

# Google OAuth å‡­æ®
FASTMCP_SERVER_AUTH_GOOGLE_CLIENT_ID=123456789.apps.googleusercontent.com
FASTMCP_SERVER_AUTH_GOOGLE_CLIENT_SECRET=GOCSPX-abc123...
FASTMCP_SERVER_AUTH_GOOGLE_BASE_URL=https://your-server.com
FASTMCP_SERVER_AUTH_GOOGLE_REQUIRED_SCOPES=openid,https://www.googleapis.com/auth/userinfo.email
```

è®¾ç½®ç¯å¢ƒå˜é‡åï¼Œæ‚¨çš„æœåŠ¡å™¨ä»£ç ç®€åŒ–ä¸ºï¼š

```python server.py
from fastmcp import FastMCP

# èº«ä»½éªŒè¯ä»ç¯å¢ƒä¸­è‡ªåŠ¨é…ç½®
mcp = FastMCP(name="Google å®‰å…¨åº”ç”¨")

@mcp.tool
async def protected_tool(query: str) -> str:
    """éœ€è¦ Google èº«ä»½éªŒè¯æ‰èƒ½è®¿é—®çš„å·¥å…·ã€‚"""
    # æ‚¨çš„å·¥å…·å®ç°åœ¨è¿™é‡Œ
    return f"å¤„ç†ç»è¿‡èº«ä»½éªŒè¯çš„è¯·æ±‚ï¼š{query}"
```