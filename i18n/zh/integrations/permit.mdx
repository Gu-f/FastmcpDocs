---
title: Permit.io èº«ä»½è®¤è¯ ğŸ¤ FastMCP
sidebarTitle: Permit.io
description: ä½¿ç”¨ Permit.io ä¸ºæ‚¨çš„ FastMCP æœåŠ¡å™¨æ·»åŠ ç»†ç²’åº¦æˆæƒ
icon: shield-check
---

ä½¿ç”¨ **[Permit.io][permit-github] æˆæƒä¸­é—´ä»¶**é€šè¿‡ä¸€è¡Œä»£ç æ·»åŠ ä¸ºæ‚¨çš„ FastMCP æœåŠ¡å™¨æ·»åŠ **åŸºäºç­–ç•¥çš„æˆæƒ**ã€‚

æ§åˆ¶ MCP å®¢æˆ·ç«¯å¯ä»¥åœ¨æ‚¨çš„æœåŠ¡å™¨ä¸ŠæŸ¥çœ‹å’Œæ‰§è¡Œçš„å·¥å…·ã€èµ„æºå’Œæç¤ºã€‚ä½¿ç”¨ Permit.io å¼ºå¤§çš„ RBACã€ABAC å’Œ REBAC åŠŸèƒ½å®šä¹‰åŠ¨æ€ç­–ç•¥ï¼Œå¹¶è·å¾—æ‰€æœ‰è®¿é—®å°è¯•å’Œè¿è§„è¡Œä¸ºçš„å…¨é¢å®¡è®¡æ—¥å¿—ã€‚

## å·¥ä½œåŸç†

åˆ©ç”¨ FastMCP çš„[ä¸­é—´ä»¶][fastmcp-middleware]ï¼ŒPermit.io ä¸­é—´ä»¶æ‹¦æˆªæ‰€æœ‰åˆ°æ‚¨æœåŠ¡å™¨çš„ MCP è¯·æ±‚ï¼Œå¹¶è‡ªåŠ¨å°† MCP æ–¹æ³•æ˜ å°„åˆ°é’ˆå¯¹æ‚¨çš„ Permit.io ç­–ç•¥çš„æˆæƒæ£€æŸ¥ï¼›æ¶µç›–æœåŠ¡å™¨æ–¹æ³•å’Œå·¥å…·æ‰§è¡Œã€‚

### ç­–ç•¥æ˜ å°„

ä¸­é—´ä»¶è‡ªåŠ¨å°† MCP æ–¹æ³•æ˜ å°„åˆ° Permit.io èµ„æºå’Œæ“ä½œï¼š

- **MCP æœåŠ¡å™¨æ–¹æ³•**ï¼ˆä¾‹å¦‚ï¼Œ`tools/list`ã€`resources/read`ï¼‰ï¼š
  - **èµ„æº**ï¼š`{server_name}_{component}`ï¼ˆä¾‹å¦‚ï¼Œ`myserver_tools`ï¼‰
  - **æ“ä½œ**ï¼šæ–¹æ³•åŠ¨è¯ï¼ˆä¾‹å¦‚ï¼Œ`list`ã€`read`ï¼‰
- **å·¥å…·æ‰§è¡Œ**ï¼ˆæ–¹æ³• `tools/call`ï¼‰ï¼š
  - **èµ„æº**ï¼š`{server_name}`ï¼ˆä¾‹å¦‚ï¼Œ`myserver`ï¼‰
  - **æ“ä½œ**ï¼šå·¥å…·åç§°ï¼ˆä¾‹å¦‚ï¼Œ`greet`ï¼‰

![Permit.io Policy Mapping Example](./images/permit/policy_mapping.png)

*ç¤ºä¾‹ï¼šåœ¨ Permit.io ä¸­ï¼Œ'Admin' è§’è‰²è¢«æˆäºˆä¸­é—´ä»¶æ˜ å°„çš„èµ„æºå’Œæ“ä½œæƒé™ã€‚ä¾‹å¦‚ï¼Œ'greet'ã€'greet-jwt' å’Œ 'login' æ˜¯ 'mcp_server' èµ„æºä¸Šçš„æ“ä½œï¼Œè€Œ 'list' æ˜¯ 'mcp_server_tools' èµ„æºä¸Šçš„æ“ä½œã€‚*

> **æ³¨æ„ï¼š**
> ä¸è¦å¿˜è®°åœ¨ Permit.io ç›®å½•ä¸­ä¸ºå¯¹æ‚¨çš„ MCP æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯çš„ç”¨æˆ·ï¼ˆä¾‹å¦‚ JWT ä¸­çš„ç”¨æˆ·ï¼‰åˆ†é…ç›¸å…³è§’è‰²ï¼ˆä¾‹å¦‚ï¼ŒAdminã€Userï¼‰ã€‚å¦‚æœæ²¡æœ‰æ­£ç¡®çš„è§’è‰²åˆ†é…ï¼Œç”¨æˆ·å°†æ— æ³•è®¿é—®æ‚¨åœ¨ç­–ç•¥ä¸­é…ç½®çš„èµ„æºå’Œæ“ä½œã€‚
>
> ![Permit.io ç›®å½•è§’è‰²åˆ†é…ç¤ºä¾‹](./images/permit/role_assignement.png)
>
> *ç¤ºä¾‹ï¼šåœ¨ Permit.io ç›®å½•ä¸­ï¼Œ'client' å’Œ 'admin' ç”¨æˆ·éƒ½è¢«åˆ†é…äº† 'Admin' è§’è‰²ï¼Œæˆäºˆä»–ä»¬æ‚¨åœ¨ç­–ç•¥æ˜ å°„ä¸­å®šä¹‰çš„æƒé™ã€‚*

æœ‰å…³è¯¦ç»†çš„ç­–ç•¥æ˜ å°„ç¤ºä¾‹å’Œé…ç½®ï¼Œè¯·å‚é˜…[è¯¦ç»†ç­–ç•¥æ˜ å°„](https://github.com/permitio/permit-fastmcp/blob/main/docs/policy-mapping.md)ã€‚

### åˆ—è¡¨æ“ä½œ

ä¸­é—´ä»¶ä½œä¸ºåˆ—è¡¨æ“ä½œï¼ˆ`tools/list`ã€`resources/list`ã€`prompts/list`ï¼‰çš„è¿‡æ»¤å™¨ï¼Œå¯¹å®¢æˆ·ç«¯éšè—æœªè¢«å®šä¹‰ç­–ç•¥æˆæƒçš„ç»„ä»¶ã€‚

```mermaid
sequenceDiagram
    participant MCPClient as MCP å®¢æˆ·ç«¯
    participant PermitMiddleware as Permit.io ä¸­é—´ä»¶
    participant MCPServer as FastMCP æœåŠ¡å™¨
    participant PermitPDP as Permit.io PDP

    MCPClient->>PermitMiddleware: MCP åˆ—è¡¨è¯·æ±‚ï¼ˆä¾‹å¦‚ï¼Œtools/listï¼‰
    PermitMiddleware->>MCPServer: MCP åˆ—è¡¨è¯·æ±‚
    MCPServer-->>PermitMiddleware: MCP åˆ—è¡¨å“åº”
    PermitMiddleware->>PermitPDP: æˆæƒæ£€æŸ¥
    PermitPDP->>PermitMiddleware: æˆæƒå†³ç­–
    PermitMiddleware-->>MCPClient: è¿‡æ»¤åçš„ MCP åˆ—è¡¨å“åº”
```

### æ‰§è¡Œæ“ä½œ

ä¸­é—´ä»¶ä½œä¸ºæ‰§è¡Œæ“ä½œï¼ˆ`tools/call`ã€`resources/read`ã€`prompts/get`ï¼‰çš„å¼ºåˆ¶æ‰§è¡Œç‚¹ï¼Œé˜»æ­¢æœªè¢«å®šä¹‰ç­–ç•¥æˆæƒçš„æ“ä½œã€‚

```mermaid
sequenceDiagram
    participant MCPClient as MCP å®¢æˆ·ç«¯
    participant PermitMiddleware as Permit.io ä¸­é—´ä»¶
    participant MCPServer as FastMCP æœåŠ¡å™¨
    participant PermitPDP as Permit.io PDP

    MCPClient->>PermitMiddleware: MCP æ‰§è¡Œè¯·æ±‚ï¼ˆä¾‹å¦‚ï¼Œtools/callï¼‰
    PermitMiddleware->>PermitPDP: æˆæƒæ£€æŸ¥
    PermitPDP->>PermitMiddleware: æˆæƒå†³ç­–
    PermitMiddleware-->>MCPClient: MCP æœªæˆæƒé”™è¯¯ï¼ˆå¦‚æœè¢«æ‹’ç»ï¼‰
    PermitMiddleware->>MCPServer: MCP æ‰§è¡Œè¯·æ±‚ï¼ˆå¦‚æœå…è®¸ï¼‰
    MCPServer-->>PermitMiddleware: MCP æ‰§è¡Œå“åº”ï¼ˆå¦‚æœå…è®¸ï¼‰
    PermitMiddleware-->>MCPClient: MCP æ‰§è¡Œå“åº”ï¼ˆå¦‚æœå…è®¸ï¼‰
```

## ä¸ºæ‚¨çš„æœåŠ¡å™¨æ·»åŠ æˆæƒ

<Note>
Permit.io æ˜¯ä¸€ä¸ªäº‘åŸç”ŸæˆæƒæœåŠ¡ã€‚æ‚¨éœ€è¦ Permit.io è´¦æˆ·å’Œæ­£åœ¨è¿è¡Œçš„ç­–ç•¥å†³ç­–ç‚¹ï¼ˆPDPï¼‰æ‰èƒ½ä½¿ä¸­é—´ä»¶æ­£å¸¸å·¥ä½œã€‚æ‚¨å¯ä»¥ä½¿ç”¨ Docker åœ¨æœ¬åœ°è¿è¡Œ PDPï¼Œæˆ–ä½¿ç”¨ Permit.io çš„äº‘ PDPã€‚
</Note>

### å…ˆå†³æ¡ä»¶

1. **Permit.io è´¦æˆ·**ï¼šåœ¨ [permit.io](https://permit.io) æ³¨å†Œ
2. **PDP è®¾ç½®**ï¼šåœ¨æœ¬åœ°è¿è¡Œ Permit.io PDP æˆ–ä½¿ç”¨äº‘ PDPï¼ˆä»… RBACï¼‰
3. **API å¯†é’¥**ï¼šä»ä»ªè¡¨æ¿è·å–æ‚¨çš„ Permit.io API å¯†é’¥

### è¿è¡Œ Permit.io PDP

ä½¿ç”¨ Docker åœ¨æœ¬åœ°è¿è¡Œ PDPï¼š

```bash
docker run -p 7766:7766 permitio/pdp:latest
```

æˆ–ä½¿ç”¨äº‘ PDP URLï¼š`https://cloudpdp.api.permit.io`

### åˆ›å»ºå¸¦æœ‰æˆæƒçš„æœåŠ¡å™¨

é¦–å…ˆï¼Œå®‰è£… `permit-fastmcp` åŒ…ï¼š

```bash
# ä½¿ç”¨ UVï¼ˆæ¨èï¼‰
uv add permit-fastmcp

# ä½¿ç”¨ pip
pip install permit-fastmcp
```

ç„¶ååˆ›å»ºä¸€ä¸ª FastMCP æœåŠ¡å™¨å¹¶æ·»åŠ  Permit.io ä¸­é—´ä»¶ï¼š

```python server.py
from fastmcp import FastMCP
from permit_fastmcp.middleware.middleware import PermitMcpMiddleware

mcp = FastMCP("å®‰å…¨çš„ FastMCP æœåŠ¡å™¨ ğŸ”’")

@mcp.tool
def greet(name: str) -> str:
    """æŒ‰åç§°é—®å€™ç”¨æˆ·"""
    return f"æ‚¨å¥½ï¼Œ{name}ï¼"

@mcp.tool
def add(a: int, b: int) -> int:
    """ä¸¤ä¸ªæ•°ç›¸åŠ """
    return a + b

# æ·»åŠ  Permit.io æˆæƒä¸­é—´ä»¶
mcp.add_middleware(PermitMcpMiddleware(
    permit_pdp_url="http://localhost:7766",
    permit_api_key="your-permit-api-key"
))

if __name__ == "__main__":
    mcp.run(transport="http")
```

### é…ç½®è®¿é—®ç­–ç•¥

åœ¨ Permit.io ä»ªè¡¨æ¿ä¸­åˆ›å»ºæ‚¨çš„æˆæƒç­–ç•¥ï¼š

1. **åˆ›å»ºèµ„æº**ï¼šå®šä¹‰åƒ `mcp_server` å’Œ `mcp_server_tools` è¿™æ ·çš„èµ„æº
2. **å®šä¹‰æ“ä½œ**ï¼šæ·»åŠ åƒ `greet`ã€`add`ã€`list`ã€`read` è¿™æ ·çš„æ“ä½œ
3. **åˆ›å»ºè§’è‰²**ï¼šå®šä¹‰åƒ `Admin`ã€`User`ã€`Guest` è¿™æ ·çš„è§’è‰²
4. **åˆ†é…æƒé™**ï¼šæˆäºˆè§’è‰²å¯¹ç‰¹å®šèµ„æºå’Œæ“ä½œçš„è®¿é—®æƒ
5. **åˆ†é…ç”¨æˆ·**ï¼šåœ¨ Permit.io ç›®å½•ä¸­ä¸ºç”¨æˆ·åˆ†é…è§’è‰²

æœ‰å…³é€æ­¥è®¾ç½®è¯´æ˜å’Œæ•…éšœæ’é™¤ï¼Œè¯·å‚é˜…[å…¥é—¨æŒ‡å—å’Œå¸¸è§é—®é¢˜](https://github.com/permitio/permit-fastmcp/blob/main/docs/getting-started.md)ã€‚

#### ç¤ºä¾‹ç­–ç•¥é…ç½®

ç­–ç•¥åœ¨ Permit.io ä»ªè¡¨æ¿ä¸­å®šä¹‰ï¼Œä½†æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ [Permit.io Terraform æä¾›ç¨‹åº](https://github.com/permitio/terraform-provider-permitio)åœ¨ä»£ç ä¸­å®šä¹‰ç­–ç•¥ã€‚


```terraform
# èµ„æº
resource "permitio_resource" "mcp_server" {
  name = "mcp_server"
  key  = "mcp_server"
  
  actions = {
    "greet" = { name = "greet" }
    "add"   = { name = "add" }
  }
}

resource "permitio_resource" "mcp_server_tools" {
  name = "mcp_server_tools"
  key  = "mcp_server_tools"
  
  actions = {
    "list" = { name = "list" }
  }
}

# è§’è‰²
resource "permitio_role" "Admin" {
  key         = "Admin"
  name        = "Admin"
  permissions = [
    "mcp_server:greet",
    "mcp_server:add", 
    "mcp_server_tools:list"
  ]
}
```

æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ [Permit.io CLI](https://github.com/permitio/permit-cli)ã€[API](https://api.permit.io/scalar) æˆ– [SDK](https://github.com/permitio/permit-python) æ¥ç®¡ç†ç­–ç•¥ï¼Œä»¥åŠç›´æ¥ç”¨ REGOï¼ˆOpen Policy Agent çš„ç­–ç•¥è¯­è¨€ï¼‰ç¼–å†™ç­–ç•¥ã€‚

æœ‰å…³åŒ…æ‹¬ ABAC å’Œ RBAC é…ç½®åœ¨å†…çš„å®Œæ•´ç­–ç•¥ç¤ºä¾‹ï¼Œè¯·å‚é˜…[ç¤ºä¾‹ç­–ç•¥](https://github.com/permitio/permit-fastmcp/tree/main/docs/example_policies)ã€‚

### èº«ä»½ç®¡ç†

ä¸­é—´ä»¶æ”¯æŒå¤šç§èº«ä»½æå–æ¨¡å¼ï¼š

- **å›ºå®šèº«ä»½**ï¼šå¯¹æ‰€æœ‰è¯·æ±‚ä½¿ç”¨å›ºå®šèº«ä»½
- **åŸºäºè¯·æ±‚å¤´**ï¼šä» HTTP è¯·æ±‚å¤´æå–èº«ä»½
- **åŸºäº JWT**ï¼šæå–å’ŒéªŒè¯ JWT ä»¤ç‰Œ
- **åŸºäºæº**ï¼šä½¿ç”¨ MCP ä¸Šä¸‹æ–‡æºå­—æ®µ

æœ‰å…³è¯¦ç»†çš„èº«ä»½æ¨¡å¼é…ç½®å’Œç¯å¢ƒå˜é‡ï¼Œè¯·å‚é˜…[èº«ä»½æ¨¡å¼å’Œç¯å¢ƒå˜é‡](https://github.com/permitio/permit-fastmcp/blob/main/docs/identity-modes.md)ã€‚

#### JWT èº«ä»½éªŒè¯ç¤ºä¾‹

```python
import os

# é…ç½® JWT èº«ä»½æå–
os.environ["PERMIT_MCP_IDENTITY_MODE"] = "jwt"
os.environ["PERMIT_MCP_IDENTITY_JWT_SECRET"] = "your-jwt-secret"

mcp.add_middleware(PermitMcpMiddleware(
    permit_pdp_url="http://localhost:7766",
    permit_api_key="your-permit-api-key"
))
```

### å¸¦æœ‰å·¥å…·å‚æ•°çš„ ABAC ç­–ç•¥

ä¸­é—´ä»¶æ”¯æŒåŸºäºå±æ€§çš„è®¿é—®æ§åˆ¶ï¼ˆABACï¼‰ç­–ç•¥ï¼Œå¯ä»¥å°†å·¥å…·å‚æ•°ä½œä¸ºå±æ€§è¿›è¡Œè¯„ä¼°ã€‚å·¥å…·å‚æ•°ä¼šè‡ªåŠ¨å±•å¹³ä¸ºå•ç‹¬çš„å±æ€§ï¼ˆä¾‹å¦‚ï¼Œ`arg_name`ã€`arg_number`ï¼‰ï¼Œç”¨äºç»†ç²’åº¦çš„ç­–ç•¥æ¡ä»¶ã€‚

![ABAC æ¡ä»¶ç¤ºä¾‹](./images/permit/abac_condition_example.png)

*ç¤ºä¾‹ï¼šåˆ›å»ºå¸¦æœ‰ `resource.arg_number greater-than 10` ç­‰æ¡ä»¶çš„åŠ¨æ€èµ„æºï¼Œä»…å½“æ•°å­—å‚æ•°è¶…è¿‡ 10 æ—¶æ‰å…è®¸ `conditional-greet` å·¥å…·ã€‚*

#### ç¤ºä¾‹ï¼šæ¡ä»¶è®¿é—®

åˆ›å»ºä¸€ä¸ªå¸¦æœ‰ `resource.arg_number greater-than 10` ç­‰æ¡ä»¶çš„åŠ¨æ€èµ„æºï¼Œä»…å½“æ•°å­—å‚æ•°è¶…è¿‡ 10 æ—¶æ‰å…è®¸ `conditional-greet` å·¥å…·ã€‚

```python
@mcp.tool
def conditional_greet(name: str, number: int) -> str:
    """ä»…å½“æ•°å­— > 10 æ—¶é—®å€™ç”¨æˆ·"""
    return f"æ‚¨å¥½ï¼Œ{name}ï¼æ‚¨çš„æ•°å­—æ˜¯ {number}"
```

![ABAC ç­–ç•¥ç¤ºä¾‹](./images/permit/abac_policy_example.png)

*ç¤ºä¾‹ï¼šAdmin è§’è‰²è¢«æˆäºˆåœ¨"Big-greets"åŠ¨æ€èµ„æºä¸Šçš„"conditional-greet"æ“ä½œè®¿é—®æƒé™ï¼Œè€Œå…¶ä»–å·¥å…·å¦‚"greet"ã€"greet-jwt"å’Œ"login"åˆ™åœ¨åŸºç¡€"mcp_server"èµ„æºä¸Šè¢«æˆäºˆæƒé™ã€‚*

æœ‰å…³å…¨é¢çš„ ABAC é…ç½®å’Œé«˜çº§ç­–ç•¥ç¤ºä¾‹ï¼Œè¯·å‚é˜…[å¸¦æœ‰å·¥å…·å‚æ•°çš„ ABAC ç­–ç•¥](https://github.com/permitio/permit-fastmcp/blob/main/docs/policy-mapping.md#abac-policies-with-tool-arguments)ã€‚

### è¿è¡ŒæœåŠ¡å™¨

æ­£å¸¸å¯åŠ¨æ‚¨çš„ FastMCP æœåŠ¡å™¨ï¼š

```bash
python server.py
```

ä¸­é—´ä»¶ç°åœ¨å°†æ‹¦æˆªæ‰€æœ‰ MCP è¯·æ±‚å¹¶æ ¹æ®æ‚¨çš„ Permit.io ç­–ç•¥è¿›è¡Œæ£€æŸ¥ã€‚è¯·æ±‚åŒ…æ‹¬é€šè¿‡é…ç½®çš„èº«ä»½æ¨¡å¼è¿›è¡Œç”¨æˆ·è¯†åˆ«ï¼Œä»¥åŠ MCP æ–¹æ³•åˆ°æˆæƒèµ„æºå’Œæ“ä½œçš„è‡ªåŠ¨æ˜ å°„ã€‚

## é«˜çº§é…ç½®

### ç¯å¢ƒå˜é‡

ä½¿ç”¨ç¯å¢ƒå˜é‡é…ç½®ä¸­é—´ä»¶ï¼š

```bash
# Permit.io é…ç½®
export PERMIT_MCP_PERMIT_PDP_URL="http://localhost:7766"
export PERMIT_MCP_PERMIT_API_KEY="your-api-key"

# èº«ä»½é…ç½®
export PERMIT_MCP_IDENTITY_MODE="jwt"
export PERMIT_MCP_IDENTITY_JWT_SECRET="your-jwt-secret"

# æ–¹æ³•é…ç½®
export PERMIT_MCP_KNOWN_METHODS='["tools/list","tools/call"]'
export PERMIT_MCP_BYPASSED_METHODS='["initialize","ping"]'

# æ—¥å¿—é…ç½®
export PERMIT_MCP_ENABLE_AUDIT_LOGGING="true"
```

æœ‰å…³æ‰€æœ‰é…ç½®é€‰é¡¹å’Œç¯å¢ƒå˜é‡çš„å®Œæ•´åˆ—è¡¨ï¼Œè¯·å‚é˜…[é…ç½®å‚è€ƒ](https://github.com/permitio/permit-fastmcp/blob/main/docs/configuration-reference.md)ã€‚

### è‡ªå®šä¹‰ä¸­é—´ä»¶é…ç½®

```python
from permit_fastmcp.middleware.middleware import PermitMcpMiddleware

middleware = PermitMcpMiddleware(
    permit_pdp_url="http://localhost:7766",
    permit_api_key="your-api-key",
    enable_audit_logging=True,
    bypass_methods=["initialize", "ping", "health/*"]
)

mcp.add_middleware(middleware)
```

æœ‰å…³é«˜çº§é…ç½®é€‰é¡¹å’Œè‡ªå®šä¹‰ä¸­é—´ä»¶æ‰©å±•ï¼Œè¯·å‚é˜…[é«˜çº§é…ç½®](https://github.com/permitio/permit-fastmcp/blob/main/docs/advanced-configuration.md)ã€‚

## ç¤ºä¾‹ï¼šå®Œæ•´çš„ JWT èº«ä»½éªŒè¯æœåŠ¡å™¨

è¯·å‚é˜…[ç¤ºä¾‹æœåŠ¡å™¨](https://github.com/permitio/permit-fastmcp/blob/main/permit_fastmcp/example_server/example.py)äº†è§£åŸºäº JWT èº«ä»½éªŒè¯çš„å®Œæ•´å®ç°ã€‚æœ‰å…³å…¶ä»–ç¤ºä¾‹å’Œä½¿ç”¨æ¨¡å¼ï¼Œè¯·å‚é˜…[ç¤ºä¾‹æœåŠ¡å™¨](https://github.com/permitio/permit-fastmcp/blob/main/permit_fastmcp/example_server/)ï¼š

```python
from fastmcp import FastMCP, Context
from permit_fastmcp.middleware.middleware import PermitMcpMiddleware
import jwt
import datetime

# é…ç½® JWT èº«ä»½æå–
os.environ["PERMIT_MCP_IDENTITY_MODE"] = "jwt"
os.environ["PERMIT_MCP_IDENTITY_JWT_SECRET"] = "mysecretkey"

mcp = FastMCP("æˆ‘çš„ MCP æœåŠ¡å™¨")

@mcp.tool
def login(username: str, password: str) -> str:
    """ç™»å½•ä»¥è·å– JWT ä»¤ç‰Œ"""
    if username == "admin" and password == "password":
        token = jwt.encode(
            {"sub": username, "exp": datetime.datetime.utcnow() + datetime.timedelta(hours=1)},
            "mysecretkey",
            algorithm="HS256"
        )
        return f"Bearer {token}"
    raise Exception("æ— æ•ˆå‡­æ®")

@mcp.tool
def greet_jwt(ctx: Context) -> str:
    """é€šè¿‡ä» JWT ä¸­æå–ç”¨æˆ·åæ¥é—®å€™ç”¨æˆ·"""
    # JWT æå–ç”±ä¸­é—´ä»¶å¤„ç†
    return "æ‚¨å¥½ï¼Œå·²è®¤è¯ç”¨æˆ·ï¼"

mcp.add_middleware(PermitMcpMiddleware(
    permit_pdp_url="http://localhost:7766",
    permit_api_key="your-permit-api-key"
))

if __name__ == "__main__":
    mcp.run(transport="http")
```

<Tip>
  æœ‰å…³è¯¦ç»†çš„ç­–ç•¥é…ç½®ã€è‡ªå®šä¹‰èº«ä»½éªŒè¯å’Œé«˜çº§éƒ¨ç½²æ¨¡å¼ï¼Œè¯·è®¿é—® [Permit.io FastMCP ä¸­é—´ä»¶
  ä»“åº“][permit-fastmcp-github]ã€‚æœ‰å…³å¸¸è§é—®é¢˜çš„æ•…éšœæ’é™¤ï¼Œè¯·å‚é˜…[æ•…éšœæ’é™¤](https://github.com/permitio/permit-fastmcp/blob/main/docs/troubleshooting.md)ã€‚
</Tip>


[permit.io]: https://www.permit.io
[permit-github]: https://github.com/permitio
[permit-fastmcp-github]: https://github.com/permitio/permit-fastmcp
[Agent.Security]: https://agent.security
[fastmcp-middleware]: /servers/middleware
