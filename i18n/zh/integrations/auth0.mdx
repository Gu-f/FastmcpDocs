---
title: Auth0 OAuth 🤝 FastMCP
sidebarTitle: Auth0
description: 使用 Auth0 OAuth 保护您的 FastMCP 服务器
icon: shield-check
tag: NEW
---

import { VersionBadge } from "/snippets/version-badge.mdx"

<VersionBadge version="2.12.4" />

本指南向您展示如何使用 **Auth0 OAuth** 保护您的 FastMCP 服务器。虽然 Auth0 支持动态客户端注册，但默认情况下未启用，因此此集成使用 [**OIDC 代理**](/zh/servers/auth/oidc-proxy) 模式来桥接 Auth0 的动态 OIDC 配置与 MCP 的身份验证需求。

## 配置

### 前提条件

开始之前，您需要：
1. 一个有权限创建应用程序的 **[Auth0 账户](https://auth0.com/)**
2. 您的 FastMCP 服务器 URL（开发环境可以是 localhost，例如 `http://localhost:8000`）

### 步骤 1：创建 Auth0 应用程序

在您的 Auth0 设置中创建一个应用程序以获取身份验证所需的凭据：

<Steps>
<Step title="导航到应用程序">
    在您的 Auth0 账户中转到 **Applications → Applications**。

    点击 **"+ Create Application"** 创建新应用程序。
</Step>

<Step title="创建您的应用程序">
    - **名称**: 选择用户能识别的名称（例如，"My FastMCP Server"）
    - **选择应用程序类型**: 选择 "Single Page Web Applications"
    - 点击 **Create** 创建应用程序
</Step>

<Step title="配置您的应用程序">
    选择您应用程序的 "Settings" 标签，然后找到 "Application URIs" 部分。

    - **Allowed Callback URLs**: 您的服务器 URL + `/auth/callback`（例如，`http://localhost:8000/auth/callback`）
    - 点击 **Save** 保存您的更改

    <Warning>
    回调 URL 必须完全匹配。默认路径是 `/auth/callback`，但您可以使用 `redirect_path` 参数自定义它。
    </Warning>

    <Tip>
    如果您想使用自定义回调路径（例如，`/auth/auth0/callback`），请确保在 Auth0 应用程序设置和配置 Auth0Provider 时的 `redirect_path` 参数中设置相同的路径。
    </Tip>
</Step>

<Step title="保存您的凭据">
    创建应用程序后，在 "Basic Information" 部分您将看到：

    - **Client ID**: 类似 `tv2ObNgaZAWWhhycr7Bz1LU2mxlnsmsB` 的公共标识符
    - **Client Secret**: 应始终安全存储的私有隐藏值

    <Tip>
    安全存储这些凭据。永远不要将它们提交到版本控制。在生产环境中使用环境变量或密钥管理器。
    </Tip>
</Step>

<Step title="选择您的受众">
  在您的 Auth0 账户中转到 **Applications → APIs**。

    - 找到您想为应用程序使用的 API
    - **API Audience**: 唯一标识 API 的 URL

    <Tip>
    将此与上述凭据一起存储。永远不要将其提交到版本控制。在生产环境中使用环境变量或密钥管理器。
    </Tip>
</Step>
</Steps>

### 步骤 2：FastMCP 配置

使用 `Auth0Provider` 创建您的 FastMCP 服务器。

```python server.py
from fastmcp import FastMCP
from fastmcp.server.auth.providers.auth0 import Auth0Provider

# Auth0Provider 使用 Auth0 OIDC 配置
auth_provider = Auth0Provider(
    config_url="https://.../.well-known/openid-configuration",  # 您的 Auth0 配置 URL
    client_id="tv2ObNgaZAWWhhycr7Bz1LU2mxlnsmsB",               # 您的 Auth0 应用程序客户端 ID
    client_secret="vPYqbjemq...",                               # 您的 Auth0 应用程序客户端密钥
    audience="https://...",                                     # 您的 Auth0 API 受众
    base_url="http://localhost:8000",                           # 必须与您的应用程序配置匹配
    # redirect_path="/auth/callback"                            # 默认值，如需要可自定义
)

mcp = FastMCP(name="Auth0 Secured App", auth=auth_provider)

# 添加一个受保护的工具来测试身份验证
@mcp.tool
async def get_token_info() -> dict:
    """返回关于 Auth0 令牌的信息。"""
    from fastmcp.server.dependencies import get_access_token

    token = get_access_token()

    return {
        "issuer": token.claims.get("iss"),
        "audience": token.claims.get("aud"),
        "scope": token.claims.get("scope")
    }
```

## 测试

### 运行服务器

使用 HTTP 传输启动您的 FastMCP 服务器以启用 OAuth 流程：

```bash
fastmcp run server.py --transport http --port 8000
```

您的服务器现在正在运行并受到 Auth0 身份验证保护。

### 使用客户端测试

创建一个与您的 Auth0 保护服务器进行身份验证的测试客户端：

```python test_client.py
from fastmcp import Client
import asyncio

async def main():
    # 客户端将自动处理 Auth0 OAuth 流程
    async with Client("http://localhost:8000/mcp/", auth="oauth") as client:
        # 首次连接将在您的浏览器中打开 Auth0 登录页面
        print("✓ 已通过 Auth0 认证！")

        # 测试受保护的工具
        result = await client.call_tool("get_token_info")
        print(f"Auth0 受众: {result['audience']}")

if __name__ == "__main__":
    asyncio.run(main())
```

当您首次运行客户端时：
1. 您的浏览器将打开 Auth0 的授权页面
2. 授权应用程序后，您将被重定向回来
3. 客户端接收令牌并可以进行身份验证请求

<Info>
客户端在本地缓存令牌，因此除非令牌过期或您明确清除缓存，否则后续运行时无需重新认证。
</Info>

## 环境变量

对于生产部署，使用环境变量而不是硬编码凭据。

### 提供者选择

设置此环境变量允许自动使用 Auth0 提供者，而无需在代码中显式实例化它。

<Card>
<ParamField path="FASTMCP_SERVER_AUTH" default="Not set">
设置为 `fastmcp.server.auth.providers.auth0.Auth0Provider` 以使用 Auth0 身份验证。
</ParamField>
</Card>

### Auth0 特定配置

这些环境变量为 Auth0 提供者提供默认值，无论是手动实例化还是通过 `FASTMCP_SERVER_AUTH` 配置。

<Card>
<ParamField path="FASTMCP_SERVER_AUTH_AUTH0_CONFIG_URL" required>
您的 Auth0 应用程序配置 URL（例如，`https://.../.well-known/openid-configuration`）
</ParamField>

<ParamField path="FASTMCP_SERVER_AUTH_AUTH0_CLIENT_ID" required>
您的 Auth0 应用程序客户端 ID（例如，`tv2ObNgaZAWWhhycr7Bz1LU2mxlnsmsB`）
</ParamField>

<ParamField path="FASTMCP_SERVER_AUTH_AUTH0_CLIENT_SECRET" required>
您的 Auth0 应用程序客户端密钥（例如，`vPYqbjemq...`）
</ParamField>

<ParamField path="FASTMCP_SERVER_AUTH_AUTH0_AUDIENCE" required>
您的 Auth0 API 受众
</ParamField>

<ParamField path="FASTMCP_SERVER_AUTH_AUTH0_BASE_URL" required>
用于 OAuth 回调的 FastMCP 服务器公共 URL
</ParamField>

<ParamField path="FASTMCP_SERVER_AUTH_AUTH0_REDIRECT_PATH" default="/auth/callback">
在您的 Auth0 应用程序中配置的重定向路径
</ParamField>

<ParamField path="FASTMCP_SERVER_AUTH_AUTH0_REQUIRED_SCOPES" default='["openid"]'>
逗号、空格或 JSON 分隔的所需 Auth0 作用域列表（例如，`openid email` 或 `["openid","email"]`）
</ParamField>
</Card>

Example `.env` file:
```bash
# 使用 Auth0 提供者
FASTMCP_SERVER_AUTH=fastmcp.server.auth.providers.auth0.Auth0Provider

# Auth0 配置和凭据
FASTMCP_SERVER_AUTH_AUTH0_CONFIG_URL=https://.../.well-known/openid-configuration
FASTMCP_SERVER_AUTH_AUTH0_CLIENT_ID=tv2ObNgaZAWWhhycr7Bz1LU2mxlnsmsB
FASTMCP_SERVER_AUTH_AUTH0_CLIENT_SECRET=vPYqbjemq...
FASTMCP_SERVER_AUTH_AUTH0_AUDIENCE=https://...
FASTMCP_SERVER_AUTH_AUTH0_BASE_URL=https://your-server.com
FASTMCP_SERVER_AUTH_AUTH0_REQUIRED_SCOPES=openid,email
```

With environment variables set, your server code simplifies to:

```python server.py
from fastmcp import FastMCP

# 身份验证自动从环境中配置
mcp = FastMCP(name="Auth0 Secured App")

@mcp.tool
async def search_logs() -> list[str]:
    """搜索服务日志。"""
    # 您的工具实现在这里
    pass
```
