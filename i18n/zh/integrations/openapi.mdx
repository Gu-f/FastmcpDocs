---
title: OpenAPI ğŸ¤ FastMCP
sidebarTitle: OpenAPI
description: ä»ä»»ä½• OpenAPI è§„èŒƒç”Ÿæˆ MCP æœåŠ¡å™¨
icon: list-tree
---

import { VersionBadge } from '/snippets/version-badge.mdx'

<VersionBadge version="2.0.0" />

<Tip>
**2.11 ä¸­çš„æ–°åŠŸèƒ½**ï¼šFastMCP æ­£åœ¨å¼•å…¥ä¸‹ä¸€ä»£ OpenAPI è§£æå™¨ã€‚æ–°è§£æå™¨åœ¨æ€§èƒ½å’Œå…¼å®¹æ€§æ–¹é¢å¤§å¹…æ”¹è¿›ï¼Œä¹Ÿæ›´å®¹æ˜“ç»´æŠ¤ã€‚è¦å¯ç”¨å®ƒï¼Œè¯·è®¾ç½®ç¯å¢ƒå˜é‡ `FASTMCP_EXPERIMENTAL_ENABLE_NEW_OPENAPI_PARSER=true`ã€‚

æ–°è§£æå™¨åœ¨ API æ–¹é¢ä¸ç°æœ‰å®ç°å¤§ä½“å…¼å®¹ï¼Œå¹¶å°†åœ¨æœªæ¥ç‰ˆæœ¬ä¸­æˆä¸ºé»˜è®¤é€‰é¡¹ã€‚æˆ‘ä»¬é¼“åŠ±æ‰€æœ‰ç”¨æˆ·åœ¨å®ƒæˆä¸ºé»˜è®¤é€‰é¡¹ä¹‹å‰æµ‹è¯•å®ƒå¹¶æŠ¥å‘Šä»»ä½•é—®é¢˜ã€‚
</Tip>

FastMCP å¯ä»¥ä»ä»»ä½• OpenAPI è§„èŒƒè‡ªåŠ¨ç”Ÿæˆ MCP æœåŠ¡å™¨ï¼Œå…è®¸ AI æ¨¡å‹é€šè¿‡ MCP åè®®ä¸ç°æœ‰ API äº¤äº’ã€‚æ— éœ€æ‰‹åŠ¨åˆ›å»ºå·¥å…·å’Œèµ„æºï¼Œæ‚¨åªéœ€æä¾› OpenAPI è§„èŒƒï¼ŒFastMCP å°±ä¼šæ™ºèƒ½åœ°å°† API ç«¯ç‚¹è½¬æ¢ä¸ºé€‚å½“çš„ MCP ç»„ä»¶ã€‚

<Tip>
ä» OpenAPI ç”Ÿæˆ MCP æœåŠ¡å™¨æ˜¯å¼€å§‹ä½¿ç”¨ FastMCP çš„å¥½æ–¹æ³•ï¼Œä½†åœ¨å®è·µä¸­ï¼Œç²¾å¿ƒè®¾è®¡å’Œç²¾å¿ƒåˆ¶ä½œçš„ MCP æœåŠ¡å™¨æ¯”è‡ªåŠ¨è½¬æ¢çš„ OpenAPI æœåŠ¡å™¨åœ¨ LLM ä¸Šå®ç°**æ˜¾è‘—æ›´å¥½çš„æ€§èƒ½**ã€‚å¯¹äºå…·æœ‰è®¸å¤šç«¯ç‚¹å’Œå‚æ•°çš„å¤æ‚ APIï¼Œè¿™ä¸€ç‚¹å°¤å…¶å¦‚æ­¤ã€‚

æˆ‘ä»¬å»ºè®®ä½¿ç”¨ FastAPI é›†æˆè¿›è¡Œå¼•å¯¼å’ŒåŸå‹è®¾è®¡ï¼Œè€Œä¸æ˜¯å°†æ‚¨çš„ API é•œåƒç»™ LLM å®¢æˆ·ç«¯ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…æ–‡ç«  [åœæ­¢å°†æ‚¨çš„ REST API è½¬æ¢ä¸º MCP](https://www.jlowin.dev/blog/stop-converting-rest-apis-to-mcp)ã€‚
</Tip>

## åˆ›å»ºæœåŠ¡å™¨

è¦å°† OpenAPI è§„èŒƒè½¬æ¢ä¸º MCP æœåŠ¡å™¨ï¼Œè¯·ä½¿ç”¨ `FastMCP.from_openapi()` ç±»æ–¹æ³•ï¼š

```python server.py
import httpx
from fastmcp import FastMCP

# ä¸ºæ‚¨çš„ API åˆ›å»º HTTP å®¢æˆ·ç«¯
client = httpx.AsyncClient(base_url="https://api.example.com")

# åŠ è½½æ‚¨çš„ OpenAPI è§„èŒƒ
openapi_spec = httpx.get("https://api.example.com/openapi.json").json()

# åˆ›å»º MCP æœåŠ¡å™¨
mcp = FastMCP.from_openapi(
    openapi_spec=openapi_spec,
    client=client,
    name="æˆ‘çš„ API æœåŠ¡å™¨"
)

if __name__ == "__main__":
    mcp.run()
```

### èº«ä»½éªŒè¯

å¦‚æœæ‚¨çš„ API éœ€è¦èº«ä»½éªŒè¯ï¼Œè¯·åœ¨ HTTP å®¢æˆ·ç«¯ä¸Šè¿›è¡Œé…ç½®ï¼š

```python
import httpx
from fastmcp import FastMCP

# Bearer ä»¤ç‰Œèº«ä»½éªŒè¯
api_client = httpx.AsyncClient(
    base_url="https://api.example.com",
    headers={"Authorization": "Bearer YOUR_TOKEN"}
)

# ä½¿ç”¨ç»è¿‡èº«ä»½éªŒè¯çš„å®¢æˆ·ç«¯åˆ›å»º MCP æœåŠ¡å™¨
mcp = FastMCP.from_openapi(
    openapi_spec=spec, 
    client=api_client,
    timeout=30.0  # æ‰€æœ‰è¯·æ±‚çš„ 30 ç§’è¶…æ—¶
)
```

## è·¯ç”±æ˜ å°„

é»˜è®¤æƒ…å†µä¸‹ï¼ŒFastMCP å°† OpenAPI è§„èŒƒä¸­çš„**æ¯ä¸ªç«¯ç‚¹**è½¬æ¢ä¸º MCP **å·¥å…·**ã€‚è¿™æä¾›äº†ä¸€ä¸ªç®€å•ã€å¯é¢„æµ‹çš„èµ·ç‚¹ï¼Œç¡®ä¿æ‚¨çš„ API çš„æ‰€æœ‰åŠŸèƒ½å¯¹ç»å¤§å¤šæ•°ä»…æ”¯æŒ MCP å·¥å…·çš„ LLM å®¢æˆ·ç«¯ç«‹å³å¯ç”¨ã€‚

è™½ç„¶è¿™æ˜¯ä¸ºäº†æœ€å¤§å…¼å®¹æ€§çš„å®ç”¨é»˜è®¤è®¾ç½®ï¼Œä½†æ‚¨å¯ä»¥è½»æ¾åœ°è‡ªå®šä¹‰æ­¤è¡Œä¸ºã€‚åœ¨å†…éƒ¨ï¼ŒFastMCP ä½¿ç”¨æœ‰åºçš„ `RouteMap` å¯¹è±¡åˆ—è¡¨æ¥ç¡®å®šå¦‚ä½•å°† OpenAPI è·¯ç”±æ˜ å°„åˆ°å„ç§ MCP ç»„ä»¶ç±»å‹ã€‚

æ¯ä¸ª `RouteMap` æŒ‡å®šæ–¹æ³•ã€æ¨¡å¼å’Œæ ‡ç­¾çš„ç»„åˆï¼Œä»¥åŠç›¸åº”çš„ MCP ç»„ä»¶ç±»å‹ã€‚æ¯ä¸ª OpenAPI è·¯ç”±éƒ½ä¼šæŒ‰é¡ºåºæ£€æŸ¥æ¯ä¸ª `RouteMap`ï¼Œç¬¬ä¸€ä¸ªåŒ¹é…æ‰€æœ‰æ¡ä»¶çš„å°†ç”¨äºç¡®å®šå…¶è½¬æ¢çš„ MCP ç±»å‹ã€‚ç‰¹æ®Šç±»å‹ `EXCLUDE` å¯ç”¨äºå®Œå…¨ä» MCP æœåŠ¡å™¨ä¸­æ’é™¤è·¯ç”±ã€‚

- **æ–¹æ³•**ï¼šè¦åŒ¹é…çš„ HTTP æ–¹æ³•ï¼ˆä¾‹å¦‚ `["GET", "POST"]` æˆ– `"*"` è¡¨ç¤ºå…¨éƒ¨ï¼‰
- **æ¨¡å¼**ï¼šç”¨äºåŒ¹é…è·¯ç”±è·¯å¾„çš„æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ï¼ˆä¾‹å¦‚ `r"^/users/.*"` æˆ– `r".*"` è¡¨ç¤ºå…¨éƒ¨ï¼‰
- **æ ‡ç­¾**ï¼šå¿…é¡»å…¨éƒ¨å­˜åœ¨çš„ OpenAPI æ ‡ç­¾é›†ã€‚ç©ºé›†åˆï¼ˆ`{}`ï¼‰æ„å‘³ç€æ²¡æœ‰æ ‡ç­¾è¿‡æ»¤ï¼Œå› æ­¤è·¯ç”±ä¸ç®¡å…¶æ ‡ç­¾å¦‚ä½•éƒ½ä¼šåŒ¹é…
- **MCP ç±»å‹**ï¼šè¦åˆ›å»ºçš„ MCP ç»„ä»¶ç±»å‹ï¼ˆ`TOOL`ã€`RESOURCE`ã€`RESOURCE_TEMPLATE` æˆ– `EXCLUDE`ï¼‰
- **MCP æ ‡ç­¾**ï¼šè¦æ·»åŠ åˆ°ä»åŒ¹é…è·¯ç”±åˆ›å»ºçš„ç»„ä»¶çš„è‡ªå®šä¹‰æ ‡ç­¾é›†

ä»¥ä¸‹æ˜¯ FastMCP çš„é»˜è®¤è§„åˆ™ï¼š

```python
from fastmcp.server.openapi import RouteMap, MCPType

DEFAULT_ROUTE_MAPPINGS = [
    # æ‰€æœ‰è·¯ç”±éƒ½æˆä¸ºå·¥å…·
    RouteMap(mcp_type=MCPType.TOOL),
]
```

<Tip>
**å®éªŒæ€§è§£æå™¨**ï¼šå¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯æ–°è§£æå™¨ï¼ˆé€šè¿‡ `FASTMCP_EXPERIMENTAL_ENABLE_NEW_OPENAPI_PARSER=true` å¯ç”¨ï¼‰ï¼Œè¯·ä»å®éªŒæ¨¡å—å¯¼å…¥ï¼š
```python
from fastmcp.experimental.server.openapi import RouteMap, MCPType
```
API æ˜¯ç›¸åŒçš„ï¼Œä½†å®ç°æä¾›äº†æ›´å¥½çš„æ€§èƒ½å’Œæ— æœåŠ¡å™¨å…¼å®¹æ€§ã€‚
</Tip>

### è‡ªå®šä¹‰è·¯ç”±æ˜ å°„

åœ¨åˆ›å»º FastMCP æœåŠ¡å™¨æ—¶ï¼Œæ‚¨å¯ä»¥é€šè¿‡æä¾›è‡ªå·±çš„ `RouteMap` å¯¹è±¡åˆ—è¡¨æ¥è‡ªå®šä¹‰è·¯ç”±è¡Œä¸ºã€‚æ‚¨çš„è‡ªå®šä¹‰æ˜ å°„åœ¨é»˜è®¤è·¯ç”±æ˜ å°„ä¹‹å‰å¤„ç†ï¼Œè·¯ç”±å°†è¢«åˆ†é…ç»™ç¬¬ä¸€ä¸ªåŒ¹é…çš„è‡ªå®šä¹‰æ˜ å°„ã€‚

ä¾‹å¦‚ï¼Œåœ¨ FastMCP 2.8.0 ä¹‹å‰ï¼ŒGET è¯·æ±‚æ ¹æ®æ˜¯å¦å…·æœ‰è·¯å¾„å‚æ•°è‡ªåŠ¨æ˜ å°„åˆ° `Resource` å’Œ `ResourceTemplate` ç»„ä»¶ã€‚ï¼ˆè¿™ä»…ä»…æ˜¯ä¸ºäº†å®¢æˆ·ç«¯å…¼å®¹æ€§åŸå› è€Œæ”¹å˜çš„ã€‚ï¼‰æ‚¨å¯ä»¥é€šè¿‡æä¾›è‡ªå®šä¹‰è·¯ç”±æ˜ å°„æ¥æ¢å¤æ­¤è¡Œä¸ºï¼š

```python
from fastmcp import FastMCP
from fastmcp.server.openapi import RouteMap, MCPType

# æ¢å¤ 2.8.0 ä¹‹å‰çš„è¯­ä¹‰æ˜ å°„
semantic_maps = [
    # å¸¦æœ‰è·¯å¾„å‚æ•°çš„ GET è¯·æ±‚æˆä¸º ResourceTemplates
    RouteMap(methods=["GET"], pattern=r".*\{.*\}.*", mcp_type=MCPType.RESOURCE_TEMPLATE),
    # æ‰€æœ‰å…¶ä»– GET è¯·æ±‚æˆä¸º Resources
    RouteMap(methods=["GET"], pattern=r".*", mcp_type=MCPType.RESOURCE),
]

mcp = FastMCP.from_openapi(
    openapi_spec=spec,
    client=client,
    route_maps=semantic_maps,
)
```

ä½¿ç”¨è¿™äº›æ˜ å°„ï¼Œ`GET` è¯·æ±‚ä¼šè¢«è¯­ä¹‰åŒ–å¤„ç†ï¼Œæ‰€æœ‰å…¶ä»–æ–¹æ³•ï¼ˆ`POST`ã€`PUT` ç­‰ï¼‰å°†è½¬å…¥é»˜è®¤è§„åˆ™å¹¶æˆä¸º `Tool`ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªæ›´å®Œæ•´çš„ç¤ºä¾‹ï¼Œä½¿ç”¨è‡ªå®šä¹‰è·¯ç”±æ˜ å°„å°† `/analytics/` ä¸‹çš„æ‰€æœ‰ `GET` ç«¯ç‚¹è½¬æ¢ä¸ºå·¥å…·ï¼ŒåŒæ—¶æ’é™¤æ‰€æœ‰ç®¡ç†å‘˜ç«¯ç‚¹å’Œæ‰€æœ‰æ ‡è®°ä¸ºâ€œinternalâ€çš„è·¯ç”±ã€‚æ‰€æœ‰å…¶ä»–è·¯ç”±å°†ç”±é»˜è®¤è§„åˆ™å¤„ç†ï¼š

```python
from fastmcp import FastMCP
from fastmcp.server.openapi import RouteMap, MCPType

mcp = FastMCP.from_openapi(
    openapi_spec=spec,
    client=client,
    route_maps=[
        # åˆ†æ `GET` ç«¯ç‚¹æ˜¯å·¥å…·
        RouteMap(
            methods=["GET"], 
            pattern=r"^/analytics/.*", 
            mcp_type=MCPType.TOOL,
        ),

        # æ’é™¤æ‰€æœ‰ç®¡ç†å‘˜ç«¯ç‚¹
        RouteMap(
            pattern=r"^/admin/.*", 
            mcp_type=MCPType.EXCLUDE,
        ),

        # æ’é™¤æ‰€æœ‰æ ‡è®°ä¸º "internal" çš„è·¯ç”±
        RouteMap(
            tags={"internal"},
            mcp_type=MCPType.EXCLUDE,
        ),
    ],
)
```

<Tip>
é»˜è®¤è·¯ç”±æ˜ å°„å§‹ç»ˆåœ¨æ‚¨çš„è‡ªå®šä¹‰æ˜ å°„ä¹‹ååº”ç”¨ï¼Œå› æ­¤æ‚¨ä¸å¿…ä¸ºæ¯ä¸ªå¯èƒ½çš„è·¯ç”±åˆ›å»ºè·¯ç”±æ˜ å°„ã€‚
</Tip>

### æ’é™¤è·¯ç”±

è¦ä» MCP æœåŠ¡å™¨ä¸­æ’é™¤è·¯ç”±ï¼Œè¯·ä½¿ç”¨è·¯ç”±æ˜ å°„å°†å®ƒä»¬åˆ†é…ç»™ `MCPType.EXCLUDE`ã€‚

æ‚¨å¯ä»¥ä½¿ç”¨æ­¤æ–¹æ³•é€šè¿‡å…·ä½“é’ˆå¯¹æ•æ„Ÿæˆ–å†…éƒ¨è·¯ç”±æ¥åˆ é™¤å®ƒä»¬ï¼š

```python
from fastmcp import FastMCP
from fastmcp.server.openapi import RouteMap, MCPType

mcp = FastMCP.from_openapi(
    openapi_spec=spec,
    client=client,
    route_maps=[
        RouteMap(pattern=r"^/admin/.*", mcp_type=MCPType.EXCLUDE),
        RouteMap(tags={"internal"}, mcp_type=MCPType.EXCLUDE),
    ],
)
```

æˆ–è€…æ‚¨å¯ä»¥ä½¿ç”¨é€šé…è§„åˆ™æ¥æ’é™¤æ‚¨çš„æ˜ å°„æœªæ˜ç¡®å¤„ç†çš„æ‰€æœ‰å†…å®¹ï¼š

```python
from fastmcp import FastMCP
from fastmcp.server.openapi import RouteMap, MCPType

mcp = FastMCP.from_openapi(
    openapi_spec=spec,
    client=client,
    route_maps=[
        # è‡ªå®šä¹‰æ˜ å°„é€»è¾‘åœ¨è¿™é‡Œ
        # ... æ‚¨çš„å…·ä½“è·¯ç”±æ˜ å°„ ...
        # æ’é™¤æ‰€æœ‰å‰©ä½™è·¯ç”±
        RouteMap(mcp_type=MCPType.EXCLUDE),
    ],
)
```

<Tip>
ä½¿ç”¨é€šé…æ’é™¤è§„åˆ™å°†é˜»æ­¢åº”ç”¨é»˜è®¤è·¯ç”±æ˜ å°„ï¼Œå› ä¸ºå®ƒå°†åŒ¹é…æ¯ä¸ªå‰©ä½™è·¯ç”±ã€‚å¦‚æœæ‚¨æƒ³è¦æ˜ç¡®å…è®¸åˆ—è¡¨ç‰¹å®šè·¯ç”±ï¼Œè¿™å¾ˆæœ‰ç”¨ã€‚
</Tip>

### é«˜çº§è·¯ç”±æ˜ å°„

<VersionBadge version="2.5.0" />

å¯¹äºéœ€è¦æ›´å¤æ‚é€»è¾‘çš„é«˜çº§ç”¨ä¾‹ï¼Œæ‚¨å¯ä»¥æä¾› `route_map_fn` å¯è°ƒç”¨å¯¹è±¡ã€‚åœ¨åº”ç”¨è·¯ç”±æ˜ å°„é€»è¾‘åï¼Œæ­¤å‡½æ•°åœ¨æ¯ä¸ªåŒ¹é…çš„è·¯ç”±åŠå…¶åˆ†é…çš„ MCP ç»„ä»¶ç±»å‹ä¸Šè¢«è°ƒç”¨ã€‚å®ƒå¯ä»¥é€‰æ‹©æ€§åœ°è¿”å›ä¸åŒçš„ç»„ä»¶ç±»å‹æ¥è¦†ç›–æ˜ å°„åˆ†é…ã€‚å¦‚æœå®ƒè¿”å› `None`ï¼Œåˆ™ä½¿ç”¨åˆ†é…çš„ç±»å‹ã€‚

é™¤äº†æ›´ç²¾ç¡®åœ°é’ˆå¯¹æ–¹æ³•ã€æ¨¡å¼å’Œæ ‡ç­¾ä¹‹å¤–ï¼Œæ­¤å‡½æ•°è¿˜å¯ä»¥è®¿é—®æœ‰å…³è·¯ç”±çš„ä»»ä½•å…¶ä»– OpenAPI å…ƒæ•°æ®ã€‚

<Tip>
`route_map_fn` **ä¼š**åœ¨åœ¨æ‚¨çš„è‡ªå®šä¹‰æ˜ å°„ä¸­åŒ¹é… `MCPType.EXCLUDE` çš„è·¯ç”±ä¸Šè¢«è°ƒç”¨ï¼Œè®©æ‚¨æœ‰æœºä¼šè¦†ç›–æ’é™¤ã€‚
</Tip>

```python
from fastmcp import FastMCP
from fastmcp.server.openapi import RouteMap, MCPType, HTTPRoute

def custom_route_mapper(route: HTTPRoute, mcp_type: MCPType) -> MCPType | None:
    """é«˜çº§è·¯ç”±ç±»å‹æ˜ å°„ã€‚"""
    # æ— è®º HTTP æ–¹æ³•å¦‚ä½•ï¼Œå°†æ‰€æœ‰ç®¡ç†å‘˜è·¯ç”±è½¬æ¢ä¸ºå·¥å…·
    if "/admin/" in route.path:
        return MCPType.TOOL

    elif "internal" in route.tags:
        return MCPType.EXCLUDE
    
    # å³ä½¿æ˜¯ POSTï¼Œä¹Ÿå°†ç”¨æˆ·è¯¦ç»†ä¿¡æ¯è·¯ç”±è½¬æ¢ä¸ºæ¨¡æ¿
    elif route.path.startswith("/users/") and route.method == "POST":
        return MCPType.RESOURCE_TEMPLATE
    
    # å¯¹æ‰€æœ‰å…¶ä»–è·¯ç”±ä½¿ç”¨é»˜è®¤å€¼
    return None

mcp = FastMCP.from_openapi(
    openapi_spec=spec,
    client=client,
    route_map_fn=custom_route_mapper,
)
```

## è‡ªå®šä¹‰

### ç»„ä»¶åç§°

<VersionBadge version="2.5.0" />

FastMCP æ ¹æ® OpenAPI è§„èŒƒè‡ªåŠ¨ç”Ÿæˆ MCP ç»„ä»¶çš„åç§°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä½¿ç”¨ OpenAPI è§„èŒƒä¸­çš„ `operationId`ï¼Œç›´åˆ°ç¬¬ä¸€ä¸ªåŒä¸‹åˆ’çº¿ï¼ˆ`__`ï¼‰ã€‚

æ‰€æœ‰ç»„ä»¶åç§°éƒ½ä¼šè‡ªåŠ¨ï¼š
- **ç¼©ç•¥åŒ–**ï¼šç©ºæ ¼å’Œç‰¹æ®Šå­—ç¬¦è¢«è½¬æ¢ä¸ºä¸‹åˆ’çº¿æˆ–åˆ é™¤
- **æˆªæ–­**ï¼šé™åˆ¶ä¸ºæœ€å¤š 56 ä¸ªå­—ç¬¦ä»¥ç¡®ä¿å…¼å®¹æ€§
- **å”¯ä¸€**ï¼šå¦‚æœå¤šä¸ªç»„ä»¶å…·æœ‰ç›¸åŒåç§°ï¼Œä¼šè‡ªåŠ¨é™„åŠ æ•°å­—ä»¥ä½¿å®ƒä»¬å”¯ä¸€

ä¸ºäº†æ›´å¥½åœ°æ§åˆ¶ç»„ä»¶åç§°ï¼Œæ‚¨å¯ä»¥æä¾›ä¸€ä¸ª `mcp_names` å­—å…¸ï¼Œå°† `operationId` å€¼æ˜ å°„åˆ°æ‚¨æ‰€éœ€çš„åç§°ã€‚`operationId` å¿…é¡»ä¸åœ¨ OpenAPI è§„èŒƒä¸­æ˜¾ç¤ºçš„å®Œå…¨ä¸€è‡´ã€‚æä¾›çš„åç§°å§‹ç»ˆä¼šè¢«ç¼©ç•¥åŒ–å’Œæˆªæ–­ã€‚

```python
mcp = FastMCP.from_openapi(
    openapi_spec=spec,
    client=client,
    mcp_names={
        "list_users__with_pagination": "user_list",
        "create_user__admin_required": "create_user", 
        "get_user_details__admin_required": "user_detail",
    }
)
```

åœ¨ `mcp_names` ä¸­æ‰¾ä¸åˆ°çš„ä»»ä½• `operationId` éƒ½å°†ä½¿ç”¨é»˜è®¤ç­–ç•¥ï¼ˆoperationId ç›´åˆ°ç¬¬ä¸€ä¸ª `__`ï¼‰ã€‚

### æ ‡ç­¾

<VersionBadge version="2.8.0" />

FastMCP æä¾›äº†å¤šç§æ–¹å¼æ¥å‘æ‚¨çš„ MCP ç»„ä»¶æ·»åŠ æ ‡ç­¾ï¼Œä½¿æ‚¨èƒ½å¤Ÿå¯¹å®ƒä»¬è¿›è¡Œåˆ†ç±»å’Œç»„ç»‡ï¼Œä»¥è·å¾—æ›´å¥½çš„å¯å‘ç°æ€§å’Œè¿‡æ»¤ã€‚æ ‡ç­¾ç”±å¤šä¸ªæ¥æºç»„åˆï¼Œåˆ›å»ºæ¯ä¸ªç»„ä»¶ä¸Šçš„æœ€ç»ˆæ ‡ç­¾é›†ã€‚

#### RouteMap æ ‡ç­¾

æ‚¨å¯ä»¥ä½¿ç”¨ `RouteMap` ä¸­çš„ `mcp_tags` å‚æ•°å‘ä»ç‰¹å®šè·¯ç”±åˆ›å»ºçš„ç»„ä»¶æ·»åŠ è‡ªå®šä¹‰æ ‡ç­¾ã€‚è¿™äº›æ ‡ç­¾å°†åº”ç”¨äºä»åŒ¹é…è¯¥ç‰¹å®šè·¯ç”±æ˜ å°„çš„è·¯ç”±åˆ›å»ºçš„æ‰€æœ‰ç»„ä»¶ã€‚

```python
from fastmcp.server.openapi import RouteMap, MCPType

mcp = FastMCP.from_openapi(
    openapi_spec=spec,
    client=client,
    route_maps=[
        # å‘æ‰€æœ‰ POST ç«¯ç‚¹æ·»åŠ è‡ªå®šä¹‰æ ‡ç­¾
        RouteMap(
            methods=["POST"],
            pattern=r".*",
            mcp_type=MCPType.TOOL,
            mcp_tags={"write-operation", "api-mutation"}
        ),
        
        # å‘è¯¦ç»†è§†å›¾ç«¯ç‚¹æ·»åŠ ä¸åŒæ ‡ç­¾
        RouteMap(
            methods=["GET"],
            pattern=r".*\{.*\}.*",
            mcp_type=MCPType.RESOURCE_TEMPLATE,
            mcp_tags={"detail-view", "parameterized"}
        ),
        
        # å‘åˆ—è¡¨ç«¯ç‚¹æ·»åŠ æ ‡ç­¾
        RouteMap(
            methods=["GET"],
            pattern=r".*",
            mcp_type=MCPType.RESOURCE,
            mcp_tags={"list-data", "collection"}
        ),
    ],
)
```

#### å…¨å±€æ ‡ç­¾

æ‚¨å¯ä»¥åœ¨åˆ›å»º MCP æœåŠ¡å™¨æ—¶æä¾› `tags` å‚æ•°æ¥å‘**æ‰€æœ‰**ç»„ä»¶æ·»åŠ æ ‡ç­¾ã€‚è¿™äº›å…¨å±€æ ‡ç­¾å°†åº”ç”¨äºä» OpenAPI è§„èŒƒåˆ›å»ºçš„æ¯ä¸ªç»„ä»¶ã€‚

```python
mcp = FastMCP.from_openapi(
    openapi_spec=spec,
    client=client,
    tags={"api-v2", "production", "external"}
)
```

#### å®¢æˆ·ç«¯å…ƒæ•°æ®ä¸­çš„ OpenAPI æ ‡ç­¾

FastMCP è‡ªåŠ¨å°†æ‚¨è§„èŒƒä¸­çš„ OpenAPI æ ‡ç­¾åŒ…å«åœ¨ç»„ä»¶çš„å…ƒæ•°æ®ä¸­ã€‚è¿™äº›æ ‡ç­¾é€šè¿‡ `_meta._fastmcp.tags` å­—æ®µå¯¹ MCP å®¢æˆ·ç«¯å¯ç”¨ï¼Œå…è®¸å®¢æˆ·ç«¯æ ¹æ®åŸå§‹ OpenAPI æ ‡è®°è¿›è¡Œè¿‡æ»¤å’Œç»„ç»‡ç»„ä»¶ï¼š

<CodeGroup>
```json {5} å¸¦æœ‰æ ‡ç­¾çš„ OpenAPI è§„èŒƒ
{
  "paths": {
    "/users": {
      "get": {
        "tags": ["users", "public"],
        "operationId": "list_users",
        "summary": "åˆ—å‡ºæ‰€æœ‰ç”¨æˆ·"
      }
    }
  }
}
```
```python {6-9} åœ¨ MCP å®¢æˆ·ç«¯ä¸­è®¿é—® OpenAPI æ ‡ç­¾
async with client:
    tools = await client.list_tools()
    for tool in tools:
        if hasattr(tool, '_meta') and tool._meta:
            # OpenAPI æ ‡ç­¾ç°åœ¨åœ¨ _fastmcp å‘½åç©ºé—´ä¸­å¯ç”¨ï¼
            fastmcp_meta = tool._meta.get('_fastmcp', {})
            openapi_tags = fastmcp_meta.get('tags', [])
            if 'users' in openapi_tags:
                print(f"æ‰¾åˆ°ä¸ç”¨æˆ·ç›¸å…³çš„å·¥å…·ï¼š{tool.name}")
```
</CodeGroup>

è¿™ä½¿å®¢æˆ·ç«¯èƒ½å¤Ÿè½»æ¾åœ°æ ¹æ®åŸå§‹ OpenAPI åˆ†ç±»ç†è§£å’Œç»„ç»‡ API ç«¯ç‚¹ã€‚

### é«˜çº§è‡ªå®šä¹‰

<VersionBadge version="2.5.0" />

é»˜è®¤æƒ…å†µä¸‹ï¼ŒFastMCP ä½¿ç”¨ OpenAPI è§„èŒƒä¸­çš„å„ç§å…ƒæ•°æ®åˆ›å»º MCP ç»„ä»¶ï¼Œä¾‹å¦‚å°† OpenAPI æè¿°åˆå¹¶åˆ° MCP ç»„ä»¶æè¿°ä¸­ã€‚

æœ‰æ—¶æ‚¨å¯èƒ½å¸Œæœ›ä»¥å„ç§æ–¹å¼ä¿®æ”¹è¿™äº› MCP ç»„ä»¶ï¼Œä¾‹å¦‚æ·»åŠ  LLM ç‰¹å®šæŒ‡ä»¤æˆ–æ ‡ç­¾ã€‚å¯¹äºç²¾ç»†çš„è‡ªå®šä¹‰ï¼Œæ‚¨å¯ä»¥åœ¨åˆ›å»º MCP æœåŠ¡å™¨æ—¶æä¾› `mcp_component_fn`ã€‚åœ¨åˆ›å»ºæ¯ä¸ª MCP ç»„ä»¶åï¼Œæ­¤å‡½æ•°åœ¨å…¶ä¸Šè¢«è°ƒç”¨ï¼Œå¹¶æœ‰æœºä¼šå°±åœ°ä¿®æ”¹å®ƒã€‚

<Tip>
æ‚¨çš„ `mcp_component_fn` åº”è¯¥å°±åœ°ä¿®æ”¹ç»„ä»¶ï¼Œè€Œä¸æ˜¯è¿”å›æ–°ç»„ä»¶ã€‚å‡½æ•°çš„ç»“æœè¢«å¿½ç•¥ã€‚
</Tip>

```python
from fastmcp.server.openapi import (
    HTTPRoute, 
    OpenAPITool, 
    OpenAPIResource, 
    OpenAPIResourceTemplate,
)

# å¦‚æœä½¿ç”¨å®éªŒæ€§è§£æå™¨ï¼Œè¯·ä»å®éªŒæ¨¡å—å¯¼å…¥ï¼š
# from fastmcp.experimental.server.openapi import (
#     HTTPRoute,
#     OpenAPITool,
#     OpenAPIResource,
#     OpenAPIResourceTemplate,
# )

def customize_components(
    route: HTTPRoute, 
    component: OpenAPITool | OpenAPIResource | OpenAPIResourceTemplate,
) -> None:
    # å‘æ‰€æœ‰ç»„ä»¶æ·»åŠ è‡ªå®šä¹‰æ ‡ç­¾
    component.tags.add("openapi")
    
    # æ ¹æ®ç»„ä»¶ç±»å‹è¿›è¡Œè‡ªå®šä¹‰
    if isinstance(component, OpenAPITool):
        component.description = f"ğŸ”§ {component.description} (via API)"
    
    if isinstance(component, OpenAPIResource):
        component.description = f"ğŸ“Š {component.description}"
        component.tags.add("data")

mcp = FastMCP.from_openapi(
    openapi_spec=spec,
    client=client,
    mcp_component_fn=customize_components,
)
```

## è¯·æ±‚å‚æ•°å¤„ç†

FastMCP æ™ºèƒ½åœ°å¤„ç† OpenAPI è¯·æ±‚ä¸­çš„ä¸åŒç±»å‹å‚æ•°ï¼š

### æŸ¥è¯¢å‚æ•°

é»˜è®¤æƒ…å†µä¸‹ï¼ŒFastMCP ä»…åŒ…å«å…·æœ‰éç©ºå€¼çš„æŸ¥è¯¢å‚æ•°ã€‚å…·æœ‰ `None` å€¼æˆ–ç©ºå­—ç¬¦ä¸²çš„å‚æ•°ä¼šè¢«è‡ªåŠ¨è¿‡æ»¤ã€‚

```python
# è°ƒç”¨æ­¤å·¥å…·æ—¶...
await client.call_tool("search_products", {
    "category": "electronics",  # âœ… åŒ…å«
    "min_price": 100,           # âœ… åŒ…å«
    "max_price": None,          # âŒ æ’é™¤
    "brand": "",                # âŒ æ’é™¤
})

# HTTP è¯·æ±‚å°†æ˜¯ï¼šGET /products?category=electronics&min_price=100
```

### è·¯å¾„å‚æ•°

è·¯å¾„å‚æ•°é€šå¸¸æ˜¯ REST API æ‰€å¿…éœ€çš„ã€‚FastMCPï¼š
- è¿‡æ»¤ `None` å€¼
- éªŒè¯æä¾›äº†æ‰€æœ‰å¿…éœ€çš„è·¯å¾„å‚æ•°
- ä¸ºç¼ºå°‘çš„å¿…éœ€å‚æ•°å¼•å‘æ¸…æ™°çš„é”™è¯¯

```python
# âœ… è¿™æœ‰æ•ˆ
await client.call_tool("get_user", {"user_id": 123})

# âŒ è¿™ä¼šå¼•å‘ï¼š"ç¼ºå°‘å¿…éœ€çš„è·¯å¾„å‚æ•°ï¼š{'user_id'}"
await client.call_tool("get_user", {"user_id": None})
```

### æ•°ç»„å‚æ•°

FastMCP æ ¹æ® OpenAPI è§„èŒƒå¤„ç†æ•°ç»„å‚æ•°ï¼š

- **æŸ¥è¯¢æ•°ç»„**ï¼šæ ¹æ® `explode` å‚æ•°è¿›è¡Œåºåˆ—åŒ–ï¼ˆé»˜è®¤ï¼š`True`ï¼‰
- **è·¯å¾„æ•°ç»„**ï¼šåºåˆ—åŒ–ä¸ºé€—å·åˆ†éš”å€¼ï¼ˆOpenAPI 'simple' æ ·å¼ï¼‰

```python
# å¸¦æœ‰ explode=true çš„æŸ¥è¯¢æ•°ç»„ï¼ˆé»˜è®¤ï¼‰
# ?tags=red&tags=blue&tags=green

# å¸¦æœ‰ explode=false çš„æŸ¥è¯¢æ•°ç»„
# ?tags=red,blue,green

# è·¯å¾„æ•°ç»„ï¼ˆå§‹ç»ˆä»¥é€—å·åˆ†éš”ï¼‰
# /items/red,blue,green
```

### è¯·æ±‚å¤´

è¯·æ±‚å¤´å‚æ•°ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºå­—ç¬¦ä¸²å¹¶åŒ…å«åœ¨ HTTP è¯·æ±‚ä¸­ã€‚