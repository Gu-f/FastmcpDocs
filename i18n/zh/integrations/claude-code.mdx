---
title: Claude Code 🤝 FastMCP
sidebarTitle: Claude Code
description: 在 Claude Code 中安装和使用 FastMCP 服务器
icon: message-smile
---

import { VersionBadge } from "/snippets/version-badge.mdx"
import { LocalFocusTip } from "/snippets/local-focus-zh.mdx"

<LocalFocusTip />

Claude Code 通过包括 STDIO、SSE 和 HTTP 在内的多种传输方法支持 MCP 服务器，允许您使用 FastMCP 服务器的自定义工具、资源和提示来扩展 Claude 的功能。

## 要求

此集成使用 STDIO 传输在本地运行您的 FastMCP 服务器。对于远程部署，您可以使用 HTTP 或 SSE 传输运行您的 FastMCP 服务器，并使用 Claude Code 的内置 MCP 管理命令直接配置它。

## 创建服务器

本指南中的示例将使用以下简单的掷骰子服务器，保存为 `server.py`。

```python server.py
import random
from fastmcp import FastMCP

mcp = FastMCP(name="骰子投掷器")

@mcp.tool
def roll_dice(n_dice: int) -> list[int]:
    """掷 `n_dice` 个六面骰子，并返回结果。"""
    return [random.randint(1, 6) for _ in range(n_dice)]

if __name__ == "__main__":
    mcp.run()
```

## 安装服务器

### FastMCP CLI
<VersionBadge version="2.10.3" />

在 Claude Code 中安装 FastMCP 服务器的最简单方法是使用 `fastmcp install claude-code` 命令。这会自动处理配置、依赖管理，并调用 Claude Code 的内置 MCP 管理系统。

```bash
fastmcp install claude-code server.py
```

安装命令支持与 `run` 命令相同的 `file.py:object` 表示法。如果未指定对象，它将自动在您的文件中查找名为 `mcp`、`server` 或 `app` 的 FastMCP 服务器对象：

```bash
# 如果您的服务器对象名为“mcp”，那么这两者就是等同的。
fastmcp install claude-code server.py
fastmcp install claude-code server.py:mcp

# 如果您的服务器有别名，请使用明确的服务器名称。
fastmcp install claude-code server.py:my_custom_server
```

该命令将使用 Claude Code 的 `claude mcp add` 命令自动配置服务器。

#### 依赖

FastMCP 为您的 Claude Code 服务器提供灵活的依赖管理选项：

**单个包**：使用 `--with` 标志指定您的服务器需要的包。您可以多次使用此标志：

```bash
fastmcp install claude-code server.py --with pandas --with requests
```

**要求文件**：如果您维护一个包含所有依赖的 `requirements.txt` 文件，请使用 `--with-requirements` 来安装它们：

```bash
fastmcp install claude-code server.py --with-requirements requirements.txt
```

**可编辑包**：对于正在开发的本地包，使用 `--with-editable` 以可编辑模式安装它们：

```bash
fastmcp install claude-code server.py --with-editable ./my-local-package
```

或者，您也可以使用一个名为 `fastmcp.json` 的配置文件（推荐使用）：

```json fastmcp.json
{
  "$schema": "https://gofastmcp.com/schemas/fastmcp_config/v1.json",
  "entrypoint": {
    "file": "server.py",
    "object": "mcp"
  },
  "environment": {
    "dependencies": ["pandas", "requests"]
  }
}
```


#### Python 版本和项目配置

使用这些选项控制您服务器的 Python 环境：

**Python 版本**：使用 `--python` 指定您的服务器需要的 Python 版本。当您的服务器需要特定的 Python 功能时，这可以确保兼容性：

```bash
fastmcp install claude-code server.py --python 3.11
```

**项目目录**：使用 `--project` 在特定的项目上下文中运行您的服务器。这告诉 `uv` 使用项目的配置文件和虚拟环境：

```bash
fastmcp install claude-code server.py --project /path/to/my-project
```

#### 环境变量

如果您的服务器需要环境变量（如 API 密钥），您必须包含它们：

```bash
fastmcp install claude-code server.py --server-name "Weather Server" \
  --env API_KEY=your-api-key \
  --env DEBUG=true
```

或者从 `.env` 文件中加载它们：

```bash
fastmcp install claude-code server.py --server-name "Weather Server" --env-file .env
```

<Warning>
**必须安装 Claude Code**。集成在默认安装位置（`~/.claude/local/claude`）查找 Claude Code CLI，并使用 `claude mcp add` 命令来注册服务器。
</Warning>

### 手动配置

为了更好地控制配置，您可以手动使用 Claude Code 的内置 MCP 管理命令。这让您可以直接控制服务器的启动方式：

```bash
# 添加一台具有自定义配置的服务器
claude mcp add dice-roller -- uv run --with fastmcp fastmcp run server.py

# 使用环境变量添加
claude mcp add weather-server -e API_KEY=secret -e DEBUG=true -- uv run --with fastmcp fastmcp run server.py

# 附加具有特定范围（本地、用户或项目）的选项
claude mcp add my-server --scope user -- uv run --with fastmcp fastmcp run server.py
```

您也可以在 Claude Code 命令中手动指定 Python 版本和项目目录：

```bash
# 使用特定的 Python 版本
claude mcp add ml-server -- uv run --python 3.11 --with fastmcp fastmcp run server.py

# 在项目目录内
claude mcp add project-server -- uv run --project /path/to/project --with fastmcp fastmcp run server.py
```

## 使用服务器

一旦您的服务器安装完成，您就可以开始在 Claude Code 中使用您的 FastMCP 服务器。

尝试问 Claude 这样的问题：

> "为我投几个骰子"

Claude 将自动检测您的 `roll_dice` 工具并使用它来满足您的请求，返回类似于以下内容：

> 我为您投一些骰子！这是您的结果：[4, 2, 6]
> 
> 您投了三个骰子，得到了 4、2 和 6！

Claude Code 现在可以访问您在 FastMCP 服务器中定义的所有工具、资源和提示。

如果您的服务器提供资源，您可以使用 `@server:protocol://resource/path` 格式的 `@` 提及来引用它们。如果您的服务器提供提示，您可以使用 `/mcp__servername__promptname` 作为旜线命令来使用它们。