---
title: ChatGPT 🤝 FastMCP
sidebarTitle: ChatGPT
description: 将 FastMCP 服务器连接到 ChatGPT Deep Research
icon: message-smile

---

ChatGPT 通过远程 HTTP 连接支持 MCP 服务器，允许您使用 FastMCP 服务器的自定义工具和知识扩展 ChatGPT 的功能。

<Note>
ChatGPT 的 MCP 集成目前仅限于 **Deep Research** 功能，不适用于一般聊天。此功能适用于 ChatGPT Pro、Team、Enterprise 和 Edu 用户。
</Note>

<Tip>
OpenAI 官方的 MCP 文档和示例是用 **FastMCP v2** 构建的！查看他们的[简单 Deep Research 风格 MCP 服务器示例](https://github.com/openai/sample-deep-research-mcp)以获得与本文档类似的快速参考，或者查看 OpenAI Cookbook 中[更完整的 Deep Research 示例](https://github.com/openai/openai-cookbook/tree/main/examples/deep_research_api/how_to_build_a_deep_research_mcp_server)，其中包括向量搜索等功能。
</Tip>

## 深度思考功能(Deep Research)

ChatGPT 的 Deep Research 功能要求 MCP 服务器是可通过互联网访问的 HTTP 端点，并包含**恰好两个特定工具**：

- **`search`**：用于搜索您的资源并返回匹配的 ID
- **`fetch`**：用于通过 ID 检索特定资源的完整内容

<Warning>
如果您的服务器没有实现具有正确签名的 `search` 和 `fetch` 工具，ChatGPT 将显示错误："This MCP server doesn't implement our specification"。两个工具都是必需的。
</Warning>

### 工具描述很重要

由于 ChatGPT 需要了解如何有效使用您的工具，**请编写详细的工具描述**。描述教会 ChatGPT 如何形成查询、使用什么参数以及从您的数据中期望什么。糟糕的描述会导致糟糕的搜索结果。

### 创建服务器

与 Deep Research 兼容的服务器必须实现这两个必需的工具：

- **`search(query: str)`** - 接受任何类型的查询并返回匹配的记录 ID
- **`fetch(id: str)`** - 接受 ID 并返回记录

**关键**：为两个工具编写详细的文档字符串。这些描述教会 ChatGPT 如何有效使用您的工具。糟糕的描述会导致糟糕的搜索结果。

`search` 工具应该接受查询（任何类型的！）并返回 ID。`fetch` 工具应该接受 ID 并返回记录。

以下是您可以调整的参考服务器实现（另请参阅 [OpenAI 的示例服务器](https://github.com/openai/sample-deep-research-mcp) 进行比较）：

```python server.py [expandable]
import json
from pathlib import Path
from dataclasses import dataclass
from fastmcp import FastMCP

@dataclass
class Record:
    id: str
    title: str
    text: str
    metadata: dict

def create_server(
    records_path: Path | str,
    name: str | None = None,
    instructions: str | None = None,
) -> FastMCP:
    """创建一个名为“FastMCP”的服务器，该服务器能够从一个 JSON 文件中搜索并获取记录。"""
    records = json.loads(Path(records_path).read_text())

    RECORDS = [Record(**r) for r in records]
    LOOKUP = {r.id: r for r in RECORDS}

    mcp = FastMCP(name=name or "Deep Research MCP", instructions=instructions)

    @mcp.tool()
    async def search(query: str):
        """
        对标题、文本和元数据进行简单的无序关键词搜索。
        在记录内容中搜索任意查询词。
        返回匹配记录的 ID 列表，以便 ChatGPT 获取。
        """
        toks = query.lower().split()
        ids = []
        for r in RECORDS:
            record_txt = " ".join(
                [r.title, r.text, " ".join(r.metadata.values())]
            ).lower()
            if any(t in record_txt for t in toks):
                ids.append(r.id)

        return {"ids": ids}

    @mcp.tool()
    async def fetch(id: str):
        """
        根据 ID 获取一条记录。
        返回完整的记录数据，以便 ChatGPT 进行分析和引用。
        """
        if id not in LOOKUP:
            raise ValueError(f"未知的记录 ID: {id}")
        return LOOKUP[id]

    return mcp

if __name__ == "__main__":
    mcp = create_server("path/to/records.json")
    mcp.run(transport="http", port=8000)
```

### 部署服务器

您的服务器必须部署到公共 URL，以便 ChatGPT 访问它。

对于开发，您可以使用 `ngrok` 等工具临时将本地运行的服务器暴露到互联网。我们将在此示例中这样做（您可能需要安装 `ngrok` 并创建一个免费账户），但您可以使用任何其他方法来部署您的服务器。

假设您将上述代码保存为 `server.py`，您可以在两个单独的终端中运行以下两个命令来部署您的服务器并将其暴露到互联网：

<CodeGroup>
```bash FastMCP server
python server.py
```

```bash ngrok
ngrok http 8000
```
</CodeGroup>

<Warning>
这会将您的未认证服务器暴露到互联网。如果您了解风险，只能在安全环境中运行此命令。
</Warning>

### 连接到 ChatGPT

将 `https://your-server-url.com` 替换为您服务器的实际 URL（例如您的 ngrok URL）。

1. 打开 ChatGPT 并转到 **Settings** → **Connectors**
2. 点击 **Add custom connector**
3. 输入您的服务器详细信息：
   - **Name**: Library Catalog
   - **URL**: 您的服务器 URL，包括路径。
        - **注意**：确保您的 URL 包含您使用的传输的正确路径。默认值是 SSE 的 /sse/（例如，https://abc123.ngrok.io/sse/）和 HTTP 的 /mcp/（例如，https://abc123.ngrok.io/mcp/）。
   - **Description**: A library catalog for searching and retrieving books

#### 测试连接

1. 在 ChatGPT 中开始新聊天
2. 点击 **Tools** → **Run deep research** 
3. 选择您的 **Library Catalog** 连接器作为源
4. 问一些问题，比如：
   - "搜索 Python 编程书籍"
   - "查找关于 AI 和机器学习的书籍"
   - "显示 Python Software Foundation 的书籍"

ChatGPT 将使用您服务器的搜索和获取工具来查找相关信息，并在其回复中引用来源。

### 故障排除

#### "This MCP server doesn't implement our specification"


如果您收到此错误，很可能是因为您的服务器没有实现所需的工具（`search` 和 `fetch`）。要纠正此问题，请确保您的服务器满足服务要求。