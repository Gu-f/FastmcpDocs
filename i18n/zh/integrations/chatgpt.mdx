---
title: ChatGPT 🤝 FastMCP
sidebarTitle: ChatGPT
description: 在聊天和深度研究模式下将 FastMCP 服务器连接到 ChatGPT
icon: message-smile
tag: NEW
---

ChatGPT 通过远程 HTTP 连接支持 MCP 服务器，有两种模式：用于交互式对话的**聊天模式**和用于全面信息检索的**深度研究模式**。

<Tip>
**聊天模式需要开发者模式**：要在常规 ChatGPT 对话中使用 MCP 服务器，您必须首先在 ChatGPT 设置中启用开发者模式。此功能适用于 ChatGPT Pro、Team、Enterprise 和 Edu 用户。
</Tip>

<Note>
OpenAI 的官方 MCP 文档和示例使用 **FastMCP v2** 构建！从他们的 [MCP 文档](https://platform.openai.com/docs/mcp) 和 [开发者模式指南](https://platform.openai.com/docs/guides/developer-mode) 了解更多。
</Note>

## 构建服务器

首先，让我们创建一个简单的 FastMCP 服务器：

```python server.py
from fastmcp import FastMCP
import random

mcp = FastMCP("Demo Server")

@mcp.tool
def roll_dice(sides: int = 6) -> int:
    """投出指定面数的骰子。"""
    return random.randint(1, sides)

if __name__ == "__main__":
    mcp.run(transport="http", port=8000)
```

### 部署您的服务器

您的服务器必须可从互联网访问。对于开发，使用 `ngrok`：

<CodeGroup>
```bash Terminal 1
python server.py
```

```bash Terminal 2
ngrok http 8000
```
</CodeGroup>

记住您的公共 URL（例如，`https://abc123.ngrok.io`）以进行后续步骤。

## 聊天模式

聊天模式让您在 ChatGPT 对话中直接使用 MCP 工具。有关最新要求，请参阅 [OpenAI 的开发者模式指南](https://platform.openai.com/docs/guides/developer-mode)。

### 添加到 ChatGPT

#### 1. 启用开发者模式

1. 打开 ChatGPT 并转到**设置** → **连接器**
2. 在**高级**下，将**开发者模式**切换为启用

#### 2. 创建连接器

1. 在**设置** → **连接器**中，点击**创建**
2. 输入：
   - **名称**：您的服务器名称
   - **服务器 URL**：`https://your-server.ngrok.io/mcp/`
3. 勾选**我信任此提供者**
4. 如需要，添加身份验证
5. 点击**创建**

<Note>
**没有开发者模式**：如果您没有搜索/获取工具，ChatGPT 将拒绝服务器。启用开发者模式后，聊天模式不需要搜索/获取工具。
</Note>

#### 3. 在聊天中使用

1. 开始新聊天
2. 点击 **+** 按钮 → **更多** → **开发者模式**
3. **启用您的 MCP 服务器连接器**（必需 - 必须在每个聊天中显式添加连接器）
4. 现在您可以使用您的工具：

使用示例：
- "投出一个 20 面骰子"
- "投骰子"（使用默认 6 面）

<Tip>
连接器必须在每个聊天会话中通过开发者模式显式启用。一旦添加，它在整个对话期间保持活跃。
</Tip>

### 跳过确认

使用 `annotations={"readOnlyHint": True}` 为只读工具跳过确认提示：

```python
@mcp.tool(annotations={"readOnlyHint": True})
def get_status() -> str:
    """检查系统状态。"""
    return "所有系统运行正常"

@mcp.tool()  # 无注释 - ChatGPT 可能会要求确认
def delete_item(id: str) -> str:
    """删除一个项目。"""
    return f"已删除 {id}"
```

## 深度研究模式

深度研究模式提供带有引用的系统性信息检索。有关最新的深度研究规范，请参阅 [OpenAI 的 MCP 文档](https://platform.openai.com/docs/mcp)。

<Warning>
**需要搜索和获取工具**：在没有开发者模式的情况下，ChatGPT 将拒绝任何没有 `search` 和 `fetch` 工具的服务器。即使在开发者模式下，深度研究也只使用这两个工具。
</Warning>

### 工具实现

深度研究工具必须遵循此模式：

```python
@mcp.tool()
def search(query: str) -> dict:
    """
    搜索与查询匹配的记录。
    必须返回 {"ids": [字符串 ID 列表]}
    """
    # 您的搜索逻辑
    matching_ids = ["id1", "id2", "id3"]
    return {"ids": matching_ids}

@mcp.tool()
def fetch(id: str) -> dict:
    """
    按 ID 获取完整记录。
    返回完整的记录数据供 ChatGPT 分析。
    """
    # 您的获取逻辑
    return {
        "id": id,
        "title": "记录标题",
        "content": "完整记录内容...",
        "metadata": {"author": "Jane Doe", "date": "2024"}
    }
```

### 使用深度研究

1. 确保您的服务器已添加到 ChatGPT 的连接器（与聊天模式相同）
2. 开始新聊天
3. 点击 **+** → **深度研究**
4. 选择您的 MCP 服务器作为源
5. 提出研究问题

ChatGPT 将使用您的 `search` 和 `fetch` 工具来查找并引用相关信息。

