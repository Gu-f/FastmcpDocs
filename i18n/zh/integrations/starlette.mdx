---
title: Starlette / ASGI ğŸ¤ FastMCP
sidebarTitle: Starlette / ASGI
description: å°† FastMCP æœåŠ¡å™¨é›†æˆåˆ° ASGI åº”ç”¨ç¨‹åºä¸­
icon: server
---

import { VersionBadge } from '/snippets/version-badge.mdx'

<VersionBadge version="2.3.1" />

FastMCP æœåŠ¡å™¨å¯ä»¥é›†æˆåˆ°ç°æœ‰çš„ ASGI åº”ç”¨ç¨‹åºä¸­ï¼Œå…è®¸æ‚¨ä¸º Web åº”ç”¨ç¨‹åºæ·»åŠ  MCP åŠŸèƒ½ã€‚è¿™å¯¹ä»¥ä¸‹åœºæ™¯å¾ˆæœ‰ç”¨ï¼š

- ä¸ºç°æœ‰ç½‘ç«™æˆ– API æ·»åŠ  MCP åŠŸèƒ½
- åœ¨ç‰¹å®š URL è·¯å¾„ä¸‹æŒ‚è½½ MCP æœåŠ¡å™¨
- åœ¨å•ä¸ªåº”ç”¨ç¨‹åºä¸­ç»„åˆå¤šä¸ªæœåŠ¡
- åˆ©ç”¨ç°æœ‰çš„èº«ä»½éªŒè¯å’Œä¸­é—´ä»¶

## åŸºæœ¬ç”¨æ³•

è¦å°† FastMCP æœåŠ¡å™¨é›†æˆåˆ° ASGI åº”ç”¨ç¨‹åºä¸­ï¼Œè¯·ä½¿ç”¨ `http_app()` æ–¹æ³•è·å– Starlette åº”ç”¨ç¨‹åºå®ä¾‹ï¼š

<Tip>
`http_app()` æ–¹æ³•æ˜¯ FastMCP 2.3.2 ä¸­çš„æ–°åŠŸèƒ½ã€‚åœ¨è¾ƒæ—§ç‰ˆæœ¬ä¸­ï¼Œå¯¹äº SSE ä¼ è¾“ä½¿ç”¨ `sse_app()`ï¼Œå¯¹äºå¯æµå¼ HTTP ä¼ è¾“ä½¿ç”¨ `streamable_http_app()`ã€‚
</Tip>

```python
from fastmcp import FastMCP

mcp = FastMCP("æˆ‘çš„æœåŠ¡å™¨")

@mcp.tool
def hello(name: str) -> str:
    return f"æ‚¨å¥½ï¼Œ{name}ï¼"

# è·å–å¯æµå¼ HTTP ä¼ è¾“çš„ Starlette åº”ç”¨ç¨‹åºå®ä¾‹ï¼ˆæ¨èï¼‰
http_app = mcp.http_app()

# ç”¨äºä¼ ç»Ÿ SSE ä¼ è¾“ï¼ˆå·²å¼ƒç”¨ï¼‰
sse_app = mcp.http_app(transport="sse")
```

è¿”å›çš„ Starlette åº”ç”¨ç¨‹åºå¯ä»¥ä¸å…¶ä»–å…¼å®¹ ASGI çš„ Web æ¡†æ¶é›†æˆã€‚MCP æœåŠ¡å™¨çš„ç«¯ç‚¹åœ¨å¯æµå¼ HTTP ä¼ è¾“ä¸­æŒ‚è½½åœ¨ `/mcp/`ï¼Œåœ¨ SSE ä¼ è¾“ä¸­æŒ‚è½½åœ¨ `/sse/`ã€‚

### é…ç½®é€‰é¡¹

æ‚¨å¯ä»¥è‡ªå®šä¹‰ç«¯ç‚¹è·¯å¾„å¹¶è®¿é—® FastMCP æœåŠ¡å™¨å®ä¾‹ï¼š

```python
# è‡ªå®šä¹‰ç«¯ç‚¹è·¯å¾„
http_app = mcp.http_app(path="/custom-mcp-path")

# ä»ä¸­é—´ä»¶/è·¯ç”±è®¿é—® FastMCP æœåŠ¡å™¨
# æœåŠ¡å™¨å¯é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¿é—®ï¼šrequest.app.state.fastmcp_server
```

### æ·»åŠ è‡ªå®šä¹‰è·¯ç”±

æ‚¨å¯ä»¥ä½¿ç”¨ `@custom_route` è£…é¥°å™¨ç›´æ¥å‘ FastMCP æœåŠ¡å™¨æ·»åŠ è‡ªå®šä¹‰ Web è·¯ç”±ï¼š

```python
from fastmcp import FastMCP
from starlette.requests import Request
from starlette.responses import JSONResponse

mcp = FastMCP("æˆ‘çš„æœåŠ¡å™¨")

@mcp.custom_route("/api/status", methods=["GET"])
async def get_status(request: Request):
    return JSONResponse({"server": "running"})

http_app = mcp.http_app()
```

#### å¥åº·æ£€æŸ¥ç«¯ç‚¹

å¥åº·æ£€æŸ¥é€šå¸¸ç”¨äºç›‘æ§å’Œè´Ÿè½½å‡è¡¡ï¼š

```python
from fastmcp import FastMCP
from starlette.requests import Request
from starlette.responses import JSONResponse

mcp = FastMCP("æˆ‘çš„æœåŠ¡å™¨")

@mcp.custom_route("/health", methods=["GET"])
async def health_check(request: Request):
    return JSONResponse({"status": "healthy"})

http_app = mcp.http_app()
```

å¥åº·æ£€æŸ¥ç«¯ç‚¹å°†åœ¨ `/health` å¤„å¯ç”¨ï¼Œä¸ä½äº `/mcp/` çš„ MCP ç«¯ç‚¹å¹¶åˆ—ã€‚

## Starlette é›†æˆ

åœ¨å¦ä¸€ä¸ª Starlette åº”ç”¨ç¨‹åºä¸­æŒ‚è½½æ‚¨çš„ FastMCP æœåŠ¡å™¨ï¼š

```python
from fastmcp import FastMCP
from starlette.applications import Starlette
from starlette.routing import Mount

# åˆ›å»ºæ‚¨çš„ FastMCP æœåŠ¡å™¨
mcp = FastMCP("æˆ‘çš„æœåŠ¡å™¨")

@mcp.tool
def analyze(data: str) -> dict:
    return {"result": f"åˆ†æç»“æœï¼š{data}"}

# åˆ›å»º ASGI åº”ç”¨ç¨‹åº
mcp_app = mcp.http_app(path='/mcp')

# åˆ›å»º Starlette åº”ç”¨ç¨‹åºå¹¶æŒ‚è½½ MCP æœåŠ¡å™¨
app = Starlette(
    routes=[
        Mount("/mcp-server", app=mcp_app),
        # æ ¹éœ€æ·»åŠ å…¶ä»–è·¯ç”±
    ],
    lifespan=mcp_app.lifespan,
)
```

MCP ç«¯ç‚¹å°†åœ¨ç”Ÿæˆçš„ Starlette åº”ç”¨ç¨‹åºçš„ `/mcp-server/mcp/` å¤„å¯ç”¨ã€‚

<Warning>
å¯¹äºå¯æµå¼ HTTP ä¼ è¾“ï¼Œæ‚¨**å¿…é¡»**å°†ç”Ÿå‘½å‘¨æœŸä¸Šä¸‹æ–‡ä» FastMCP åº”ç”¨ç¨‹åºä¼ é€’ç»™ç”Ÿæˆçš„ Starlette åº”ç”¨ç¨‹åºï¼Œå› ä¸ºåµŒå¥—çš„ç”Ÿå‘½å‘¨æœŸä¸ä¼šè¢«è¯†åˆ«ã€‚å¦åˆ™ï¼ŒFastMCP æœåŠ¡å™¨çš„ä¼šè¯ç®¡ç†å™¨å°†ä¸ä¼šæ­£ç¡®åˆå§‹åŒ–ã€‚
</Warning>

### åµŒå¥—æŒ‚è½½

æ‚¨å¯ä»¥é€šè¿‡åµŒå¥—æŒ‚è½½åˆ›å»ºå¤æ‚çš„è·¯ç”±ç»“æ„ï¼š

```python
from fastmcp import FastMCP
from starlette.applications import Starlette
from starlette.routing import Mount

# åˆ›å»ºæ‚¨çš„ FastMCP æœåŠ¡å™¨
mcp = FastMCP("æˆ‘çš„æœåŠ¡å™¨")

# åˆ›å»º ASGI åº”ç”¨ç¨‹åº
mcp_app = mcp.http_app(path='/mcp')

# åˆ›å»ºåµŒå¥—åº”ç”¨ç¨‹åºç»“æ„
inner_app = Starlette(routes=[Mount("/inner", app=mcp_app)])
app = Starlette(
    routes=[Mount("/outer", app=inner_app)],
    lifespan=mcp_app.lifespan,
)
```

åœ¨æ­¤è®¾ç½®ä¸­ï¼ŒMCP æœåŠ¡å™¨å¯åœ¨ `/outer/inner/mcp/` è·¯å¾„ä¸‹è®¿é—®ã€‚

## è‡ªå®šä¹‰ä¸­é—´ä»¶

<VersionBadge version="2.3.2" />

é€šè¿‡ä¼ é€’ä¸­é—´ä»¶å®ä¾‹åˆ—è¡¨ï¼Œå‘æ‚¨çš„ FastMCP ASGI åº”ç”¨ç¨‹åºæ·»åŠ è‡ªå®šä¹‰ Starlette ä¸­é—´ä»¶ï¼š

```python
from fastmcp import FastMCP
from starlette.middleware import Middleware
from starlette.middleware.cors import CORSMiddleware

# åˆ›å»ºæ‚¨çš„ FastMCP æœåŠ¡å™¨
mcp = FastMCP("æˆ‘çš„æœåŠ¡å™¨")

# å®šä¹‰è‡ªå®šä¹‰ä¸­é—´ä»¶
custom_middleware = [
    Middleware(
        CORSMiddleware,
        allow_origins=["*"],
        allow_methods=["*"],
        allow_headers=["*"],
    )
]

# åˆ›å»ºå¸¦æœ‰ä¸­é—´ä»¶çš„ ASGI åº”ç”¨ç¨‹åº
http_app = mcp.http_app(custom_middleware=custom_middleware)
```

## è¿è¡ŒæœåŠ¡å™¨

è¦è¿è¡Œæ‚¨çš„ ASGI åº”ç”¨ç¨‹åºï¼Œè¯·ä½¿ç”¨åƒ `uvicorn` è¿™æ ·çš„ ASGI æœåŠ¡å™¨ï¼š

```python
import uvicorn

if __name__ == "__main__":
    uvicorn.run(app, host="0.0.0.0", port=8000)
```

æˆ–ä»å‘½ä»¤è¡Œï¼š

```bash
uvicorn path.to.your.app:app --host 0.0.0.0 --port 8000
```

## æ¡†æ¶ç‰¹å®šé›†æˆ

### FastAPI

å¯¹äº FastAPI ç‰¹å®šçš„é›†æˆæ¨¡å¼ï¼ŒåŒ…æ‹¬å°† MCP æœåŠ¡å™¨æŒ‚è½½åˆ° FastAPI åº”ç”¨ç¨‹åºä¸­å’Œä» FastAPI åº”ç”¨ç¨‹åºç”Ÿæˆ MCP æœåŠ¡å™¨ï¼Œè¯·å‚é˜… [FastAPI é›†æˆæŒ‡å—](/zh/integrations/fastapi)ã€‚

### å…¶ä»– ASGI æ¡†æ¶

è¿™é‡Œæ˜¾ç¤ºçš„æ¨¡å¼é€‚ç”¨äºä»»ä½•å…¼å®¹ ASGI çš„æ¡†æ¶ã€‚å…³é”®è¦æ±‚æ˜¯ï¼š

1. åœ¨æ‚¨æ‰€éœ€çš„è·¯å¾„ä¸‹æŒ‚è½½ FastMCP ASGI åº”ç”¨ç¨‹åº
2. å°†ç”Ÿå‘½å‘¨æœŸä¸Šä¸‹æ–‡ä¼ é€’ç»™æ‚¨çš„æ ¹åº”ç”¨ç¨‹åº
3. é…ç½®ä»»ä½•å¿…è¦çš„ä¸­é—´ä»¶æˆ–èº«ä»½éªŒè¯

