---
title: Azure (Microsoft Entra) OAuth ğŸ¤ FastMCP
sidebarTitle: Azure
description: ä½¿ç”¨ Azure/Microsoft Entra OAuth ä¿æŠ¤æ‚¨çš„ FastMCP æœåŠ¡å™¨
icon: microsoft
tag: NEW
---

import { VersionBadge } from "/snippets/version-badge.mdx"

<VersionBadge version="2.12.0" />

æœ¬æŒ‡å—å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•ä½¿ç”¨ **Azure OAuth**ï¼ˆMicrosoft Entra IDï¼‰ä¿æŠ¤æ‚¨çš„ FastMCP æœåŠ¡å™¨ã€‚ç”±äº Azure ä¸æ”¯æŒåŠ¨æ€å®¢æˆ·ç«¯æ³¨å†Œï¼Œæ­¤é›†æˆä½¿ç”¨ [**OAuth ä»£ç†**](/zh/servers/auth/oauth-proxy) æ¨¡å¼æ¥è¿æ¥ Azure çš„ä¼ ç»Ÿ OAuth ä¸ MCP çš„èº«ä»½éªŒè¯è¦æ±‚ã€‚

## é…ç½®

### å…ˆå†³æ¡ä»¶

åœ¨å¼€å§‹ä¹‹å‰ï¼Œæ‚¨éœ€è¦ï¼š
1. ä¸€ä¸ªå…·æœ‰åˆ›å»ºåº”ç”¨æ³¨å†Œæƒé™çš„ **[Azure è´¦æˆ·](https://portal.azure.com/)**
2. æ‚¨çš„ FastMCP æœåŠ¡å™¨ URLï¼ˆå¼€å‘æ—¶å¯ä»¥æ˜¯ localhostï¼Œä¾‹å¦‚ `http://localhost:8000`ï¼‰
3. æ‚¨çš„ Azure ç§Ÿæˆ· IDï¼ˆåœ¨ Azure é—¨æˆ·çš„ Microsoft Entra ID ä¸‹å¯ä»¥æ‰¾åˆ°ï¼‰

### ç¬¬ 1 æ­¥ï¼šåˆ›å»º Azure åº”ç”¨æ³¨å†Œ

åœ¨ Azure é—¨æˆ·ä¸­åˆ›å»ºåº”ç”¨æ³¨å†Œä»¥è·å–èº«ä»½éªŒè¯æ‰€éœ€çš„å‡­æ®ï¼š

<Steps>
<Step title="å¯¼èˆªåˆ°åº”ç”¨æ³¨å†Œ">
    è½¬åˆ° [Azure é—¨æˆ·](https://portal.azure.com)å¹¶å¯¼èˆªåˆ° **Microsoft Entra ID â†’ åº”ç”¨æ³¨å†Œ**ã€‚
    
    ç‚¹å‡» **"æ–°æ³¨å†Œ"** åˆ›å»ºæ–°åº”ç”¨ç¨‹åºã€‚
</Step>

<Step title="é…ç½®æ‚¨çš„åº”ç”¨ç¨‹åº">
    å¡«å†™åº”ç”¨ç¨‹åºè¯¦ç»†ä¿¡æ¯ï¼š
    
    - **åç§°**ï¼šé€‰æ‹©ç”¨æˆ·å¯ä»¥è¯†åˆ«çš„åç§°ï¼ˆä¾‹å¦‚ï¼Œ"æˆ‘çš„ FastMCP æœåŠ¡å™¨"ï¼‰
    - **æ”¯æŒçš„è´¦æˆ·ç±»å‹**ï¼šæ ¹æ®æ‚¨çš„éœ€è¦é€‰æ‹©ï¼š
      - **å•ç§Ÿæˆ·**ï¼šä»…æ‚¨ç»„ç»‡ä¸­çš„ç”¨æˆ·
      - **å¤šç§Ÿæˆ·**ï¼šä»»ä½• Microsoft Entra ç›®å½•ä¸­çš„ç”¨æˆ·
      - **å¤šç§Ÿæˆ· + ä¸ªäººè´¦æˆ·**ï¼šä»»ä½• Microsoft è´¦æˆ·
    - **é‡å®šå‘ URI**ï¼šé€‰æ‹© "Web" å¹¶è¾“å…¥æ‚¨çš„æœåŠ¡å™¨ URL + `/auth/callback`ï¼ˆä¾‹å¦‚ï¼Œ`http://localhost:8000/auth/callback`ï¼‰
    
    <Warning>
    é‡å®šå‘ URI å¿…é¡»å®Œå…¨åŒ¹é…ã€‚é»˜è®¤è·¯å¾„æ˜¯ `/auth/callback`ï¼Œä½†æ‚¨å¯ä»¥ä½¿ç”¨ `redirect_path` å‚æ•°è¿›è¡Œè‡ªå®šä¹‰ã€‚å¯¹äºæœ¬åœ°å¼€å‘ï¼ŒAzure å…è®¸ `http://localhost` URLã€‚å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œæ‚¨å¿…é¡»ä½¿ç”¨ HTTPSã€‚
    </Warning>
    
    <Tip>
    å¦‚æœæ‚¨æƒ³ä½¿ç”¨è‡ªå®šä¹‰å›è°ƒè·¯å¾„ï¼ˆä¾‹å¦‚ï¼Œ`/auth/azure/callback`ï¼‰ï¼Œè¯·ç¡®ä¿åœ¨ Azure åº”ç”¨æ³¨å†Œå’Œé…ç½® AzureProvider æ—¶çš„ `redirect_path` å‚æ•°ä¸­è®¾ç½®ç›¸åŒçš„è·¯å¾„ã€‚
    </Tip>
</Step>

<Step title="åˆ›å»ºå®¢æˆ·ç«¯å¯†é’¥">
    æ³¨å†Œåï¼Œåœ¨æ‚¨çš„åº”ç”¨è®¾ç½®ä¸­å¯¼èˆªåˆ° **è¯ä¹¦å’Œå¯†é’¥**ã€‚
    
    - ç‚¹å‡» **"æ–°å®¢æˆ·ç«¯å¯†é’¥"**
    - æ·»åŠ æè¿°ï¼ˆä¾‹å¦‚ï¼Œ"FastMCP æœåŠ¡å™¨"ï¼‰
    - é€‰æ‹©è¿‡æœŸæ—¶é—´
    - ç‚¹å‡» **"æ·»åŠ "**
    
    <Warning>
    ç«‹å³å¤åˆ¶å¯†é’¥å€¼ - å®ƒä¸ä¼šå†æ¬¡æ˜¾ç¤ºï¼å¦‚æœä¸¢å¤±ï¼Œæ‚¨éœ€è¦åˆ›å»ºæ–°çš„å¯†é’¥ã€‚
    </Warning>
</Step>

<Step title="è®°å½•æ‚¨çš„å‡­æ®">
    ä»æ‚¨çš„åº”ç”¨æ³¨å†Œçš„ **æ¦‚è§ˆ** é¡µé¢ï¼Œè®°å½•ï¼š
    
    - **åº”ç”¨ç¨‹åºï¼ˆå®¢æˆ·ç«¯ï¼‰ID**ï¼šåƒ `835f09b6-0f0f-40cc-85cb-f32c5829a149` è¿™æ ·çš„ UUID
    - **ç›®å½•ï¼ˆç§Ÿæˆ·ï¼‰ID**ï¼šåƒ `08541b6e-646d-43de-a0eb-834e6713d6d5` è¿™æ ·çš„ UUID
    - **å®¢æˆ·ç«¯å¯†é’¥**ï¼šæ‚¨åœ¨ä¸Šä¸€æ­¥ä¸­å¤åˆ¶çš„å€¼
    
    <Tip>
    å®‰å…¨å­˜å‚¨è¿™äº›å‡­æ®ã€‚æ°¸è¿œä¸è¦å°†å®ƒä»¬æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–å¯†é’¥ç®¡ç†å™¨ã€‚
    </Tip>
</Step>
</Steps>

### ç¬¬ 2 æ­¥ï¼šFastMCP é…ç½®

ä½¿ç”¨ `AzureProvider` åˆ›å»ºæ‚¨çš„ FastMCP æœåŠ¡å™¨ï¼Œå®ƒä¼šè‡ªåŠ¨å¤„ç† Azure çš„ OAuth æµç¨‹ï¼š

```python server.py
from fastmcp import FastMCP
from fastmcp.server.auth.providers.azure import AzureProvider

# AzureProvider å¤„ç† Azure çš„ä»¤ç‰Œæ ¼å¼å’ŒéªŒè¯
auth_provider = AzureProvider(
    client_id="835f09b6-0f0f-40cc-85cb-f32c5829a149",  # æ‚¨çš„ Azure åº”ç”¨å®¢æˆ·ç«¯ ID
    client_secret="your-client-secret",                 # æ‚¨çš„ Azure åº”ç”¨å®¢æˆ·ç«¯å¯†é’¥
    tenant_id="08541b6e-646d-43de-a0eb-834e6713d6d5", # æ‚¨çš„ Azure ç§Ÿæˆ· IDï¼ˆå¿…éœ€ï¼‰
    base_url="http://localhost:8000",                   # å¿…é¡»ä¸æ‚¨çš„åº”ç”¨æ³¨å†ŒåŒ¹é…
    required_scopes=["User.Read", "email", "openid", "profile"],  # Microsoft Graph æƒé™
    # redirect_path="/auth/callback"                  # é»˜è®¤å€¼ï¼Œå¦‚éœ€å¯è‡ªå®šä¹‰
)

mcp = FastMCP(name="Azure Secured App", auth=auth_provider)

# æ·»åŠ å—ä¿æŠ¤çš„å·¥å…·æ¥æµ‹è¯•èº«ä»½éªŒè¯
@mcp.tool
async def get_user_info() -> dict:
    """è¿”å›ç»è¿‡èº«ä»½éªŒè¯çš„ Azure ç”¨æˆ·ä¿¡æ¯ã€‚"""
    from fastmcp.server.dependencies import get_access_token
    
    token = get_access_token()
    # AzureProvider åœ¨ä»¤ç‰Œå£°æ˜ä¸­å­˜å‚¨ç”¨æˆ·æ•°æ®
    return {
        "azure_id": token.claims.get("sub"),
        "email": token.claims.get("email"),
        "name": token.claims.get("name"),
        "job_title": token.claims.get("job_title"),
        "office_location": token.claims.get("office_location")
    }
```

<Note>
**é‡è¦**ï¼š`tenant_id` å‚æ•°æ˜¯ **å¿…éœ€çš„**ã€‚ç”±äºå®‰å…¨è¦æ±‚ï¼ŒAzure ä¸å†æ”¯æŒä¸ºæ–°åº”ç”¨ç¨‹åºä½¿ç”¨ "common"ã€‚æ‚¨å¿…é¡»ä½¿ç”¨ä»¥ä¸‹ä¹‹ä¸€ï¼š

- **æ‚¨çš„ç‰¹å®šç§Ÿæˆ· ID**ï¼šåœ¨ Azure é—¨æˆ·ä¸­æ‰¾åˆ°ï¼ˆä¾‹å¦‚ï¼Œ`08541b6e-646d-43de-a0eb-834e6713d6d5`ï¼‰
- **"organizations"**ï¼šä»…é™å·¥ä½œå’Œå­¦æ ¡è´¦æˆ·
- **"consumers"**ï¼šä»…é™ä¸ªäºº Microsoft è´¦æˆ·

æ¨èä½¿ç”¨æ‚¨çš„ç‰¹å®šç§Ÿæˆ· ID ä»¥è·å¾—æ›´å¥½çš„å®‰å…¨æ€§å’Œæ§åˆ¶ã€‚
</Note>

## æµ‹è¯•

### è¿è¡ŒæœåŠ¡å™¨

ä½¿ç”¨ HTTP ä¼ è¾“å¯åŠ¨æ‚¨çš„ FastMCP æœåŠ¡å™¨ä»¥å¯ç”¨ OAuth æµç¨‹ï¼š

```bash
fastmcp run server.py --transport http --port 8000
```

æ‚¨çš„æœåŠ¡å™¨ç°åœ¨æ­£åœ¨è¿è¡Œå¹¶å—åˆ° Azure OAuth èº«ä»½éªŒè¯çš„ä¿æŠ¤ã€‚

### ä½¿ç”¨å®¢æˆ·ç«¯æµ‹è¯•

åˆ›å»ºä¸€ä¸ªä¸æ‚¨çš„ Azure ä¿æŠ¤æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯çš„æµ‹è¯•å®¢æˆ·ç«¯ï¼š

```python test_client.py
from fastmcp import Client
import asyncio

async def main():
    # å®¢æˆ·ç«¯å°†è‡ªåŠ¨å¤„ç† Azure OAuth
    async with Client("http://localhost:8000/mcp/", auth="oauth") as client:
        # é¦–æ¬¡è¿æ¥å°†åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ Azure ç™»å½•
        print("âœ“ å·²é€šè¿‡ Azure èº«ä»½éªŒè¯ï¼")
        
        # æµ‹è¯•å—ä¿æŠ¤çš„å·¥å…·
        result = await client.call_tool("get_user_info")
        print(f"Azure ç”¨æˆ·ï¼š{result['email']}")
        print(f"å§“åï¼š{result['name']}")

if __name__ == "__main__":
    asyncio.run(main())
```

å½“æ‚¨é¦–æ¬¡è¿è¡Œå®¢æˆ·ç«¯æ—¶ï¼š
1. æ‚¨çš„æµè§ˆå™¨å°†æ‰“å¼€ Microsoft çš„æˆæƒé¡µé¢
2. ä½¿ç”¨æ‚¨çš„ Microsoft è´¦æˆ·ç™»å½•ï¼ˆæ ¹æ®æ‚¨çš„ç§Ÿæˆ·é…ç½®ï¼Œå¯ä»¥æ˜¯å·¥ä½œã€å­¦æ ¡æˆ–ä¸ªäººè´¦æˆ·ï¼‰
3. æˆäºˆè¯·æ±‚çš„æƒé™
4. æˆæƒåï¼Œæ‚¨å°†è¢«é‡å®šå‘å›å»
5. å®¢æˆ·ç«¯æ¥æ”¶ä»¤ç‰Œå¹¶å¯ä»¥å‘å‡ºç»è¿‡èº«ä»½éªŒè¯çš„è¯·æ±‚

<Info>
å®¢æˆ·ç«¯åœ¨æœ¬åœ°ç¼“å­˜ä»¤ç‰Œï¼Œå› æ­¤é™¤éä»¤ç‰Œè¿‡æœŸæˆ–æ‚¨æ˜¾å¼æ¸…é™¤ç¼“å­˜ï¼Œå¦åˆ™æ‚¨æ— éœ€ä¸ºåç»­è¿è¡Œé‡æ–°è¿›è¡Œèº«ä»½éªŒè¯ã€‚
</Info>

## Environment Variables

<VersionBadge version="2.12.1" />

For production deployments, use environment variables instead of hardcoding credentials.

### Provider Selection

Setting this environment variable allows the Azure provider to be used automatically without explicitly instantiating it in code.

<Card>
<ParamField path="FASTMCP_SERVER_AUTH" default="Not set">
Set to `fastmcp.server.auth.providers.azure.AzureProvider` to use Azure authentication.
</ParamField>
</Card>

### Azure-Specific Configuration

These environment variables provide default values for the Azure provider, whether it's instantiated manually or configured via `FASTMCP_SERVER_AUTH`.

<Card>
<ParamField path="FASTMCP_SERVER_AUTH_AZURE_CLIENT_ID" required>
æ‚¨çš„ Azure åº”ç”¨æ³¨å†Œå®¢æˆ·ç«¯ IDï¼ˆä¾‹å¦‚ï¼Œ`835f09b6-0f0f-40cc-85cb-f32c5829a149`ï¼‰
</ParamField>

<ParamField path="FASTMCP_SERVER_AUTH_AZURE_CLIENT_SECRET" required>
æ‚¨çš„ Azure åº”ç”¨æ³¨å†Œå®¢æˆ·ç«¯å¯†é’¥
</ParamField>

<ParamField path="FASTMCP_SERVER_AUTH_AZURE_TENANT_ID" required>
æ‚¨çš„ Azure ç§Ÿæˆ· IDï¼ˆç‰¹å®š IDã€"organizations" æˆ– "consumers"ï¼‰

<Note>
è¿™æ˜¯ **å¿…éœ€çš„**ã€‚åœ¨ Azure é—¨æˆ·çš„ Microsoft Entra ID â†’ æ¦‚è§ˆ ä¸‹æ‰¾åˆ°æ‚¨çš„ç§Ÿæˆ· IDã€‚
</Note>
</ParamField>

<ParamField path="FASTMCP_SERVER_AUTH_AZURE_BASE_URL" default="http://localhost:8000">
ç”¨äº OAuth å›è°ƒçš„ FastMCP æœåŠ¡å™¨å…¬å…± URL
</ParamField>

<ParamField path="FASTMCP_SERVER_AUTH_AZURE_REDIRECT_PATH" default="/auth/callback">
åœ¨æ‚¨çš„ Azure åº”ç”¨æ³¨å†Œä¸­é…ç½®çš„é‡å®šå‘è·¯å¾„
</ParamField>

<ParamField path="FASTMCP_SERVER_AUTH_AZURE_REQUIRED_SCOPES" default='["User.Read", "email", "openid", "profile"]'>
Comma-, space-, or JSON-separated list of required Microsoft Graph scopes
</ParamField>

<ParamField path="FASTMCP_SERVER_AUTH_AZURE_TIMEOUT_SECONDS" default="10">
Microsoft Graph API è°ƒç”¨çš„ HTTP è¯·æ±‚è¶…æ—¶
</ParamField>
</Card>

Example `.env` file:
```bash
# Use the Azure provider
FASTMCP_SERVER_AUTH=fastmcp.server.auth.providers.azure.AzureProvider

# Azure OAuth å‡­æ®
FASTMCP_SERVER_AUTH_AZURE_CLIENT_ID=835f09b6-0f0f-40cc-85cb-f32c5829a149
FASTMCP_SERVER_AUTH_AZURE_CLIENT_SECRET=your-client-secret-here
FASTMCP_SERVER_AUTH_AZURE_TENANT_ID=08541b6e-646d-43de-a0eb-834e6713d6d5
FASTMCP_SERVER_AUTH_AZURE_BASE_URL=https://your-server.com
FASTMCP_SERVER_AUTH_AZURE_REQUIRED_SCOPES=User.Read,email,profile
```

With environment variables set, your server code simplifies to:

```python server.py
from fastmcp import FastMCP

# èº«ä»½éªŒè¯ä»ç¯å¢ƒä¸­è‡ªåŠ¨é…ç½®
mcp = FastMCP(name="Azure Secured App")

@mcp.tool
async def protected_tool(query: str) -> str:
    """éœ€è¦ Azure èº«ä»½éªŒè¯æ‰èƒ½è®¿é—®çš„å·¥å…·ã€‚"""
    # æ‚¨çš„å·¥å…·å®ç°åœ¨è¿™é‡Œ
    return f"å¤„ç†ç»è¿‡èº«ä»½éªŒè¯çš„è¯·æ±‚ï¼š{query}"
```

