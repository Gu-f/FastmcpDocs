---
title: context
sidebarTitle: context
---

# `fastmcp.server.context`

## 函数

### `set_context` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/server/context.py#L69" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
set_context(context: Context) -> Generator[Context, None, None]
```

## 类

### `LogData` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/server/context.py#L57" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>


用于向客户端处理器传递日志参数的数据对象。

这提供了与 Python 标准库日志匹配的接口，
以便与结构化日志兼容。


### `Context` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/server/context.py#L78" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>


提供对 MCP 功能访问的上下文对象。

这为 MCP 的 RequestContext 功能提供了更清洁的接口。
它会被注入到通过类型提示请求它的工具和资源函数中。

要在工具函数中使用上下文，请添加一个带有 Context 类型注释的参数：

```python
@server.tool
def my_tool(x: int, ctx: Context) -> str:
    # 向客户端记录消息
    ctx.info(f"Processing {x}")
    ctx.debug("调试信息")
    ctx.warning("警告消息")
    ctx.error("错误消息")

    # 报告进度
    ctx.report_progress(50, 100, "处理中")

    # 访问资源
    data = ctx.read_resource("resource://data")

    # 获取请求信息
    request_id = ctx.request_id
    client_id = ctx.client_id

    # 在请求过程中管理状态
    ctx.set_state("key", "value")
    value = ctx.get_state("key")

    return str(x)
```

状态管理：
Context 对象维护一个状态字典，可用于在请求内的中间件和工具调用之间
存储和共享数据。当创建新的上下文（嵌套上下文）时，它会继承父上下文状态的副本，
确保子上下文中的修改不会影响父上下文。


上下文参数名可以是任意名称，只要它使用 Context 注释即可。
上下文是可选的 - 不需要它的工具可以省略该参数。


**方法：**

#### `fastmcp` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/server/context.py#L130" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
fastmcp(self) -> FastMCP
```

获取 FastMCP 实例。


#### `request_context` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/server/context.py#L159" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
request_context(self) -> RequestContext[ServerSession, Any, Request]
```

访问底层的请求上下文。

如果在请求上下文外调用，将引发 ValueError。


#### `report_progress` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/server/context.py#L169" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
report_progress(self, progress: float, total: float | None = None, message: str | None = None) -> None
```

为当前操作报告进度。

**参数：**
- `progress`: 当前进度值，例如 24
- `total`: 可选的总值，例如 100


#### `read_resource` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/server/context.py#L196" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
read_resource(self, uri: str | AnyUrl) -> list[ReadResourceContents]
```

按 URI 读取资源。

**参数：**
- `uri`: 要读取的资源 URI

**返回值：**
- 资源内容，为文本或字节


#### `log` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/server/context.py#L209" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
log(self, message: str, level: LoggingLevel | None = None, logger_name: str | None = None, extra: Mapping[str, Any] | None = None) -> None
```

向客户端发送日志消息。

**参数：**
- `message`: 日志消息
- `level`: 可选的日志级别。可以是 "debug"、"info"、"notice"、"warning"、"error"、"critical"、
"alert" 或 "emergency" 之一。默认为 "info"。
- `logger_name`: 可选的记录器名称
- `extra`: 额外参数的可选映射


#### `client_id` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/server/context.py#L236" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
client_id(self) -> str | None
```

获取客户端 ID（如果可用）。


#### `request_id` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/server/context.py#L245" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
request_id(self) -> str
```

获取此请求的唯一 ID。


#### `session_id` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/server/context.py#L250" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
session_id(self) -> str
```

获取所有传输的 MCP 会话 ID。

返回可用作基于会话的数据存储（例如 Redis）键的会话 ID，
以在同一客户端会话内的工具调用之间共享数据。


**返回值：**
- The session ID for StreamableHTTP transports, or a generated ID
- for other transports.


#### `session` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/server/context.py#L294" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
session(self) -> ServerSession
```

访问底层会话以进行高级使用。


#### `debug` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/server/context.py#L299" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
debug(self, message: str, logger_name: str | None = None, extra: Mapping[str, Any] | None = None) -> None
```

发送调试日志消息。


#### `info` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/server/context.py#L310" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
info(self, message: str, logger_name: str | None = None, extra: Mapping[str, Any] | None = None) -> None
```

发送信息日志消息。


#### `warning` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/server/context.py#L321" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
warning(self, message: str, logger_name: str | None = None, extra: Mapping[str, Any] | None = None) -> None
```

发送警告日志消息。


#### `error` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/server/context.py#L332" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
error(self, message: str, logger_name: str | None = None, extra: Mapping[str, Any] | None = None) -> None
```

发送错误日志消息。


#### `list_roots` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/server/context.py#L343" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
list_roots(self) -> list[Root]
```

列出客户端指示的服务器可用根目录。


#### `send_tool_list_changed` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/server/context.py#L348" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
send_tool_list_changed(self) -> None
```

向客户端发送工具列表更改通知。


#### `send_resource_list_changed` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/server/context.py#L352" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
send_resource_list_changed(self) -> None
```

向客户端发送资源列表更改通知。


#### `send_prompt_list_changed` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/server/context.py#L356" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
send_prompt_list_changed(self) -> None
```

向客户端发送提示列表更改通知。


#### `sample` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/server/context.py#L360" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
sample(self, messages: str | list[str | SamplingMessage], system_prompt: str | None = None, include_context: IncludeContext | None = None, temperature: float | None = None, max_tokens: int | None = None, model_preferences: ModelPreferences | str | list[str] | None = None) -> ContentBlock
```

向客户端发送采样请求并等待响应。

随时调用此方法让服务器从客户端请求 LLM 完成。
客户端必须正确配置，否则请求将出错。



#### `elicit` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/server/context.py#L444" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
elicit(self, message: str, response_type: None) -> AcceptedElicitation[dict[str, Any]] | DeclinedElicitation | CancelledElicitation
```

#### `elicit` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/server/context.py#L456" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
elicit(self, message: str, response_type: type[T]) -> AcceptedElicitation[T] | DeclinedElicitation | CancelledElicitation
```

#### `elicit` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/server/context.py#L466" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
elicit(self, message: str, response_type: list[str]) -> AcceptedElicitation[str] | DeclinedElicitation | CancelledElicitation
```

#### `elicit` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/server/context.py#L475" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
elicit(self, message: str, response_type: type[T] | list[str] | None = None) -> AcceptedElicitation[T] | AcceptedElicitation[dict[str, Any]] | AcceptedElicitation[str] | DeclinedElicitation | CancelledElicitation
```

向客户端发送引出请求并等待响应。

随时调用此方法通过客户端从用户请求额外信息。
客户端必须支持引出，否则请求将出错。


请注意，MCP 协议仅支持具有原始类型的简单对象架构。
您可以提供 dataclass、TypedDict 或 BaseModel 来遵循要求。
如果您提供的是原始类型，将为 MCP 交互生成一个具有单个
"value" 字段的对象架构，并在响应时自动解析为原始类型。


如果 response_type 为 None，生成的架构将是空对象的架构，
以符合 MCP 协议要求。客户端必须发送空对象 ("{}") 作为响应。


**参数：**
- `message`: 解释需要什么信息的人类可读消息
- `response_type`: 响应的类型，应该是原始类型或 dataclass 或 BaseModel。
如果是原始类型，将生成一个具有单个 "value" 字段的对象架构。



#### `get_http_request` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/server/context.py#L568" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
get_http_request(self) -> Request
```

获取活动的 starlette 请求。


#### `set_state` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/server/context.py#L583" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
set_state(self, key: str, value: Any) -> None
```

在上下文状态中设置值。


#### `get_state` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/server/context.py#L587" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
get_state(self, key: str) -> Any
```

从上下文状态获取值。如果未找到键，则返回 None。

