---
title: openapi
sidebarTitle: openapi
---

# `fastmcp.utilities.openapi`

## 函数

### `format_array_parameter` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/utilities/openapi.py#L41" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
format_array_parameter(values: list, parameter_name: str, is_query_parameter: bool = False) -> str | list
```


根据 OpenAPI 规范格式化数组参数。

**参数：**
- `values`: 要格式化的值列表
- `parameter_name`: 参数名称（用于错误消息）
- `is_query_parameter`: 如果为 True，可以为 explode=True 行为返回列表

**返回值：**
- 字符串（逗号分隔）或列表（对于 explode=True 的查询参数）


### `format_deep_object_parameter` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/utilities/openapi.py#L91" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
format_deep_object_parameter(param_value: dict, parameter_name: str) -> dict[str, str]
```


为 deepObject 样式序列化格式化字典参数。

根据 OpenAPI 3.0 规范，explode=true 的 deepObject 样式将对象属性序列化为带括号表示法的单独查询参数。

例如：`{"id": "123", "type": "user"}` 变成 `param[id]=123&param[type]=user`。

**参数：**
- `param_value`: 要格式化的字典值
- `parameter_name`: 参数名称

**返回值：**
- 以带括号的参数名作为键的字典


### `parse_openapi_to_http_routes` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/utilities/openapi.py#L201" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
parse_openapi_to_http_routes(openapi_dict: dict[str, Any]) -> list[HTTPRoute]
```


使用 openapi-pydantic 库将 OpenAPI 模式字典解析为 HTTPRoute 对象列表。

支持 OpenAPI 3.0.x 和 3.1.x 版本。


### `clean_schema_for_display` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/utilities/openapi.py#L741" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
clean_schema_for_display(schema: JsonSchema | None) -> JsonSchema | None
```


通过删除内部/复杂字段来清理模式字典以供显示。


### `generate_example_from_schema` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/utilities/openapi.py#L801" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
generate_example_from_schema(schema: JsonSchema | None) -> Any
```


从 JSON 模式字典生成简单的示例值。
非常基础的实现，专注于类型。


### `format_json_for_description` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/utilities/openapi.py#L884" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
format_json_for_description(data: Any, indent: int = 2) -> str
```


将 Python 数据格式化为 markdown 的 JSON 字符串块。


### `format_description_with_responses` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/utilities/openapi.py#L893" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
format_description_with_responses(base_description: str, responses: dict[str, Any], parameters: list[ParameterInfo] | None = None, request_body: RequestBodyInfo | None = None) -> str
```


使用响应、参数和请求体信息格式化基础描述字符串。

**参数：**
- `base_description`: 要格式化的初始描述。
- `responses`: 以状态码为键的响应信息字典。
- `parameters`: 参数信息列表，
包括路径和查询参数。每个参数包括名称、位置、是否必需和描述等详细信息。
- `request_body`: 请求体信息，
包括其描述、是否必需及其内容模式。

**返回值：**
- 包含响应、参数和请求体的附加详细信息的格式化描述字符串。


### `extract_output_schema_from_responses` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/utilities/openapi.py#L1419" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
extract_output_schema_from_responses(responses: dict[str, ResponseInfo], schema_definitions: dict[str, Any] | None = None, openapi_version: str | None = None) -> dict[str, Any] | None
```


从 OpenAPI 响应中提取输出模式以用作 MCP 工具输出模式。

此函数查找第一个成功响应（200、201、202、204），该响应具有与 JSON 兼容的内容类型并提取其模式。如果模式不是对象类型，它会包装该模式以符合 MCP 要求。

**参数：**
- `responses`: 以状态码为键的 ResponseInfo 对象字典
- `schema_definitions`: 可选的模式定义，包含在输出模式中
- `openapi_version`: OpenAPI 版本字符串，用于优化可空字段处理

**返回值：**
- 具有潜在包装的 MCP 兼容输出模式，如果未找到合适的模式则返回 None


## 类

### `ParameterInfo` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/utilities/openapi.py#L124" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>


在我们的 IR 中表示 HTTP 操作的单个参数。


### `RequestBodyInfo` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/utilities/openapi.py#L136" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>


在我们的 IR 中表示 HTTP 操作的请求体。


### `ResponseInfo` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/utilities/openapi.py#L146" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>


在我们的 IR 中表示响应信息。


### `HTTPRoute` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/utilities/openapi.py#L154" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>


单个 OpenAPI 操作的中间表示。


### `OpenAPIParser` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/utilities/openapi.py#L255" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>


统一的 OpenAPI 模式解析器，具有泛型类型参数以处理 3.0 和 3.1 版本。


**方法：**

#### `parse` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/utilities/openapi.py#L619" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
parse(self) -> list[HTTPRoute]
```

将 OpenAPI 模式解析为 HTTP 路由。

