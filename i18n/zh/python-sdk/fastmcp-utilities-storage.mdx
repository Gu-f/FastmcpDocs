---
title: storage
sidebarTitle: storage
---

# `fastmcp.utilities.storage`


用于持久化数据管理的键值存储实用程序。

## 类

### `KVStorage` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/utilities/storage.py#L16" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>


JSON数据键值存储的协议。


**方法:**

#### `get` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/utilities/storage.py#L19" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
get(self, key: str) -> dict[str, Any] | None
```

根据键获取JSON字典。


#### `set` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/utilities/storage.py#L23" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
set(self, key: str, value: dict[str, Any]) -> None
```

根据键存储JSON字典。


#### `delete` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/utilities/storage.py#L27" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
delete(self, key: str) -> None
```

根据键删除值。


### `JSONFileStorage` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/utilities/storage.py#L32" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>


带有自动元数据跟踪的基于文件的JSON数据键值存储。

每个键值对都作为单独的JSON文件存储在磁盘上。
键会被清理以确保文件系统安全。

存储会自动用元数据包装所有数据：
- timestamp: 条目最后被写入时的时间戳

**参数:**
- `cache_dir`: 存储JSON文件的目录


**方法:**

#### `get` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/utilities/storage.py#L72" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
get(self, key: str) -> dict[str, Any] | None
```

根据键从存储中获取JSON字典。

**参数:**
- `key`: 要检索的键

**返回值:**
- 存储的字典，如果未找到则返回None


#### `set` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/utilities/storage.py#L100" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
set(self, key: str, value: dict[str, Any]) -> None
```

存储带有元数据的JSON字典。

**参数:**
- `key`: 存储的键
- `value`: 要存储的字典


#### `delete` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/utilities/storage.py#L123" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
delete(self, key: str) -> None
```

从存储中删除值。

**参数:**
- `key`: 要删除的键


#### `cleanup_old_entries` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/utilities/storage.py#L134" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
cleanup_old_entries(self, max_age_seconds: int = 30 * 24 * 60 * 60) -> int
```

删除老于指定年龄的条目。

使用时间戳字段来确定年龄。

**参数:**
- `max_age_seconds`: 最大年龄（秒）（默认30天）

**返回值:**
- 删除的条目数


### `InMemoryStorage` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/utilities/storage.py#L183" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>


JSON数据的内存键值存储。

基于简单字典的存储，不会在重启后持久化。
对于测试或文件存储不可用的环境很有用。


**方法:**

#### `get` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/utilities/storage.py#L194" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
get(self, key: str) -> dict[str, Any] | None
```

根据键从内存中获取JSON字典。


#### `set` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/utilities/storage.py#L198" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
set(self, key: str, value: dict[str, Any]) -> None
```

在内存中存储JSON字典。


#### `delete` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/utilities/storage.py#L202" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
delete(self, key: str) -> None
```

从内存中删除值。

