---
title: tool_transform
sidebarTitle: tool_transform
---

# `fastmcp.tools.tool_transform`

## 函数

### `forward` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/tools/tool_transform.py#L37" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
forward(**kwargs) -> ToolResult
```


将参数转换应用后转发到父工具。

此函数只能从转换工具的自定义函数内部调用。它在调用父工具之前
应用参数转换（重命名、验证）。

例如，如果父工具有参数 `x` 和 `y`，但转换工具有参数 `a` 和 `b`，
并且提供了将 `x` 映射到 `a` 和 `y` 到 `b` 的 `transform_args`，
那么 `forward(a=1, b=2)` 将使用 `x=1` 和 `y=2` 调用父工具。

**参数：**
- `**kwargs`: 要转发到父工具的参数（使用转换后的名称）。

**返回值：**
- 父工具执行的 ToolResult。

**异常：**
- `RuntimeError`: 如果在转换工具上下文外调用。
- `TypeError`: 如果提供的参数与转换后的架构不匹配。


### `forward_raw` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/tools/tool_transform.py#L67" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
forward_raw(**kwargs) -> ToolResult
```


直接转发到父工具，不进行转换。

此函数绕过所有参数转换和验证，直接使用提供的参数调用父工具。
当您需要使用原始参数名称和结构调用父工具时使用此函数。

例如，如果父工具有参数 `x` 和 `y`，那么 `forward_raw(x=1,
y=2)` 将使用 `x=1` 和 `y=2` 调用父工具。

**参数：**
- `**kwargs`: 直接传递给父工具的参数（使用原始名称）。

**返回值：**
- 父工具执行的 ToolResult。

**异常：**
- `RuntimeError`: 如果在转换工具上下文外调用。


### `apply_transformations_to_tools` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/tools/tool_transform.py#L915" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
apply_transformations_to_tools(tools: dict[str, Tool], transformations: dict[str, ToolTransformConfig]) -> dict[str, Tool]
```


将转换列表应用到工具列表。没有任何转换的工具
保持不变。


## 类

### `ArgTransform` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/tools/tool_transform.py#L94" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>


用于转换父工具参数的配置。

此类允许在从现有工具创建新工具时对各个参数进行精细控制。
您可以重命名参数、更改其描述、添加默认值，或在传递常量时对客户端隐藏它们。

**示例：**

将参数 'old_name' 重命名为 'new_name'
```python
ArgTransform(name="new_name")
```

仅更改描述
```python
ArgTransform(description="更新的描述")
```

添加默认值（使参数可选）
```python
ArgTransform(default=42)
```

添加默认工厂（使参数可选）
```python
ArgTransform(default_factory=lambda: time.time())
```

更改类型
```python
ArgTransform(type=str)
```

对客户端完全隐藏参数
```python
ArgTransform(hide=True)
```

隐藏参数但向父工具传递常量值
```python
ArgTransform(hide=True, default="常量值")
```

隐藏参数但向父工具传递工厂生成的值
```python
ArgTransform(hide=True, default_factory=lambda: uuid.uuid4().hex)
```

将可选参数设为必需（移除任何默认值）
```python
ArgTransform(required=True)
```

组合多个转换
```python
ArgTransform(name="new_name", description="新描述", default=None, type=int)
```


### `ArgTransformConfig` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/tools/tool_transform.py#L208" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>


用于请求单个参数转换的模型。


**方法：**

#### `to_arg_transform` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/tools/tool_transform.py#L226" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
to_arg_transform(self) -> ArgTransform
```

将参数转换转换为 FastMCP 参数转换。


### `TransformedTool` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/tools/tool_transform.py#L232" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>


从另一个工具转换而来的工具。

此类表示通过转换另一个工具创建的工具。
它支持参数重命名、架构修改、自定义函数注入、
结构化输出控制，并为 forward() 和 forward_raw() 函数提供上下文。

转换可以是纯基于架构的（参数重命名、删除等），
或者可以包括使用 forward() 调用父工具的自定义函数。
输出架构和结构化输出会自动从父工具继承，但可以被重写或禁用。


**方法：**

#### `run` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/tools/tool_transform.py#L259" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
run(self, arguments: dict[str, Any]) -> ToolResult
```

在为 forward() 函数设置上下文的情况下运行工具。

此方法在执行工具函数的同时设置上下文，
使 forward() 和 forward_raw() 能够在自定义函数中正确工作。

**参数：**
- `arguments`: 传递给工具函数的参数字典。

**返回值：**
- 包含内容和可选结构化输出的 ToolResult 对象。


#### `from_tool` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/tools/tool_transform.py#L364" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
from_tool(cls, tool: Tool, name: str | None = None, title: str | None | NotSetT = NotSet, description: str | None | NotSetT = NotSet, tags: set[str] | None = None, transform_fn: Callable[..., Any] | None = None, transform_args: dict[str, ArgTransform] | None = None, annotations: ToolAnnotations | None | NotSetT = NotSet, output_schema: dict[str, Any] | None | NotSetT | Literal[False] = NotSet, serializer: Callable[[Any], str] | None | NotSetT = NotSet, meta: dict[str, Any] | None | NotSetT = NotSet, enabled: bool | None = None) -> TransformedTool
```

从父工具创建转换工具。

**参数：**
- `tool`: 要转换的父工具。
- `transform_fn`: 可选的自定义函数。可以使用 forward() 和 forward_raw()
来调用父工具。带有 **kwargs 的函数接收转换后的参数名称。
- `name`: 工具的新名称。默认为父工具的名称。
- `title`: 工具的新标题。默认为父工具的标题。
- `transform_args`: 父工具参数的可选转换。
只有指定的参数被转换，其他参数保持不变：
- 简单重命名 (str)
- 复杂转换（重命名/描述/默认值/删除）(ArgTransform)
- 删除参数 (None)
- `description`: 新描述。默认为父工具的描述。
- `tags`: 新标签。默认为父工具的标签。
- `annotations`: 新注释。默认为父工具的注释。
- `output_schema`: 控制结构化输出的输出架构：
- None（默认）：如果可用，从 transform_fn 继承，否则从父工具继承
- dict：使用自定义输出架构
- False：禁用输出架构和结构化输出
- `serializer`: 新序列化器。默认为父工具的序列化器。
- `meta`: 控制元信息：
- NotSet（默认）：从父工具继承
- dict：使用自定义元信息
- None：移除元信息

**返回值：**
- 带有指定转换的 TransformedTool。

**示例：**

# 仅转换特定参数
```python
Tool.from_tool(parent, transform_args={"old": "new"})  # 其他保持不变
```

# 带有部分转换的自定义函数
```python
async def custom(x: int, y: int) -> str:
    result = await forward(x=x, y=y)
    return f"自定义: {result}"

Tool.from_tool(parent, transform_fn=custom, transform_args={"a": "x", "b": "y"})
```

# 使用 **kwargs（获取所有参数，转换和未转换的）
```python
async def flexible(**kwargs) -> str:
    result = await forward(**kwargs)
    return f"获取到: {kwargs}"

Tool.from_tool(parent, transform_fn=flexible, transform_args={"a": "x"})
```

# 控制结构化输出和架构
```python
# 自定义输出架构
Tool.from_tool(parent, output_schema={
    "type": "object",
    "properties": {"status": {"type": "string"}}
})

# 禁用结构化输出
Tool.from_tool(parent, output_schema=False)

# 返回 ToolResult 以获得完全控制
async def custom_output(**kwargs) -> ToolResult:
    result = await forward(**kwargs)
    return ToolResult(
        content=[TextContent(text="摘要")],
        structured_content={"processed": True}
    )
```


### `ToolTransformConfig` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/tools/tool_transform.py#L869" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>


提供转换工具的方法。


**方法：**

#### `apply` <sup><a href="https://github.com/jlowin/fastmcp/blob/main/src/fastmcp/tools/tool_transform.py#L901" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
apply(self, tool: Tool) -> TransformedTool
```

从提供的工具和此转换配置创建 TransformedTool。

