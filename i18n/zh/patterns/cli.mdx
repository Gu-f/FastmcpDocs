---
title: FastMCP CLI
sidebarTitle: CLI
description: 学习如何使用 FastMCP 命令行界面
icon: terminal
---

import { VersionBadge } from "/snippets/version-badge.mdx"


FastMCP 提供了一个命令行界面（CLI），使您能够轻松运行、开发和安装 MCP 服务器。CLI 在您安装 FastMCP 时会自动安装。

```bash
fastmcp --help
```

## 命令概览

| 命令 | 用途 | 依赖管理 |
| ------- | ------- | --------------------- |
| `run` | 直接运行 FastMCP 服务器 | **支持：** 本地文件、工厂函数、URL、MCP 配置。**依赖：** 直接使用您的本地环境。使用 `--python`、`--with`、`--project` 或 `--with-requirements` 参数时：通过 `uv run` 子进程运行 |
| `dev` | 使用 MCP Inspector 运行服务器进行测试 | **支持：** 仅本地文件。**依赖：** 始终通过 `uv run` 子进程运行（从不使用您的本地环境）；必须指定依赖或在 uv 管理的项目中可用 |
| `install` | 在 MCP 客户端应用程序中安装服务器 | **支持：** 仅本地文件。**依赖：** 创建隔离环境；必须使用 `--with` 和/或 `--with-editable` 明确指定依赖 |
| `inspect` | 生成关于 FastMCP 服务器的 JSON 报告 | **支持：** 仅本地文件。**依赖：** 使用您当前的环境；您需要负责确保所有依赖都可用 |
| `project prepare` | 从 fastmcp.json 环境配置创建持久的 uv 项目 | **支持：** 仅 fastmcp.json 配置。**依赖：** 创建一个 uv 项目目录，预装所有依赖以便与 `--project` 标志重复使用 |
| `version` | 显示版本信息 | N/A |

## `fastmcp run`

直接运行 FastMCP 服务器或代理远程服务器。

```bash
fastmcp run server.py
```

<Tip>
默认情况下，此命令在您当前的 Python 环境中直接运行服务器。您需要负责确保所有依赖都可用。当使用 `--python`、`--with`、`--project` 或 `--with-requirements` 选项时，它将通过 `uv run` 子进程运行服务器。
</Tip>

### 选项

| 选项 | 标志 | 描述 |
| ------ | ---- | ----------- |
| 传输协议 | `--transport`, `-t` | 使用的传输协议（`stdio`、`http` 或 `sse`） |
| 主机 | `--host` | 使用 http 传输时绑定的主机（默认：127.0.0.1） |
| 端口 | `--port`, `-p` | 使用 http 传输时绑定的端口（默认：8000） |
| 路径 | `--path` | 使用 http 传输时绑定的路径（默认：`/mcp/` 或 SSE 为 `/sse/`） |
| 日志级别 | `--log-level`, `-l` | 日志级别（DEBUG、INFO、WARNING、ERROR、CRITICAL） |
| 无横幅 | `--no-banner` | 禁用启动横幅显示 |
| 跳过环境 | `--skip-env` | 跳过使用 uv 进行环境设置（在已处于 uv 环境中时使用） |
| Python 版本 | `--python` | 使用的 Python 版本（例如 3.10、3.11） |
| 附加包 | `--with` | 要安装的附加包（可多次使用） |
| 项目目录 | `--project` | 在给定项目目录中运行命令 |
| 需求文件 | `--with-requirements` | 用于安装依赖的需求文件 |


### 入口点
<VersionBadge version="2.3.5" />

`fastmcp run` 命令支持以下入口点：

1. **[推断服务器实例](#inferred-server-instance)**：`server.py` - 导入模块并查找名为 `mcp`、`server` 或 `app` 的 FastMCP 服务器实例。如果未找到此类对象则报错。
2. **[显式服务器入口点](#explicit-server-entrypoint)**：`server.py:custom_name` - 导入并使用指定的服务器入口点
3. **[工厂函数](#factory-function)**：`server.py:create_server` - 调用指定的函数（同步或异步）创建服务器实例
4. **[远程服务器代理](#remote-server-proxy)**：`https://example.com/mcp-server` - 连接到远程服务器并创建**本地代理服务器**
5. **[FastMCP 配置文件](#fastmcp-configuration)**：`fastmcp.json` - 使用 FastMCP 的声明式配置格式运行服务器（自动检测当前目录中的文件）
6. **MCP 配置文件**：`mcp.json` - 运行标准 MCP 配置文件中定义的服务器

<Warning>
注意：当使用 `fastmcp run` 运行本地文件时，它会**完全忽略** `if __name__ == "__main__"` 代码块。这意味着：
- `__main__` 中的任何设置代码都不会运行
- `__main__` 中的服务器配置被绕过  
- `fastmcp run` finds your server entrypoint/factory and runs it with its own transport settings

如果您需要运行设置代码，请使用**工厂模式**。
</Warning>

#### 推断服务器实例

如果您提供文件路径，`fastmcp run` 将加载文件并查找存储为名为 `mcp`、`server` 或 `app` 变量的 FastMCP 服务器实例。如果未找到此类对象，将引发错误。

例如，如果您有一个名为 `server.py` 的文件，内容如下：

```python server.py
from fastmcp import FastMCP

mcp = FastMCP("MyServer")
```

您可以运行它：

```bash
fastmcp run server.py
```

#### 显式服务器入口点

如果您的服务器存储为具有自定义名称的变量，或者您想明确指定要运行哪个服务器，可以使用以下语法加载特定的服务器入口点：

```bash
fastmcp run server.py:custom_name
```

例如，如果您有一个名为 `server.py` 的文件，内容如下：

```python
from fastmcp import FastMCP

my_server = FastMCP("CustomServer")

@my_server.tool
def hello() -> str:
    return "Hello from custom server!"
```

您可以运行它：

```bash
fastmcp run server.py:my_server
```

#### 工厂函数
<VersionBadge version="2.11.2" />

由于 `fastmcp run` 忽略 `if __name__ == "__main__"` 代码块，您可以使用工厂函数在服务器启动前运行设置代码。工厂函数不带任何参数调用，必须返回 FastMCP 服务器实例。支持同步和异步工厂函数。

使用工厂函数的语法与显式服务器入口点相同：`fastmcp run server.py:factory_fn`。FastMCP 将自动检测您标识的是函数而不是服务器实例

例如，如果您有一个名为 `server.py` 的文件，内容如下：

```python
from fastmcp import FastMCP

async def create_server() -> FastMCP:
    mcp = FastMCP("MyServer")
    
    @mcp.tool
    def add(x: int, y: int) -> int:
        return x + y
    
    # 与 fastmcp run 一起运行的设置代码
    tool = await mcp.get_tool("add")
    tool.disable()
    
    return mcp
```

您可以运行它：

```bash
fastmcp run server.py:create_server
```

#### 远程服务器代理

FastMCP run 还可以启动连接到远程服务器的本地代理服务器。当您想要在本地运行远程服务器进行测试或开发，或与不支持直接连接远程服务器的客户端一起使用时，这很有用。

要启动本地代理，您可以使用以下语法：

```bash
fastmcp run https://example.com/mcp
```

#### FastMCP Configuration
<VersionBadge version="2.11.4" />

FastMCP 通过 `fastmcp.json` 文件支持声明式配置。当您运行不带参数的 `fastmcp run` 时，它会自动在当前目录中查找 `fastmcp.json` 文件：

```bash
# 自动检测当前目录中的 fastmcp.json
fastmcp run

# 或显式指定配置文件
fastmcp run my-config.fastmcp.json
```

配置文件处理依赖项、环境变量和传输设置。命令行参数会覆盖配置文件值：

```bash
# 覆盖配置文件中的端口
fastmcp run fastmcp.json --port 8080

# 在已处于 uv 环境时跳过环境设置
fastmcp run fastmcp.json --skip-env
```

<Note>
`--skip-env` 标志在以下情况下很有用：
- 您已经在激活的虚拟环境中
- 您在预装依赖的 Docker 容器内
- 您在 uv 管理的环境中（防止无限递归）
- 您想在不设置环境的情况下测试服务器
</Note>

有关 fastmcp.json 的详细文档，请参阅[服务器配置](/zh/deployment/server-configuration)。

#### MCP Configuration

FastMCP 还可以运行标准 MCP 配置文件中定义的服务器。当您想从单个文件运行多个服务器，或当您想使用不支持直接连接远程服务器的客户端时，这很有用。

要运行 MCP 配置文件，可以使用以下语法：

```bash
fastmcp run mcp.json
```

这将运行文件中定义的所有服务器。

## `fastmcp dev`

使用 [MCP Inspector](https://github.com/modelcontextprotocol/inspector) 运行 MCP 服务器进行测试。

```bash
fastmcp dev server.py
```

<Tip>
此命令始终通过 `uv run` 子进程运行您的服务器（从不使用本地环境）以配合 MCP Inspector 工作。依赖项可以：
- 使用 `--with` 和/或 `--with-editable` 选项指定
- 在 `fastmcp.json` 配置文件中定义
- 在 uv 管理的项目中可用

使用 `fastmcp.json` 时，dev 命令会自动使用配置的依赖项。
</Tip>

<Warning>
`dev` 命令是仅通过 STDIO 测试服务器的快捷方式。当 Inspector 启动时，您可能需要：
1. 从传输下拉菜单中选择 "STDIO"
2. 手动连接

此命令不支持 HTTP 测试。要通过 Streamable HTTP 或 SSE 测试服务器：
1. 使用命令行手动启动具有适当传输的服务器：
   ```bash
   fastmcp run server.py --transport http
   ```
   或通过在代码中设置传输：
   ```bash
   python server.py  # 假设您的 __main__ 代码块设置了 Streamable HTTP 传输
   ```
2. 单独打开 MCP Inspector 并连接到正在运行的服务器
</Warning>

### 选项

| 选项 | 标志 | 描述 |
| ------ | ---- | ----------- |
| 可编辑包 | `--with-editable`, `-e` | 包含 pyproject.toml 的目录，以可编辑模式安装 |
| 附加包 | `--with` | 要安装的附加包（可多次使用） |
| Inspector 版本 | `--inspector-version` | 使用的 MCP Inspector 版本 |
| UI 端口 | `--ui-port` | MCP Inspector UI 的端口 |
| 服务器端口 | `--server-port` | MCP Inspector 代理服务器的端口 |
| Python 版本 | `--python` | 使用的 Python 版本（例如 3.10、3.11） |
| 项目目录 | `--project` | 在给定项目目录中运行命令 |
| 需求文件 | `--with-requirements` | 用于安装依赖的需求文件 |

### 入口点

`dev` 命令仅支持本地 FastMCP 服务器文件：

1. **推断服务器实例**：`server.py` - 导入模块并查找名为 `mcp`、`server` 或 `app` 的 FastMCP 服务器实例。如果未找到此类对象则报错。
2. **显式服务器入口点**：`server.py:custom_name` - 导入并使用指定的服务器入口点
3. **工厂函数**：`server.py:create_server` - 调用指定的函数（同步或异步）创建服务器实例
4. **FastMCP 配置**：`fastmcp.json` - 使用 FastMCP 的声明式配置（自动检测当前目录）

<Warning>
`dev` 命令**仅支持本地文件** - 不支持 URL、远程服务器或 MCP 配置文件。
</Warning>

**示例**

```bash
# 以可编辑模式和附加包运行开发服务器
fastmcp dev server.py -e . --with pandas --with matplotlib

# 使用 fastmcp.json 配置运行开发服务器（自动检测）
fastmcp dev

# 使用显式 fastmcp.json 文件运行开发服务器
fastmcp dev dev.fastmcp.json

# 使用特定 Python 版本运行开发服务器
fastmcp dev server.py --python 3.11

# 使用需求文件运行开发服务器
fastmcp dev server.py --with-requirements requirements.txt

# 在特定项目目录中运行开发服务器
fastmcp dev server.py --project /path/to/project
```

## `fastmcp install`
<VersionBadge version="2.10.3" />

在 MCP 客户端应用程序中安装 MCP 服务器。FastMCP 目前支持以下客户端：

- **Claude Code** - 通过 Claude Code 的内置 MCP 管理系统安装
- **Claude Desktop** - 通过直接修改配置文件安装
- **Cursor** - 通过深链接安装，打开 Cursor 供用户确认
- **MCP JSON** - 生成标准 MCP JSON 配置供手动使用

```bash
fastmcp install claude-code server.py
fastmcp install claude-desktop server.py
fastmcp install cursor server.py
fastmcp install mcp-json server.py
```

请注意，出于安全原因，MCP 客户端通常在完全隔离的环境中运行每个服务器。因此，必须使用 `--with` 和/或 `--with-editable` 选项（遵循 `uv` 约定）明确指定所有依赖项，或通过 `dependencies` 参数在代码中将它们附加到您的服务器。您不应假设 MCP 服务器能够访问您的本地环境。

<Warning>
**`uv` 必须安装并在系统 PATH 中可用**。Claude Desktop 和 Cursor 都在隔离环境中运行，需要 `uv` 来管理依赖项。在 macOS 上，为了与 Claude Desktop 兼容，请使用 Homebrew 全局安装 `uv`：`brew install uv`。
</Warning>

<Note>
**Python 版本注意事项**：安装命令现在支持 `--python` 选项直接指定 Python 版本。您还可以使用 `--project` 在特定项目目录中运行，或使用 `--with-requirements` 从需求文件安装依赖项。
</Note>

<Tip>
**FastMCP `install` 命令专注于使用 STDIO 传输的本地服务器文件。** 对于使用 HTTP 或 SSE 传输运行的远程服务器，请使用客户端的原生配置 - FastMCP 的价值在于简化复杂的本地设置以及依赖项和 `uv` 命令。
</Tip>

### Options

| 选项 | 标志 | 描述 |
| ------ | ---- | ----------- |
| 服务器名称 | `--server-name`, `-n` | 服务器的自定义名称（默认为服务器的 name 属性或文件名） |
| 可编辑包 | `--with-editable`, `-e` | 包含 pyproject.toml 的目录，以可编辑模式安装 |
| 附加包 | `--with` | 要安装的附加包（可多次使用） |
| 环境变量 | `--env` | KEY=VALUE 格式的环境变量（可多次使用） |
| 环境文件 | `--env-file`, `-f` | 从 .env 文件加载环境变量 |
| Python 版本 | `--python` | 要使用的 Python 版本（例如 3.10、3.11） |
| 项目目录 | `--project` | 在给定项目目录中运行命令 |
| 需求文件 | `--with-requirements` | 用于安装依赖的需求文件 |

### Entrypoints

`install` 命令支持本地 FastMCP 服务器文件和配置：

1. **推断服务器实例**：`server.py` - 导入模块并查找名为 `mcp`、`server` 或 `app` 的 FastMCP 服务器实例。如果未找到此类对象则报错。
2. **显式服务器入口点**：`server.py:custom_name` - 导入并使用指定的服务器入口点
3. **工厂函数**：`server.py:create_server` - 调用指定的函数（同步或异步）创建服务器实例
4. **FastMCP 配置**：`fastmcp.json` - 使用 FastMCP 的声明式配置以及依赖和设置

<Note>
工厂函数对于安装命令特别有用，因为它们允许运行设置代码，否则当 MCP 客户端运行您的服务器时这些代码会被忽略。使用 fastmcp.json 时，依赖项会自动处理。
</Note>

<Warning>
`install` 命令**仅支持本地文件和 fastmcp.json** - 不支持 URL、远程服务器或标准 MCP 配置文件。对于远程服务器，请使用您的 MCP 客户端的原生配置。
</Warning>

**Examples**

```bash
# 自动检测服务器入口点（查找 'mcp'、'server' 或 'app'）
fastmcp install claude-desktop server.py

# 使用 fastmcp.json 配置安装（自动检测）
fastmcp install claude-desktop

# 使用显式 fastmcp.json 文件安装
fastmcp install claude-desktop my-config.fastmcp.json

# 使用特定服务器入口点
fastmcp install claude-desktop server.py:my_server

# 使用自定义名称和依赖
fastmcp install claude-desktop server.py:my_server --server-name "我的分析服务器" --with pandas

# 在 Claude Code 中使用环境变量安装
fastmcp install claude-code server.py --env API_KEY=secret --env DEBUG=true

# 在 Cursor 中使用环境变量安装
fastmcp install cursor server.py --env API_KEY=secret --env DEBUG=true

# 使用环境文件安装
fastmcp install cursor server.py --env-file .env

# 使用特定 Python 版本安装
fastmcp install claude-desktop server.py --python 3.11

# 使用需求文件安装
fastmcp install claude-code server.py --with-requirements requirements.txt

# 在项目目录中安装
fastmcp install cursor server.py --project /path/to/project

# 生成 MCP JSON 配置
fastmcp install mcp-json server.py --name "我的服务器" --with pandas

# 将 JSON 配置复制到剪贴板
fastmcp install mcp-json server.py --copy
```

### MCP JSON Generation

`mcp-json` 子命令生成标准 MCP JSON 配置，可用于任何兼容 MCP 的客户端。这在以下情况下很有用：

- 使用 FastMCP 不直接支持的 MCP 客户端
- 为 CI/CD 环境创建配置
- 与他人共享服务器配置
- 与自定义工具集成

生成的 JSON 遵循 Claude Desktop、VS Code、Cursor 和其他 MCP 客户端使用的标准 MCP 服务器配置格式，以服务器名称作为根键：

```json
{
  "server-name": {
    "command": "uv",
    "args": [
      "run",
      "--with",
      "fastmcp",
      "fastmcp",
      "run",
      "/path/to/server.py"
    ],
    "env": {
      "API_KEY": "value"
    }
  }
}
```

<Note>
要在您的 MCP 客户端中使用此配置，通常需要将其添加到客户端的 `mcpServers` 对象中。有关任何特定配置要求或格式需求，请参阅您的客户端文档。
</Note>

**mcp-json 特有选项：**

| 选项 | 标志 | 描述 |
| ------ | ---- | ----------- |
| 复制到剪贴板 | `--copy` | 将配置复制到剪贴板而不是打印到标准输出 |

## `fastmcp inspect`

<VersionBadge version="2.9.0" />

检查 FastMCP 服务器以查看摘要信息或生成详细的 JSON 报告。

```bash
# 显示文本摘要
fastmcp inspect server.py

# 将 FastMCP JSON 输出到标准输出
fastmcp inspect server.py --format fastmcp

# 将 MCP JSON 保存到文件（使用 -o 时需要格式）
fastmcp inspect server.py --format mcp -o manifest.json
```

### Options

| 选项 | 标志 | 描述 |
| ------ | ---- | ----------- |
| 格式 | `--format`, `-f` | 输出格式：`fastmcp`（FastMCP 特定）或 `mcp`（MCP 协议）。使用 `-o` 时必需 |
| 输出文件 | `--output`, `-o` | 将 JSON 报告保存到文件而不是标准输出。需要 `--format` |

### Output Formats

#### FastMCP 格式（`--format fastmcp`）
默认且最全面的格式，包含所有 FastMCP 特定元数据：
- 服务器名称、说明和版本
- FastMCP 版本和 MCP 版本
- 工具标签和启用状态
- 工具的输出模式
- 注释和自定义元数据
- 使用 snake_case 字段名
- **用途**：完整的服务器内省和调试 FastMCP 服务器

#### MCP 协议格式（`--format mcp`）
显示 MCP 客户端通过协议将看到的确切内容：
- 仅包含标准 MCP 协议字段
- 匹配 `client.list_tools()`、`client.list_prompts()` 等的输出
- 使用 camelCase 字段名（例如 `inputSchema`）
- 排除 FastMCP 特定字段，如标签和启用状态
- **用途**：调试客户端可见性并确保 MCP 兼容性

### Entrypoints

`inspect` 命令支持本地 FastMCP 服务器文件和配置：

1. **推断服务器实例**：`server.py` - 导入模块并查找名为 `mcp`、`server` 或 `app` 的 FastMCP 服务器实例。如果未找到此类对象则报错。
2. **显式服务器入口点**：`server.py:custom_name` - 导入并使用指定的服务器入口点
3. **工厂函数**：`server.py:create_server` - 调用指定的函数（同步或异步）创建服务器实例
4. **FastMCP 配置**：`fastmcp.json` - 检查使用 FastMCP 声明式配置定义的服务器

<Warning>
`inspect` 命令**仅支持本地文件和 fastmcp.json** - 不支持 URL、远程服务器或标准 MCP 配置文件。
</Warning>

### Examples

```bash
# 显示文本摘要（无 JSON 输出）
fastmcp inspect server.py
# 输出：
# Server: 我的服务器
# Instructions: 一个有用的 MCP 服务器
# Version: 1.0.0
#
# Components:
#   Tools: 5
#   Prompts: 2
#   Resources: 3
#   Templates: 1
#
# Environment:
#   FastMCP: 2.0.0
#   MCP: 1.0.0
#
# 使用 --format [fastmcp|mcp] 获取完整 JSON 输出

# 将 FastMCP 格式输出到标准输出
fastmcp inspect server.py --format fastmcp

# 指定服务器入口点
fastmcp inspect server.py:my_server

# 将 MCP 协议格式输出到标准输出
fastmcp inspect server.py --format mcp

# 保存到文件（需要格式）
fastmcp inspect server.py --format fastmcp -o server-manifest.json

# 使用自定义服务器对象保存 MCP 格式
fastmcp inspect server.py:my_server --format mcp -o mcp-manifest.json

# 错误：输出文件需要格式
fastmcp inspect server.py -o output.json
# 错误：使用 -o/--output 时需要 --format
```

## `fastmcp project prepare`

从 fastmcp.json 文件的环境配置创建持久的 uv 项目目录。这允许您一次性预安装所有依赖项，并使用 `--project` 标志重复使用它们。

```bash
fastmcp project prepare fastmcp.json --output-dir ./env
```

### Options

| 选项 | 标志 | 描述 |
| ------ | ---- | ----------- |
| 输出目录 | `--output-dir` | **必需。** 创建持久 uv 项目的目录 |

### Usage Pattern

```bash
# 步骤 1：准备环境（安装依赖项）
fastmcp project prepare fastmcp.json --output-dir ./my-env

# 步骤 2：使用准备好的环境运行（快速，无需安装依赖）
fastmcp run fastmcp.json --project ./my-env
```

prepare 命令创建一个 uv 项目，包含：
- 包含 fastmcp.json 中所有依赖项的 `pyproject.toml`
- 预安装所有包的 `.venv`
- 用于可重现环境的 `uv.lock` 文件

当您想要将环境设置与服务器执行分离时，这很有用，例如在部署场景中，依赖项只安装一次，服务器则运行多次。

## `fastmcp version`

显示有关 FastMCP 和相关组件的版本信息。

```bash
fastmcp version
```

### Options

| 选项 | 标志 | 描述 |
| ------ | ---- | ----------- |
| 复制到剪贴板 | `--copy` | 将版本信息复制到剪贴板 |
