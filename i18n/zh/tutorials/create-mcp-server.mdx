---
title: "如何使用 Python 创建 MCP 服务器"
sidebarTitle: "创建 MCP 服务器"
description: "使用 Python 和 FastMCP 构建模型上下文协议（MCP）服务器的分步指南，从基本工具到动态资源。"
icon: server
---

您想要使用 Python 构建一个模型上下文协议（MCP）服务器。目标是创建一个能够为 Claude、Gemini 或其他支持该协议的 AI 模型提供工具和数据的服务。虽然 [MCP 规范](https://modelcontextprotocol.io/specification/)很强大，但从头开始实现它涉及大量样板代码：处理 JSON-RPC、管理会话状态以及正确格式化请求和响应。

这就是 **FastMCP** 发挥作用的地方。它是一个高级框架，为您处理所有协议复杂性，让您专注于重要的事情：编写驱动服务器的 Python 函数。

本指南将引导您使用 FastMCP 从头创建一个功能齐全的 MCP 服务器。

<Tip>
本教程中的每个代码块都是完整的、可运行的示例。您可以将其复制并粘贴到文件中运行，或直接粘贴到 Python REPL（如 IPython）中试用。
</Tip>

### 前提条件

确保您已安装 FastMCP。如果没有，请按照[安装指南](/zh/getting-started/installation)进行操作。

```bash
pip install fastmcp
```


## 步骤 1：创建基本服务器

每个 FastMCP 应用程序都从 `FastMCP` 类的一个实例开始。该对象作为您所有工具和资源的容器。

创建一个名为 `my_mcp_server.py` 的新文件：

```python my_mcp_server.py
from fastmcp import FastMCP

# 创建一个具有描述性名称的服务器实例
mcp = FastMCP(name="我的第一个 MCP 服务器")
```

就是这样！您已经有了一个有效的（虽然是空的）MCP 服务器。现在，让我们添加一些功能。

## 步骤 2：添加工具

工具是 LLM 可以执行的函数。让我们创建一个将两个数字相加的简单工具。

要做到这一点，只需编写一个标准的 Python 函数并用 `@mcp.tool` 装饰它。

```python my_mcp_server.py {5-8}
from fastmcp import FastMCP

mcp = FastMCP(name="我的第一个 MCP 服务器")

@mcp.tool
def add(a: int, b: int) -> int:
    """将两个整数相加。"""
    return a + b
```

FastMCP 自动处理其余部分：
- **工具名称：** 使用函数名（`add`）作为工具的名称。
- **描述：** 使用函数的文档字符串作为工具对 LLM 的描述。
- **架构：** 检查类型提示（`a: int`、`b: int`）来为输入生成 JSON 架构。

这是 FastMCP 的核心理念：**编写 Python，而不是协议样板代码。**

## 步骤 3：通过资源暴露数据

资源为 LLM 提供只读数据。您可以通过用 `@mcp.resource` 装饰函数来定义资源，并提供唯一的 URI。

让我们将一个简单的配置字典作为资源暴露。

```python my_mcp_server.py {10-13}
from fastmcp import FastMCP

mcp = FastMCP(name="我的第一个 MCP 服务器")

@mcp.tool
def add(a: int, b: int) -> int:
    """将两个整数相加。"""
    return a + b

@mcp.resource("resource://config")
def get_config() -> dict:
    """提供应用程序的配置。"""
    return {"version": "1.0", "author": "MyTeam"}
```

当客户端请求 URI `resource://config` 时，FastMCP 将执行 `get_config` 函数并将其输出（序列化为 JSON）返回给客户端。该函数仅在请求资源时被调用，实现数据的懒加载。

## 步骤 4：使用资源模板生成动态内容

有时，您需要根据参数生成资源。这就是**资源模板**的作用。您使用相同的 `@mcp.resource` 装饰器来定义它们，但在 URI 中使用占位符。

让我们创建一个提供个性化问候的模板。

```python my_mcp_server.py {15-17}
from fastmcp import FastMCP

mcp = FastMCP(name="我的第一个 MCP 服务器")

@mcp.tool
def add(a: int, b: int) -> int:
    """将两个整数相加。"""
    return a + b

@mcp.resource("resource://config")
def get_config() -> dict:
    """提供应用程序的配置。"""
    return {"version": "1.0", "author": "MyTeam"}

@mcp.resource("greetings://{name}")
def personalized_greeting(name: str) -> str:
    """为给定名称生成个性化问候。"""
    return f"您好，{name}！欢迎来到 MCP 服务器。"
```

现在，客户端可以请求动态 URI：
- `greetings://Ford` 将调用 `personalized_greeting(name="Ford")`。
- `greetings://Marvin` 将调用 `personalized_greeting(name="Marvin")`。

FastMCP 自动将 URI 中的 `{name}` 占位符映射到函数中的 `name` 参数。

## 步骤 5：运行服务器

要使您的服务器可执行，请在脚本中添加一个调用 `mcp.run()` 的 `__main__` 代码块。

```python my_mcp_server.py {19-20}
from fastmcp import FastMCP

mcp = FastMCP(name="我的第一个 MCP 服务器")

@mcp.tool
def add(a: int, b: int) -> int:
    """将两个整数相加。"""
    return a + b

@mcp.resource("resource://config")
def get_config() -> dict:
    """提供应用程序的配置。"""
    return {"version": "1.0", "author": "MyTeam"}

@mcp.resource("greetings://{name}")
def personalized_greeting(name: str) -> str:
    """为给定名称生成个性化问候。"""
    return f"您好，{name}！欢迎来到 MCP 服务器。"

if __name__ == "__main__":
    mcp.run()
```

现在您可以从命令行运行您的服务器：
```bash
python my_mcp_server.py
```
这使用默认的 **STDIO 传输**启动服务器，这是像 Claude Desktop 这样的客户端与本地服务器通信的方式。要了解其他传输方式（如 HTTP），请参阅[运行您的服务器](/zh/deployment/running-server)指南。

## 完整的服务器

以下是 `my_mcp_server.py` 的完整代码（点击展开）：

```python my_mcp_server.py [expandable]
from fastmcp import FastMCP

# 1. 创建服务器
mcp = FastMCP(name="我的第一个 MCP 服务器")

# 2. 添加工具
@mcp.tool
def add(a: int, b: int) -> int:
    """将两个整数相加。"""
    return a + b

# 3. 添加静态资源
@mcp.resource("resource://config")
def get_config() -> dict:
    """提供应用程序的配置。"""
    return {"version": "1.0", "author": "MyTeam"}

# 4. 为动态内容添加资源模板
@mcp.resource("greetings://{name}")
def personalized_greeting(name: str) -> str:
    """为给定名称生成个性化问候。"""
    return f"您好，{name}！欢迎来到 MCP 服务器。"

# 5. 使服务器可运行
if __name__ == "__main__":
    mcp.run()
```

## 后续步骤

您已经成功构建了一个 MCP 服务器！从这里，您可以探索更高级的主题：

-   [**深入了解工具**](/zh/servers/tools)：了解异步工具、错误处理和自定义返回类型。
-   [**资源和模板**](/zh/servers/resources)：发现不同的资源类型，包括文件和 HTTP 端点。
-   [**提示**](/zh/servers/prompts)：为您的 LLM 创建可重用的提示模板。
-   [**运行您的服务器**](/zh/deployment/running-server)：使用不同的传输方式（如 HTTP）部署您的服务器。

